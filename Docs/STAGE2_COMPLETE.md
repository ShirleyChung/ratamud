# éšæ®µäºŒå®Œæˆï¼šä»»å‹™ç³»çµ±

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. æ ¸å¿ƒçµæ§‹

#### Quest (ä»»å‹™)
- âœ… ä»»å‹™ IDã€åç¨±ã€æè¿°
- âœ… ä»»å‹™ç‹€æ…‹ï¼ˆæœªé–‹å§‹ã€é€²è¡Œä¸­ã€å·²å®Œæˆã€å¤±æ•—ï¼‰
- âœ… å‰ç½®ä»»å‹™ç³»çµ±
- âœ… ä»»å‹™çµ¦äºˆè€…
- âœ… å¯é‡è¤‡æ¨™è¨˜

#### QuestCondition (ä»»å‹™æ¢ä»¶)
- âœ… èˆ‡ NPC å°è©±
- âœ… æ“æœ‰æŒ‡å®šç‰©å“
- âœ… æ“Šæ®ºæ•µäººï¼ˆè¨ˆæ•¸ï¼‰
- âœ… åˆ°é”åœ°é»
- âœ… ç©å®¶å±¬æ€§è¦æ±‚
- âœ… NPC å¥½æ„Ÿåº¦è¦æ±‚
- âœ… æ¢ä»¶å®Œæˆæª¢æŸ¥
- âœ… æ¢ä»¶æè¿°é¡¯ç¤º

#### QuestReward (ä»»å‹™çå‹µ)
- âœ… ç‰©å“çå‹µ
- âœ… ç¶“é©—å€¼çå‹µï¼ˆé ç•™ï¼‰
- âœ… å¥½æ„Ÿåº¦çå‹µ
- âœ… è§£é–å°è©±
- âœ… å±¬æ€§æå‡
- âœ… çå‹µæè¿°é¡¯ç¤º

### 2. ä»»å‹™ç®¡ç†å™¨ (QuestManager)
- âœ… æ·»åŠ /ç²å–ä»»å‹™
- âœ… é–‹å§‹ä»»å‹™ï¼ˆæª¢æŸ¥å‰ç½®æ¢ä»¶ï¼‰
- âœ… å®Œæˆä»»å‹™ï¼ˆæª¢æŸ¥æ¢ä»¶ã€ç™¼æ”¾çå‹µï¼‰
- âœ… æ”¾æ£„ä»»å‹™
- âœ… ç²å–é€²è¡Œä¸­çš„ä»»å‹™
- âœ… ç²å–å¯æ¥å–çš„ä»»å‹™
- âœ… ç²å–å·²å®Œæˆçš„ä»»å‹™
- âœ… å¾ç›®éŒ„è¼‰å…¥ä»»å‹™
- âœ… ä¿å­˜ä»»å‹™ç‹€æ…‹

### 3. éŠæˆ²æŒ‡ä»¤
- âœ… `quest` / `quest list` - åˆ—å‡ºæ‰€æœ‰ä»»å‹™
- âœ… `quest active` - åˆ—å‡ºé€²è¡Œä¸­çš„ä»»å‹™
- âœ… `quest available` - åˆ—å‡ºå¯æ¥å–çš„ä»»å‹™
- âœ… `quest completed` - åˆ—å‡ºå·²å®Œæˆçš„ä»»å‹™
- âœ… `quest info <ä»»å‹™ID>` - æŸ¥çœ‹ä»»å‹™è©³æƒ…
- âœ… `quest start <ä»»å‹™ID>` - é–‹å§‹ä»»å‹™
- âœ… `quest complete <ä»»å‹™ID>` - å®Œæˆä»»å‹™
- âœ… `quest abandon <ä»»å‹™ID>` - æ”¾æ£„ä»»å‹™

### 4. çå‹µç³»çµ±æ•´åˆ
- âœ… ç‰©å“çå‹µè‡ªå‹•æ·»åŠ åˆ°èƒŒåŒ…
- âœ… å¥½æ„Ÿåº¦çå‹µè‡ªå‹•æ›´æ–° NPC
- âœ… è§£é–å°è©±è‡ªå‹•è¨­ç½®åˆ° NPC
- âœ… å±¬æ€§æå‡è‡ªå‹•æ›´æ–°ç©å®¶
- âœ… çå‹µå¾Œè‡ªå‹•ä¿å­˜ç‹€æ…‹

### 5. æ•¸æ“šæŒä¹…åŒ–
- âœ… JSON åºåˆ—åŒ–/ååºåˆ—åŒ–
- âœ… è‡ªå‹•è¼‰å…¥ä»»å‹™ç›®éŒ„
- âœ… è‡ªå‹•ä¿å­˜ä»»å‹™ç‹€æ…‹
- âœ… èˆ‡ä¸–ç•Œç³»çµ±æ•´åˆ

### 6. UI é¡¯ç¤º
- âœ… ä»»å‹™åˆ—è¡¨é¡¯ç¤º
- âœ… ä»»å‹™è©³æƒ…é¡¯ç¤ºï¼ˆå«å‰ç½®ä»»å‹™ã€æ¢ä»¶ã€çå‹µï¼‰
- âœ… æ¢ä»¶å®Œæˆç‹€æ…‹æ¨™è¨˜ (âœ“/â—‹)
- âœ… ä»»å‹™é€²åº¦é¡¯ç¤º

### 7. æ¸¬è©¦
- âœ… å–®å…ƒæ¸¬è©¦ï¼ˆ3å€‹æ¸¬è©¦å…¨éƒ¨é€šéï¼‰
- âœ… æ¸¬è©¦è…³æœ¬ `test_quest.sh`
- âœ… ç¤ºä¾‹ä»»å‹™æ–‡ä»¶

## ğŸ“ æ–°å¢/ä¿®æ”¹çš„æ–‡ä»¶

### æ–°å¢æ–‡ä»¶
1. **src/quest.rs** - å®Œæ•´çš„ä»»å‹™ç³»çµ±å¯¦ç¾ï¼ˆ~520 è¡Œï¼‰
2. **worlds/åˆå§‹ä¸–ç•Œ/quests/tutorial_talk_to_merchant.json** - æ•™å­¸ä»»å‹™
3. **worlds/åˆå§‹ä¸–ç•Œ/quests/collect_wood.json** - æ”¶é›†ä»»å‹™
4. **worlds/åˆå§‹ä¸–ç•Œ/quests/become_friend.json** - é—œä¿‚ä»»å‹™
5. **test_quest.sh** - ä»»å‹™ç³»çµ±æ¸¬è©¦è…³æœ¬

### ä¿®æ”¹æ–‡ä»¶
1. **src/lib.rs** - æ·»åŠ  quest æ¨¡çµ„
2. **src/main.rs** - æ·»åŠ  quest æ¨¡çµ„è²æ˜å’Œè¼‰å…¥é‚è¼¯
3. **src/world.rs** - æ·»åŠ  QuestManager æ¬„ä½
4. **src/input.rs** - æ·»åŠ ä»»å‹™ç›¸é—œæŒ‡ä»¤
5. **src/app.rs** - æ·»åŠ ä»»å‹™è™•ç†å‡½æ•¸ï¼ˆ~200 è¡Œï¼‰
6. **src/game_engine.rs** - æ·»åŠ ä»»å‹™æŒ‡ä»¤é è¦½

## ğŸ® ç¤ºä¾‹ä»»å‹™éˆ

æˆ‘å€‘å‰µå»ºäº†ä¸€å€‹å®Œæ•´çš„ä»»å‹™éˆç¤ºä¾‹ï¼š

### 1. æ•™å­¸ä»»å‹™ï¼šèˆ‡å•†äººå°è©±
```json
{
  "id": "tutorial_talk_to_merchant",
  "name": "èˆ‡å•†äººå°è©±",
  "conditions": [
    { "type": "talk_to_npc", "npc_id": "å•†äºº" }
  ],
  "rewards": [
    { "type": "item", "item": "é‡‘å¹£", "count": 10 },
    { "type": "relationship", "npc_id": "å•†äºº", "change": 10 }
  ]
}
```

### 2. æ”¶é›†ä»»å‹™ï¼šæ”¶é›†æœ¨æ
```json
{
  "id": "collect_wood",
  "name": "æ”¶é›†æœ¨æ",
  "prerequisites": ["tutorial_talk_to_merchant"],
  "conditions": [
    { "type": "has_item", "item": "æœ¨æ", "count": 10 }
  ],
  "rewards": [
    { "type": "item", "item": "é‡‘å¹£", "count": 100 },
    { "type": "relationship", "npc_id": "å•†äºº", "change": 20 },
    { "type": "unlock_dialogue", "npc_id": "å•†äºº", "scene": "æ„Ÿè¬" }
  ]
}
```

### 3. é—œä¿‚ä»»å‹™ï¼šæˆç‚ºå¥½å‹
```json
{
  "id": "become_friend",
  "name": "æˆç‚ºå¥½å‹",
  "prerequisites": ["collect_wood"],
  "conditions": [
    { "type": "npc_relationship", "npc_id": "å•†äºº", "min_value": 30 }
  ],
  "rewards": [
    { "type": "item", "item": "é­”æ³•æ›¸", "count": 1 },
    { "type": "stat_boost", "stat": "sociality", "amount": 10 }
  ]
}
```

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

```bash
# æŸ¥çœ‹æ‰€æœ‰ä»»å‹™
quest list

# æŸ¥çœ‹ä»»å‹™è©³æƒ…
quest info tutorial_talk_to_merchant

# é–‹å§‹ä»»å‹™
quest start tutorial_talk_to_merchant

# æŸ¥çœ‹é€²è¡Œä¸­çš„ä»»å‹™
quest active

# èˆ‡ NPC å°è©±ï¼ˆå®Œæˆæ¢ä»¶ï¼‰
talk å•†äºº

# å®Œæˆä»»å‹™
quest complete tutorial_talk_to_merchant

# æŸ¥çœ‹å·²å®Œæˆçš„ä»»å‹™
quest completed
```

## ğŸ§ª æ¸¬è©¦çµæœ

```bash
$ cargo test --lib quest::tests
running 3 tests
test quest::tests::test_quest_creation ... ok
test quest::tests::test_quest_manager ... ok
test quest::tests::test_quest_prerequisites ... ok

test result: ok. 3 passed; 0 failed; 0 ignored
```

## ğŸ“Š ä»£ç¢¼çµ±è¨ˆ

- æ–°å¢ä»£ç¢¼è¡Œæ•¸ï¼š~800 è¡Œ
- ä¿®æ”¹æ–‡ä»¶ï¼š6 å€‹
- æ–°å¢æ–‡ä»¶ï¼š5 å€‹
- æ–°å¢æ¸¬è©¦ï¼š3 å€‹

## ğŸ”— èˆ‡éšæ®µä¸€æ•´åˆ

ä»»å‹™ç³»çµ±èˆ‡é—œä¿‚ç³»çµ±å®Œç¾æ•´åˆï¼š
- âœ… ä»»å‹™å¯ä»¥è¦æ±‚ NPC å¥½æ„Ÿåº¦
- âœ… ä»»å‹™å¯ä»¥çå‹µå¥½æ„Ÿåº¦
- âœ… ä»»å‹™å¯ä»¥è§£é–æ–°å°è©±
- âœ… å®Œæˆä»»å‹™æœƒè‡ªå‹•æ›´æ–°é—œä¿‚ç‹€æ…‹

## ğŸ¯ ä¸‹ä¸€æ­¥ï¼šéšæ®µä¸‰ - äº‹ä»¶ç³»çµ±æ•´åˆ

æº–å‚™å¯¦ç¾ï¼š
1. ä»»å‹™è§¸ç™¼äº‹ä»¶
2. äº‹ä»¶è‡ªå‹•æ›´æ–°ä»»å‹™æ¢ä»¶
3. åŸºæ–¼ä»»å‹™ç‹€æ…‹çš„äº‹ä»¶
4. NPC æ ¹æ“šä»»å‹™çµ¦äºˆä»»å‹™
5. å‹•æ…‹ç”Ÿæˆä»»å‹™

---

**å®Œæˆæ™‚é–“**: 2025-12-20  
**éšæ®µ**: 2/5  
**ç‹€æ…‹**: âœ… å®Œæˆä¸¦æ¸¬è©¦é€šé
