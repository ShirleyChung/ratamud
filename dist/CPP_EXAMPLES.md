# RataMUD C/C++ ç¯„ä¾‹ç¨‹å¼èªªæ˜

æœ¬ç›®éŒ„åŒ…å« RataMUD å‹•æ…‹é€£çµå‡½å¼åº«çš„ C å’Œ C++ ä½¿ç”¨ç¯„ä¾‹ã€‚

## ğŸ“¦ æª”æ¡ˆåˆ—è¡¨

- **libratamud.dylib** (macOS) / libratamud.so (Linux) - å‹•æ…‹é€£çµå‡½å¼åº«
- **ratamud.h** - C API æ¨™é ­æª”
- **example.c** - C èªè¨€ä½¿ç”¨ç¯„ä¾‹
- **test.cpp** - C++ å®Œæ•´æ¸¬è©¦ç¨‹å¼
- **Makefile** - ç·¨è­¯è…³æœ¬
- **README.md** - æœ¬èªªæ˜æ–‡ä»¶

## ğŸš€ å¿«é€Ÿé–‹å§‹

### ä½¿ç”¨ Makefileï¼ˆæ¨è–¦ï¼‰

```bash
# ç·¨è­¯æ‰€æœ‰ç¯„ä¾‹
make

# é‹è¡Œ C ç¯„ä¾‹
make run-c

# é‹è¡Œ C++ æ¸¬è©¦
make run-cpp

# é‹è¡Œæ‰€æœ‰æ¸¬è©¦
make run-all

# æ¸…ç†
make clean

# æŸ¥çœ‹å¹«åŠ©
make help
```

### æ‰‹å‹•ç·¨è­¯

#### C ç¯„ä¾‹

```bash
# macOS/Linux
gcc -o example example.c -L. -lratamud -Wl,-rpath,.

# Windows
gcc -o example.exe example.c -L. -lratamud
```

#### C++ æ¸¬è©¦

```bash
# macOS/Linux
g++ -std=c++17 -o test test.cpp -L. -lratamud -Wl,-rpath,.

# Windows
g++ -std=c++17 -o test.exe test.cpp -L. -lratamud
```

## ğŸ“ ç¯„ä¾‹èªªæ˜

### example.c - C èªè¨€ç¯„ä¾‹

ç°¡å–®çš„ C èªè¨€ç¯„ä¾‹ï¼Œå±•ç¤ºåŸºæœ¬ API ä½¿ç”¨ï¼š

- å‰µå»ºç©å®¶å’Œä¸–ç•Œ
- æŸ¥è©¢ç©å®¶è³‡è¨Š
- è¨­ç½®ç©å®¶ä½ç½®å’Œ HP
- è¼‰å…¥åœ°åœ–

**ç‰¹é»**ï¼š
- ç›´æ¥ä½¿ç”¨ C API
- æ‰‹å‹•ç®¡ç†è¨˜æ†¶é«”
- ç°¡æ½”æ˜ç­

### test.cpp - C++ å®Œæ•´æ¸¬è©¦

å®Œæ•´çš„ C++ æ¸¬è©¦ç¨‹å¼ï¼ŒåŒ…å«ï¼š

1. **RAII åŒ…è£é¡**
   - `RataMUDString` - è‡ªå‹•ç®¡ç†å­—ä¸²è¨˜æ†¶é«”
   - `Player` - ç©å®¶é¡åˆ¥
   - `World` - ä¸–ç•Œé¡åˆ¥

2. **8 å€‹æ¸¬è©¦æ¡ˆä¾‹**
   - æ¸¬è©¦ 1: å‰µå»ºç©å®¶
   - æ¸¬è©¦ 2: å‰µå»ºä¸–ç•Œ
   - æ¸¬è©¦ 3: æŸ¥è©¢ç©å®¶è³‡è¨Š
   - æ¸¬è©¦ 4: ç§»å‹•ç©å®¶
   - æ¸¬è©¦ 5: ä¿®æ”¹ HP
   - æ¸¬è©¦ 6: è¼‰å…¥åœ°åœ–
   - æ¸¬è©¦ 7: å¤šå€‹ç©å®¶å¯¦ä¾‹
   - æ¸¬è©¦ 8: ç°¡å–®å£“åŠ›æ¸¬è©¦ï¼ˆ1000 å€‹å¯¦ä¾‹ï¼‰

**ç‰¹é»**ï¼š
- ä½¿ç”¨ RAII è‡ªå‹•ç®¡ç†è³‡æº
- é¡å‹å®‰å…¨çš„ C++ åŒ…è£
- ç•°å¸¸è™•ç†æ”¯æ´
- ç¾åŒ–çš„è¼¸å‡ºæ ¼å¼
- æ€§èƒ½æ¸¬è©¦

## ğŸ’¡ C++ åŒ…è£é¡ä½¿ç”¨ç¯„ä¾‹

```cpp
#include "ratamud.h"

int main() {
    try {
        // å‰µå»ºç©å®¶ï¼ˆè‡ªå‹•ç®¡ç†è³‡æºï¼‰
        Player player("å‹‡è€…", "ä¾†è‡ªç•°ä¸–ç•Œçš„å†’éšªè€…");
        
        // å‰µå»ºä¸–ç•Œ
        World world(player);
        
        // ç²å–ç©å®¶è³‡è¨Š
        std::string name = player.getName();
        auto [x, y] = player.getPosition();
        int hp = player.getHP();
        
        // ä¿®æ”¹å±¬æ€§
        player.setPosition(100, 200);
        player.setHP(9999);
        
        // è¼‰å…¥åœ°åœ–
        world.loadMap("æ–°æ‰‹æ‘");
        std::string mapName = world.getCurrentMap();
        
        // ä¸éœ€è¦æ‰‹å‹•æ¸…ç†ï¼Œææ§‹å‡½æ•¸æœƒè‡ªå‹•è™•ç†
        
    } catch (const std::exception& e) {
        std::cerr << "éŒ¯èª¤: " << e.what() << "\n";
        return 1;
    }
    
    return 0;
}
```

## ğŸ¯ C++ é¡åˆ¥è¨­è¨ˆç‰¹é»

### RataMUDString é¡

è‡ªå‹•ç®¡ç† C å­—ä¸²è¨˜æ†¶é«”ï¼š

```cpp
RataMUDString str(ratamud_get_player_name(player));
// è‡ªå‹•åœ¨ææ§‹æ™‚èª¿ç”¨ ratamud_free_string()
```

### Player é¡

å°è£ç©å®¶æ“ä½œï¼š

```cpp
class Player {
public:
    Player(const std::string& name, const std::string& description);
    ~Player();  // è‡ªå‹•èª¿ç”¨ ratamud_free_player()
    
    std::string getName() const;
    std::pair<int, int> getPosition() const;
    void setPosition(int x, int y);
    int getHP() const;
    void setHP(int hp);
    std::string getInfo() const;  // JSON æ ¼å¼
};
```

### World é¡

å°è£ä¸–ç•Œæ“ä½œï¼š

```cpp
class World {
public:
    explicit World(const Player& player);
    ~World();  // è‡ªå‹•èª¿ç”¨ ratamud_free_world()
    
    bool loadMap(const std::string& mapName);
    std::string getCurrentMap() const;
};
```

## ğŸ“Š æ¸¬è©¦è¼¸å‡ºç¯„ä¾‹

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ RataMUD C++ API æ¸¬è©¦ç¨‹å¼                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  API ç‰ˆæœ¬     : RataMUD v0.1.0

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ æ¸¬è©¦ 1: å‰µå»ºç©å®¶                                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  âœ“ ç©å®¶å‰µå»ºæˆåŠŸ
  ç©å®¶åç¨±   : å‹‡è€…

...

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ æ¸¬è©¦ 8: ç°¡å–®å£“åŠ›æ¸¬è©¦                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  å‰µå»ºå’ŒéŠ·æ¯€ 1000 å€‹ç©å®¶å¯¦ä¾‹...
  âœ“ å£“åŠ›æ¸¬è©¦å®Œæˆ
  è€—æ™‚         : 0 ms
  å¹³å‡æ¯å€‹   : 0.000000 ms

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ æ¸¬è©¦å®Œæˆ                                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  âœ“ æ‰€æœ‰æ¸¬è©¦é€šéï¼

  è¨˜æ†¶é«”ç®¡ç†: ä½¿ç”¨ RAII è‡ªå‹•ç®¡ç†
  é¡å‹å®‰å…¨: ä½¿ç”¨ C++ åŒ…è£é¡
  ç•°å¸¸å®‰å…¨: æ”¯æ´ RAII å’Œç•°å¸¸è™•ç†
```

## ğŸ”§ é€²éšä½¿ç”¨

### æ•´åˆåˆ°ä½ çš„å°ˆæ¡ˆ

1. è¤‡è£½ `libratamud.dylib` å’Œ `ratamud.h` åˆ°ä½ çš„å°ˆæ¡ˆç›®éŒ„
2. åœ¨ç·¨è­¯æ™‚é€£çµå‡½å¼åº«ï¼š
   ```bash
   g++ -o myapp myapp.cpp -L. -lratamud -Wl,-rpath,.
   ```
3. åŒ…å«æ¨™é ­æª”ï¼š
   ```cpp
   #include "ratamud.h"
   ```

### ä½¿ç”¨ C++ åŒ…è£é¡

å¯ä»¥ç›´æ¥è¤‡è£½ `test.cpp` ä¸­çš„åŒ…è£é¡åˆ°ä½ çš„å°ˆæ¡ˆï¼š

```cpp
// è¤‡è£½é€™äº›é¡åˆ¥åˆ°ä½ çš„å°ˆæ¡ˆ
class RataMUDString { ... }
class Player { ... }
class World { ... }
```

## âš ï¸ æ³¨æ„äº‹é …

1. **è¨˜æ†¶é«”ç®¡ç†**
   - C: å¿…é ˆæ‰‹å‹•èª¿ç”¨ `ratamud_free_string()` å’Œ `ratamud_free_player()`
   - C++: ä½¿ç”¨åŒ…è£é¡è‡ªå‹•ç®¡ç†

2. **éŒ¯èª¤è™•ç†**
   - æª¢æŸ¥ NULL è¿”å›å€¼ï¼ˆå¤±æ•—æ™‚ï¼‰
   - æª¢æŸ¥è¿”å›å€¼ 0 è¡¨ç¤ºæˆåŠŸï¼Œ-1 è¡¨ç¤ºå¤±æ•—

3. **å­—ä¸²ç·¨ç¢¼**
   - æ‰€æœ‰å­—ä¸²ä½¿ç”¨ UTF-8 ç·¨ç¢¼

4. **ç·šç¨‹å®‰å…¨**
   - ä¸è¦åœ¨å¤šç·šç¨‹é–“å…±äº«æŒ‡é‡

## ğŸ› ç–‘é›£æ’è§£

### æ‰¾ä¸åˆ°å‹•æ…‹å‡½å¼åº«

macOS:
```bash
export DYLD_LIBRARY_PATH=.:$DYLD_LIBRARY_PATH
```

Linux:
```bash
export LD_LIBRARY_PATH=.:$LD_LIBRARY_PATH
```

æˆ–ä½¿ç”¨ `-Wl,-rpath,.` ç·¨è­¯é¸é …

### ç·¨è­¯éŒ¯èª¤

ç¢ºä¿ï¼š
- æ¨™é ­æª”å’Œå‡½å¼åº«åœ¨åŒä¸€ç›®éŒ„
- ä½¿ç”¨æ­£ç¢ºçš„ç·¨è­¯å™¨ï¼ˆgcc/g++ï¼‰
- C++ éœ€è¦ C++17 æˆ–æ›´é«˜ç‰ˆæœ¬

## ğŸ“š æ›´å¤šè³‡è¨Š

- **C API æ–‡æª”**: æŸ¥çœ‹ `ratamud.h`
- **è·¨å¹³å°æŒ‡å—**: æŸ¥çœ‹ `../Docs/C_ABI_GUIDE.md`
- **å¿«é€Ÿå…¥é–€**: æŸ¥çœ‹ `../C_ABI_README.md`

## ğŸ¤ è²¢ç»

æ­¡è¿æ”¹é€²ç¯„ä¾‹ç¨‹å¼æˆ–æ·»åŠ æ–°çš„ä½¿ç”¨æ¡ˆä¾‹ï¼

## ğŸ“„ æˆæ¬Š

èˆ‡ RataMUD ä¸»é …ç›®ç›¸åŒ
