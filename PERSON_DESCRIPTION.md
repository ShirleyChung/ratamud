# Person Description System

## 概述

Person Description System 是一個自動根據角色屬性生成動態描述的系統。當角色的屬性（如外貌、力量、體格、性別、HP等）改變時，系統會自動更新角色的 `description` 字段。

## 功能特性

### 1. 屬性描述對應

系統會根據以下屬性自動生成描述：

- **外貌 (appearance)**: 1-100，每一分都有對應的形容詞
  - 1-10: 醜陋相關（極其醜陋的、醜醜的等）
  - 11-30: 普通相關（毫不起眼的、普通的等）
  - 31-60: 好看相關（清秀的、好看的等）
  - 61-90: 美麗相關（美貌的、美麗亮眼的等）
  - 91-100: 絕色相關（絕色美貌的、宛如謫仙的等）

- **體格 (build)**:
  - 0-39: 小
  - 40-59: 普通
  - 60-79: 大
  - 80-100: 大隻

- **性別 (gender)**:
  - 男: 男子
  - 女: 女子
  - 未設定: 人

- **力量 (strength)**:
  - 0-19: 柔弱的
  - 20-39: 單薄的
  - 40-59: 健康的
  - 60-79: 強健的
  - 80-100: 有力量的

- **健康狀態** (基於 HP/MaxHP 比例):
  - ≤20%: 瀕死的
  - ≤40%: 重傷的
  - ≤60%: 受傷的
  - ≤80%: 略有傷勢的
  - >80%: 健康的

### 2. 自動更新機制

以下方法會自動觸發描述更新：

```rust
person.set_appearance(85);    // 設置外貌並更新描述
person.set_build(70);         // 設置體格並更新描述
person.set_gender("女".to_string()); // 設置性別並更新描述
person.set_strength(90);      // 設置力量並更新描述
person.set_hp(50);            // 設置HP並更新描述
person.update_description();  // 手動觸發更新
```

### 3. 描述格式

生成的描述格式為：

**有性別**：
```
一位{外貌}，{體格}體格，{力量}{性別}，看起來{健康狀態}。
```

**無性別**：
```
一位{外貌}，{力量}人，看起來{健康狀態}。
```

範例：
- `一位面貌姣好的，大體格，有力量的女子，看起來健康的。`
- `一位醜醜的，小體格，柔弱的男子，看起來健康的。`
- `一位普通的，普通體格，健康的女子，看起來健康的。`
- `一位沉魚落雁的，大隻體格，有力量的男子，看起來重傷的。`
- `一位好看的，健康的人，看起來健康的。`（無性別）

## 使用方式

### 初始化

在程式啟動時調用：
```rust
person::init_person_descriptions();
```

### 設置屬性

使用 `set` 命令設置屬性（會自動更新描述）：

```
set me appearance 85      # 設置外貌為 85
set me build 70           # 設置體格為 70
set me gender 0           # 設置性別為女（0=女，1=男）
set me strength 90        # 設置力量為 90

# 中文別名
set me 顏值 85
set me 體格 70
set me 性別 0
set me 力量 90
```

### 查看描述

使用 `check` 命令查看角色詳細資訊，包括自動生成的描述：

```
check me
check <npc名稱>
```

## 資料檔案

描述資料存儲在 `worlds/person_descriptions.json`，包含：

- `appearance`: 1-100 的外貌描述詞典
- `strength`: 力量範圍與描述
- `build`: 體格範圍與描述
- `build_sex_combined`: （已棄用，保留用於向後兼容）
- `health_status`: 健康狀態描述

## 實作細節

1. **靜態全域資料**: 使用 `OnceLock` 確保描述資料只載入一次
2. **自動序列化**: Person 結構支援 serde，描述會隨存檔一起保存
3. **向後兼容**: 舊存檔會使用預設值（外貌50，體格50）
4. **檔案載入**: 從 `worlds/person_descriptions.json` 動態載入，方便修改和擴展

## 範例輸出

```
 武神 
│ 一位沉魚落雁的，大隻體格，有力量的男子，看起來重傷的。
│ 位置: (50, 50) @ beginMap
│ 狀態: 正常
│ HP: 30000/100000  力量: 95
│ MP: 100000/100000  知識: 100
│ 年齡: 0秒   交誼: 100
│ 性別: 男    顏值: 95
└─────────────────────────
```

## 測試案例

```
1. 小李: 一位醜醜的，小體格，柔弱的男子，看起來健康的。
2. 小花: 一位普通的，普通體格，健康的女子，看起來健康的。
3. 英姐: 一位美麗的，大體格，強健的女子，看起來受傷的。
4. 武神: 一位沉魚落雁的，大隻體格，有力量的男子，看起來重傷的。
5. 神秘人: 一位好看的，健康的人，看起來健康的。
```

