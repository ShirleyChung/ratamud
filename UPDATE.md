# æ›´æ–°æ—¥èªŒ

æœ¬æ–‡ä»¶è¨˜éŒ„æ‰€æœ‰é‡è¦çš„åŠŸèƒ½æ›´æ–°ã€é‡æ§‹å’Œä¿®å¾©ã€‚

---

## ç›®éŒ„

1. [UI ä½ˆå±€é‡æ§‹](#ui-ä½ˆå±€é‡æ§‹)
2. [æ™‚é–“ç³»çµ±åŸ·è¡Œç·’é‡æ§‹](#æ™‚é–“ç³»çµ±åŸ·è¡Œç·’é‡æ§‹)
3. [æ™‚é–“æµé€èˆ‡çœŸå¯¦ä¸–ç•ŒåŒæ­¥](#æ™‚é–“æµé€èˆ‡çœŸå¯¦ä¸–ç•ŒåŒæ­¥)
4. [ç³»çµ±æ—¥èªŒè¦–çª—](#ç³»çµ±æ—¥èªŒè¦–çª—)
5. [æ—¥èªŒè¦–çª—å‘½ä»¤](#æ—¥èªŒè¦–çª—å‘½ä»¤)
6. [Minimap é—œé–‰ä¿®å¾©](#minimap-é—œé–‰ä¿®å¾©)
7. [äº‹ä»¶ç³»çµ±è¨­è¨ˆ](#äº‹ä»¶ç³»çµ±è¨­è¨ˆ)
8. [äº‹ä»¶ç³»çµ±æ•´åˆ](#äº‹ä»¶ç³»çµ±æ•´åˆ)
9. [äº‹ä»¶ç³»çµ±ä½¿ç”¨èªªæ˜](#äº‹ä»¶ç³»çµ±ä½¿ç”¨èªªæ˜)
10. [äº‹ä»¶ç³»çµ±ç¸½çµ](#äº‹ä»¶ç³»çµ±ç¸½çµ)
11. [äº‹ä»¶ç³»çµ±æœ€çµ‚ç¸½çµ](#äº‹ä»¶ç³»çµ±æœ€çµ‚ç¸½çµ)
12. [äº‹ä»¶éš¨æ©Ÿä½ç½®æ”¯æ´](#äº‹ä»¶éš¨æ©Ÿä½ç½®æ”¯æ´)
13. [è³‡æ–™ç›¸å®¹æ€§èªªæ˜](#è³‡æ–™ç›¸å®¹æ€§èªªæ˜)

---

# UI å¸ƒå±€é‡æ§‹ - åˆ†é›¢æ¨™é¡Œåˆ—èˆ‡ç‹€æ…‹åˆ—

## å•é¡Œ
åŸæœ¬çš„ UI å°‡æ™‚é–“å’Œè‡¨æ™‚ç‹€æ…‹è¨Šæ¯æ··åœ¨ç‹€æ…‹åˆ—ä¸­:
- âŒ æ™‚é–“å’Œç‹€æ…‹è¨Šæ¯æ··é›œ,ä¸æ˜“é–±è®€
- âŒ ç•«é¢æœ€ä¸Šæ–¹æœ‰ä¸€è¡Œç©ºç™½æœªä½¿ç”¨
- âŒ ç‹€æ…‹åˆ—è³‡è¨Šéæ–¼æ“æ“ 

## è§£æ±ºæ–¹æ¡ˆ
å°‡ç•«é¢åˆ†ç‚ºå››å€‹å€åŸŸ,æ–°å¢ç¨ç«‹çš„æ¨™é¡Œåˆ—é¡¯ç¤ºæ™‚é–“:

### æ–°çš„ UI å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš”ï¸ åˆå§‹ä¸–ç•Œ | ğŸ• Day 1 09:05:30      â”‚ â† æ¨™é¡Œåˆ— (æ–°å¢)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚
â”‚  è¼¸å‡ºè¨Šæ¯å€åŸŸ                          â”‚
â”‚  (éŠæˆ²è¨Šæ¯ã€æè¿°ç­‰)                    â”‚
â”‚                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  > è¼¸å…¥å‘½ä»¤...                         â”‚ â† è¼¸å…¥å€åŸŸ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [è‡¨æ™‚ç‹€æ…‹è¨Šæ¯]                        â”‚ â† ç‹€æ…‹åˆ— (ç°¡åŒ–)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1. æ–°å¢ `HeaderDisplay` (ui.rs)

```rust
pub struct HeaderDisplay;

impl HeaderDisplay {
    pub fn render_header<'a>(world_name: &'a str, current_time: &'a str) -> Paragraph<'a> {
        let header_text = format!("âš”ï¸  {} | ğŸ• {}", world_name, current_time);
        
        let header_span = Span::styled(
            header_text,
            Style::default()
                .fg(Color::Yellow)
                .add_modifier(Modifier::BOLD)
        );
        
        Paragraph::new(Line::from(header_span))
            .alignment(Alignment::Center)
    }
}
```

**ç‰¹é»:**
- å±…ä¸­é¡¯ç¤ºä¸–ç•Œåç¨±å’Œç•¶å‰æ™‚é–“
- ä½¿ç”¨é»ƒè‰²ç²—é«”,é†’ç›®æ˜“è®€
- æ·»åŠ åœ–æ¨™å¢åŠ è¦–è¦ºæ•ˆæœ

### 2. ä¿®æ”¹ä¸»å¾ªç’°å¸ƒå±€ (app.rs)

**ä¹‹å‰ (3 å€‹å€åŸŸ):**
```rust
.constraints([
    Constraint::Min(1),      // è¼¸å‡ºå€åŸŸ
    Constraint::Length(3),   // è¼¸å…¥å€åŸŸ
    Constraint::Length(1),   // ç‹€æ…‹åˆ—
])
```

**ä¹‹å¾Œ (4 å€‹å€åŸŸ):**
```rust
.constraints([
    Constraint::Length(1),   // æ¨™é¡Œåˆ— (æ–°å¢)
    Constraint::Min(1),      // è¼¸å‡ºå€åŸŸ
    Constraint::Length(3),   // è¼¸å…¥å€åŸŸ
    Constraint::Length(1),   // ç‹€æ…‹åˆ—
])
```

**æ¸²æŸ“æ¨™é¡Œåˆ—:**
```rust
let current_time_str = game_world.format_time();
let header_widget = HeaderDisplay::render_header(
    "åˆå§‹ä¸–ç•Œ",
    &current_time_str
);
f.render_widget(header_widget, vertical_chunks[0]);
```

### 3. ç°¡åŒ–ç‹€æ…‹åˆ— (output.rs)

**ä¹‹å‰:**
```rust
pub fn render_status(&self) -> Paragraph {
    let status_text = if let Some(time) = self.status_time {
        if time.elapsed() > Duration::from_secs(5) {
            self.current_time.clone()  // é¡¯ç¤ºæ™‚é–“
        } else {
            format!("{} | {}", self.status, self.current_time)  // ç‹€æ…‹ + æ™‚é–“
        }
    } else {
        self.current_time.clone()  // é¡¯ç¤ºæ™‚é–“
    };
    // ...
}
```

**ä¹‹å¾Œ:**
```rust
pub fn render_status(&self) -> Paragraph {
    let status_text = if let Some(time) = self.status_time {
        if time.elapsed() > Duration::from_secs(5) {
            String::new()  // ç‹€æ…‹éæœŸå¾Œé¡¯ç¤ºç©ºç™½
        } else {
            self.status.clone()  // åªé¡¯ç¤ºè‡¨æ™‚ç‹€æ…‹
        }
    } else {
        String::new()
    };
    // ...
}
```

### 4. ç§»é™¤ä¸å¿…è¦çš„æ™‚é–“æ›´æ–°é‚è¼¯

**ä¹‹å‰:**
```rust
let mut last_time_display = Instant::now();
let time_display_interval = Duration::from_secs(5);

// æ¯5ç§’é¡¯ç¤ºä¸€æ¬¡æ™‚é–“åˆ°ç‹€æ…‹åˆ—
if now.duration_since(last_time_display) >= time_display_interval {
    output_manager.set_current_time(game_world.format_time());
    last_time_display = now;
}
```

**ä¹‹å¾Œ:**
```rust
// ä¸å†éœ€è¦å®šæœŸæ›´æ–°ç‹€æ…‹åˆ—çš„æ™‚é–“
// æ™‚é–“ç›´æ¥åœ¨æ¯æ¬¡æ¸²æŸ“æ™‚å¾ game_world è®€å–ä¸¦é¡¯ç¤ºåœ¨æ¨™é¡Œåˆ—
```

## å„ªå‹¢

### âœ… æ›´æ¸…æ™°çš„è¦–è¦ºå±¤æ¬¡
- æ¨™é¡Œåˆ—: å›ºå®šé¡¯ç¤ºä¸–ç•Œåç¨±å’Œæ™‚é–“
- è¼¸å‡ºå€åŸŸ: éŠæˆ²è¨Šæ¯å’Œå…§å®¹
- è¼¸å…¥å€åŸŸ: ç©å®¶å‘½ä»¤è¼¸å…¥
- ç‹€æ…‹åˆ—: è‡¨æ™‚æç¤ºè¨Šæ¯

### âœ… æ™‚é–“è³‡è¨Šæ›´æ˜é¡¯
- å§‹çµ‚é¡¯ç¤ºåœ¨é ‚éƒ¨,æ˜“æ–¼æŸ¥çœ‹
- ä¸æœƒè¢«è‡¨æ™‚ç‹€æ…‹è¨Šæ¯è¦†è“‹
- å¯¦æ™‚æ›´æ–° (æ¯æ¬¡æ¸²æŸ“æ™‚)

### âœ… ç‹€æ…‹åˆ—æ›´ç°¡æ½”
- åªé¡¯ç¤ºè‡¨æ™‚è¨Šæ¯ (å¦‚ "å·²ä¿å­˜")
- 5 ç§’å¾Œè‡ªå‹•æ¶ˆå¤±
- ä¸å†æ··é›œæ™‚é–“è³‡è¨Š

### âœ… å……åˆ†åˆ©ç”¨ç•«é¢ç©ºé–“
- ä½¿ç”¨åŸæœ¬ç©ºç™½çš„é ‚éƒ¨å€åŸŸ
- å„å€åŸŸè·è²¬æ˜ç¢º
- æ¸›å°‘è³‡è¨Šæ“æ“ 

### âœ… ç¨‹å¼ç¢¼æ›´ç°¡æ½”
- ç§»é™¤å®šæœŸæ›´æ–°ç‹€æ…‹åˆ—æ™‚é–“çš„é‚è¼¯
- æ™‚é–“ç›´æ¥åœ¨æ¸²æŸ“æ™‚è®€å–
- æ¸›å°‘ä¸å¿…è¦çš„ç‹€æ…‹è¿½è¹¤

## è¦–è¦ºæ•ˆæœ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        âš”ï¸  åˆå§‹ä¸–ç•Œ | ğŸ• Day 1 09:05:30           â”‚ â† é»ƒè‰²ç²—é«”æ¨™é¡Œ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ * ä½ åœ¨ä¸€ç‰‡ç¶ è‰²çš„è‰åœ°ä¸Šï¼Œå¾®é¢¨å¹éã€‚               â”‚
â”‚                                                  â”‚
â”‚ > look                                           â”‚
â”‚ ä½ ä»”ç´°è§€å¯Ÿå‘¨åœ...                                â”‚
â”‚                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ > _                                              â”‚ â† è¼¸å…¥å‘½ä»¤
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å·²ä¿å­˜éŠæˆ²é€²åº¦                                   â”‚ â† è‡¨æ™‚ç‹€æ…‹è¨Šæ¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ¸¬è©¦çµæœ
- âœ… ç·¨è­¯æˆåŠŸ
- âœ… æ¨™é¡Œåˆ—æ­£ç¢ºé¡¯ç¤ºä¸–ç•Œåç¨±å’Œæ™‚é–“
- âœ… æ™‚é–“å¯¦æ™‚æ›´æ–° (å¾æ™‚é˜ç·šç¨‹åŒæ­¥)
- âœ… ç‹€æ…‹åˆ—æ­£ç¢ºé¡¯ç¤ºè‡¨æ™‚è¨Šæ¯ä¸¦è‡ªå‹•æ¶ˆå¤±
- âœ… UI å¸ƒå±€å”èª¿ç¾è§€
# å¤šåŸ·è¡Œç·’æ™‚é˜é‡æ§‹

## å•é¡Œ
åŸæœ¬çš„ä¸–ç•Œæ™‚é˜æ˜¯åœ¨ä¸»äº‹ä»¶å¾ªç’°ä¸­é€éè¼ªè©¢æ–¹å¼æ›´æ–°çš„:
- âŒ ä¸æ˜¯çœŸæ­£çš„å¤šåŸ·è¡Œç·’
- âŒ æ™‚é–“ç²¾åº¦å—é™æ–¼äº‹ä»¶è¼ªè©¢ (æ¯ç§’æª¢æŸ¥ä¸€æ¬¡)
- âŒ æ™‚é–“æ›´æ–°é‚è¼¯å’Œ UI æ¸²æŸ“æ··åœ¨ä¸€èµ·
- âŒ å¦‚æœä¸»ç·šç¨‹å¿™ç¢Œ,æ™‚é–“æ›´æ–°æœƒå»¶é²

## è§£æ±ºæ–¹æ¡ˆ
å‰µå»ºç¨ç«‹çš„æ™‚é˜ç·šç¨‹,åœ¨èƒŒæ™¯æŒçºŒé‹è¡Œ:

### 1. æ–°å¢ `time_thread.rs`
```rust
pub struct TimeThread {
    time: Arc<Mutex<WorldTime>>,           // å…±äº«çš„æ™‚é–“ç‹€æ…‹
    handle: Option<thread::JoinHandle<()>>, // ç·šç¨‹å¥æŸ„
    should_stop: Arc<Mutex<bool>>,         // åœæ­¢ä¿¡è™Ÿ
}
```

**åŠŸèƒ½:**
- åœ¨ç¨ç«‹ç·šç¨‹ä¸­æ¯ç§’è‡ªå‹•æ›´æ–°æ™‚é–“
- ä½¿ç”¨ `Arc<Mutex<>>` å®‰å…¨å…±äº«æ™‚é–“ç‹€æ…‹
- æ”¯æ´å„ªé›…åœæ­¢ (é€é Drop trait)
- å¯ä»¥è®€å–å’Œè¨­å®šæ™‚é–“

### 2. ä¿®æ”¹ `GameWorld`
**ä¹‹å‰:**
```rust
pub fn update_time(&mut self) {
    self.time.advance(self.game_speed);
}
```

**ä¹‹å¾Œ:**
```rust
pub fn update_time(&mut self) {
    if let Some(ref time_thread) = self.time_thread {
        self.time = time_thread.get_time();  // å¾ç·šç¨‹åŒæ­¥æ™‚é–“
    }
}
```

### 3. ä¿®æ”¹ `app.rs` ä¸»å¾ªç’°
**ä¹‹å‰:**
```rust
let mut last_time_update = Instant::now();
let time_update_interval = Duration::from_millis(1000);

if now.duration_since(last_time_update) >= time_update_interval {
    game_world.update_time();  // æ‰‹å‹•è§¸ç™¼æ›´æ–°
    check_and_execute_events(game_world, me, output_manager);
}
```

**ä¹‹å¾Œ:**
```rust
// æ™‚é˜ç·šç¨‹è‡ªå‹•æ›´æ–°,åªéœ€åŒæ­¥å³å¯
game_world.update_time();  // å¾ç·šç¨‹è®€å–æœ€æ–°æ™‚é–“

// äº‹ä»¶æª¢æŸ¥ç¨ç«‹é€²è¡Œ
if now.duration_since(last_event_check) >= event_check_interval {
    check_and_execute_events(game_world, me, output_manager);
}
```

## å„ªå‹¢

### âœ… çœŸæ­£çš„å¤šåŸ·è¡Œç·’
- æ™‚é˜åœ¨ç¨ç«‹ç·šç¨‹ä¸­é‹è¡Œ
- ä¸å—ä¸»ç·šç¨‹å½±éŸ¿
- æ™‚é–“æ¨é€²æ›´ç²¾ç¢º

### âœ… è§£è€¦åˆ
- æ™‚é–“é‚è¼¯å’Œ UI é‚è¼¯åˆ†é›¢
- äº‹ä»¶æª¢æŸ¥å’Œæ™‚é–“æ›´æ–°è§£è€¦
- æ›´æ¸…æ™°çš„è²¬ä»»åˆ†é›¢

### âœ… æ›´å¥½çš„æ€§èƒ½
- ä¸»ç·šç¨‹ä¸éœ€è¦è¼ªè©¢æ™‚é–“
- æ¸›å°‘ä¸å¿…è¦çš„æª¢æŸ¥
- UI æ›´æµæš¢

### âœ… ç·šç¨‹å®‰å…¨
- ä½¿ç”¨ `Arc<Mutex<>>` ç¢ºä¿å®‰å…¨
- å„ªé›…çš„åœæ­¢æ©Ÿåˆ¶
- é˜²æ­¢æ•¸æ“šç«¶çˆ­

## æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Main Thread                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   UI Event Loop              â”‚  â”‚
â”‚  â”‚   - è™•ç†è¼¸å…¥                  â”‚  â”‚
â”‚  â”‚   - æ¸²æŸ“ç•«é¢                  â”‚  â”‚
â”‚  â”‚   - å®šæœŸåŒæ­¥æ™‚é–“              â”‚  â”‚
â”‚  â”‚   - æª¢æŸ¥äº‹ä»¶è§¸ç™¼              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚ time_thread.get_time()
            â”‚ (è®€å–å…±äº«æ™‚é–“)
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Time Thread (Background)        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Arc<Mutex<WorldTime>>      â”‚  â”‚
â”‚  â”‚   - æ¯ç§’è‡ªå‹• advance()        â”‚  â”‚
â”‚  â”‚   - ç¨ç«‹é‹è¡Œ                  â”‚  â”‚
â”‚  â”‚   - ä¸å—ä¸»ç·šç¨‹å½±éŸ¿            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä½¿ç”¨æ–¹å¼

**åˆå§‹åŒ–:**
```rust
let time = WorldTime::new();
let game_speed = 60.0;  // 1 å¯¦éš›ç§’ = 60 éŠæˆ²ç§’
let time_thread = TimeThread::new(time, game_speed);
```

**è®€å–æ™‚é–“:**
```rust
let current_time = time_thread.get_time();
```

**è¨­å®šæ™‚é–“:**
```rust
time_thread.set_time(new_time);  // ä¾‹å¦‚å¾å­˜æª”åŠ è¼‰
```

**è‡ªå‹•æ¸…ç†:**
```rust
// Drop trait æœƒè‡ªå‹•åœæ­¢ç·šç¨‹
drop(time_thread);
```

## æ¸¬è©¦çµæœ
- âœ… ç·¨è­¯æˆåŠŸ
- âœ… æ™‚é˜ç·šç¨‹æ­£å¸¸å•Ÿå‹•
- âœ… æ™‚é–“åŒæ­¥æ©Ÿåˆ¶æ­£å¸¸
- âœ… ç¨‹åºå¯ä»¥æ­£å¸¸é€€å‡º (ç·šç¨‹å„ªé›…åœæ­¢)
# æ™‚é–“åŒæ­¥ä¿®æ”¹ - çœŸå¯¦ä¸–ç•Œæ™‚é–“

## ä¿®æ”¹å…§å®¹

å°‡éŠæˆ²æ™‚é–“æ”¹ç‚ºèˆ‡çœŸå¯¦ä¸–ç•ŒåŒæ­¥ï¼š
- **1 çœŸå¯¦ç§’ = 1 éŠæˆ²ç§’** (ä¹‹å‰æ˜¯ 1 çœŸå¯¦ç§’ = 60 éŠæˆ²ç§’)
- æ¯ç§’æ›´æ–°ä¸€æ¬¡
- åˆå§‹æ™‚é–“ç‚ºç•¶å‰çœŸå¯¦æ™‚é–“

## å¯¦ç¾ç´°ç¯€

### 1. ä¿®æ”¹ game_speed (world.rs)

**ä¹‹å‰:**
```rust
let game_speed = 60.0;  // 1 çœŸå¯¦ç§’ = 60 éŠæˆ²ç§’
```

**ä¹‹å¾Œ:**
```rust
let game_speed = 1.0;  // èˆ‡çœŸå¯¦ä¸–ç•ŒåŒæ­¥ï¼š1 çœŸå¯¦ç§’ = 1 éŠæˆ²ç§’
```

### 2. ä½¿ç”¨çœŸå¯¦æ™‚é–“åˆå§‹åŒ– (world.rs)

**ä¹‹å‰:**
```rust
WorldTime {
    hour: 9,
    minute: 0,
    second: 0,
    day: 1,
    last_update: now,
}
```

**ä¹‹å¾Œ:**
```rust
use chrono::{Local, Timelike};
let local_time = Local::now();

WorldTime {
    hour: local_time.hour() as u8,      // ç•¶å‰å°æ™‚
    minute: local_time.minute() as u8,  // ç•¶å‰åˆ†é˜
    second: local_time.second() as u8,  // ç•¶å‰ç§’
    day: 1,  // éŠæˆ²æ—¥æœŸå¾ç¬¬1å¤©é–‹å§‹
    last_update: now,
}
```

### 3. æ™‚é–“æ¨é€²é‚è¼¯ (world.rs)

```rust
// æ¨é€²æ™‚é–“ï¼ˆèˆ‡çœŸå¯¦ä¸–ç•ŒåŒæ­¥ï¼š1 å¯¦éš›ç§’ = 1 éŠæˆ²ç§’ï¼‰
pub fn advance(&mut self, game_speed: f32) {
    let now = SystemTime::now()
        .duration_since(UNIX_EPOCH)
        .unwrap()
        .as_millis() as u64;
    
    let elapsed_real_ms = now - self.last_update;
    // game_speed = 1.0 è¡¨ç¤ºèˆ‡çœŸå¯¦ä¸–ç•ŒåŒæ­¥
    let elapsed_game_secs = ((elapsed_real_ms as f32 / 1000.0) * game_speed) as u32;
    
    // ... è¨ˆç®—æ–°çš„æ™‚åˆ†ç§’
    
    self.last_update = now;
}
```

### 4. æ™‚é˜ç·šç¨‹ (time_thread.rs)

æ™‚é˜ç·šç¨‹æ¯ç§’è‡ªå‹•èª¿ç”¨ `advance(1.0)`ï¼š

```rust
let handle = thread::spawn(move || {
    loop {
        // æª¢æŸ¥æ˜¯å¦æ‡‰è©²åœæ­¢
        if *should_stop_clone.lock().unwrap() {
            break;
        }
        
        // æ›´æ–°æ™‚é–“
        {
            let mut time = time_clone.lock().unwrap();
            time.advance(game_speed);  // game_speed = 1.0
        }
        
        // æ¯ç§’æ›´æ–°ä¸€æ¬¡
        thread::sleep(Duration::from_millis(1000));
    }
});
```

## æ™‚é–“æµé€ç¯„ä¾‹

### çœŸå¯¦æ™‚é–“ vs éŠæˆ²æ™‚é–“

| çœŸå¯¦æ™‚é–“ | éŠæˆ²æ™‚é–“ | èªªæ˜ |
|----------|----------|------|
| 14:30:00 | Day 1 14:30:00 | éŠæˆ²å•Ÿå‹• |
| 14:30:01 | Day 1 14:30:01 | 1ç§’å¾Œ |
| 14:30:10 | Day 1 14:30:10 | 10ç§’å¾Œ |
| 14:31:00 | Day 1 14:31:00 | 1åˆ†é˜å¾Œ |
| 15:30:00 | Day 1 15:30:00 | 1å°æ™‚å¾Œ |

### è·¨æ—¥ç¯„ä¾‹

| çœŸå¯¦æ™‚é–“ | éŠæˆ²æ™‚é–“ | èªªæ˜ |
|----------|----------|------|
| 23:59:58 | Day 1 23:59:58 | å¿«åˆ°åˆå¤œ |
| 23:59:59 | Day 1 23:59:59 | æœ€å¾Œä¸€ç§’ |
| 00:00:00 | Day 2 00:00:00 | æ–°çš„ä¸€å¤© |

## è¦–è¦ºæ•ˆæœ

### æ¨™é¡Œåˆ—æ™‚é–“é¡¯ç¤º
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš”ï¸ åˆå§‹ä¸–ç•Œ | ğŸ• Day 1 14:30:15       â”‚
â”‚                         â†‘â†‘â†‘â†‘â†‘â†‘          â”‚
â”‚                      æ¯ç§’æ›´æ–°            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ—¥èªŒè¦–çª—æ™‚é–“æˆ³
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ System Log        â”‚
â”‚ [14:30:15] è¼‰å…¥è¨­å®š  â”‚ â† ç³»çµ±æœ¬åœ°æ™‚é–“
â”‚ [14:30:16] åœ°åœ–å·²åŠ è¼‰â”‚
â”‚ [14:30:17] å·²è¼‰å…¥è§’è‰²â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å„ªå‹¢

### âœ… ç›´è§€æ˜“æ‡‚
- ç©å®¶çœ‹åˆ°çš„æ™‚é–“å°±æ˜¯çœŸå¯¦æ™‚é–“
- ä¸éœ€è¦æ›ç®—éŠæˆ²æ™‚é–“å’ŒçœŸå¯¦æ™‚é–“
- æ™‚é–“æ¦‚å¿µæ¸…æ™°æ˜ç¢º

### âœ… äº‹ä»¶è§¸ç™¼æº–ç¢º
- åŸºæ–¼çœŸå¯¦æ™‚é˜çš„äº‹ä»¶ç³»çµ±
- å®šæ™‚äº‹ä»¶æ›´ç²¾ç¢º
- ä¾¿æ–¼è¨­ç½®ç¾å¯¦ä¸–ç•Œçš„æ™‚é–“è§¸ç™¼å™¨

### âœ… å³æ™‚æ›´æ–°
- æ¯ç§’æ›´æ–°ä¸€æ¬¡
- æ™‚é–“æ¨é€²å¹³æ»‘
- ç„¡å»¶é²æ„Ÿ

### âœ… å¯æ“´å±•æ€§
- game_speed åƒæ•¸ä¿ç•™
- æœªä¾†å¯ä»¥èª¿æ•´æ™‚é–“æµé€Ÿ
- æ”¯æ´åŠ é€Ÿ/æ¸›é€ŸåŠŸèƒ½

## èˆ‡ä¹‹å‰çš„å·®ç•°

### ä¹‹å‰ (60å€é€Ÿ)
- 1 çœŸå¯¦ç§’ = 60 éŠæˆ²ç§’
- 1 çœŸå¯¦åˆ†é˜ = 1 éŠæˆ²å°æ™‚
- å¿«é€Ÿæ¨é€²éŠæˆ²é€²åº¦
- é©åˆéœ€è¦å¿«é€Ÿé«”é©—éŠæˆ²çš„å ´æ™¯

### ç¾åœ¨ (1å€é€Ÿ - çœŸå¯¦åŒæ­¥)
- 1 çœŸå¯¦ç§’ = 1 éŠæˆ²ç§’
- 1 çœŸå¯¦å°æ™‚ = 1 éŠæˆ²å°æ™‚
- èˆ‡ç¾å¯¦æ™‚é–“åŒæ­¥
- é©åˆéœ€è¦çœŸå¯¦æ™‚é–“é«”é©—çš„å ´æ™¯

## é…ç½®é¸é …

å¦‚æœéœ€è¦èª¿æ•´æ™‚é–“æµé€Ÿï¼Œåªéœ€ä¿®æ”¹ `game_speed`ï¼š

```rust
// world.rs - GameWorld::new()
let game_speed = 1.0;    // çœŸå¯¦æ™‚é–“åŒæ­¥
// let game_speed = 2.0;  // 2å€é€Ÿ (å¯é¸)
// let game_speed = 0.5;  // 0.5å€é€Ÿ (å¯é¸)
// let game_speed = 60.0; // 60å€é€Ÿ (èˆŠè¨­å®š)
```

## æ¸¬è©¦çµæœ
- âœ… ç·¨è­¯æˆåŠŸ
- âœ… æ™‚é–“èˆ‡çœŸå¯¦ä¸–ç•ŒåŒæ­¥
- âœ… æ¯ç§’æº–ç¢ºæ›´æ–°
- âœ… åˆå§‹æ™‚é–“ç‚ºç•¶å‰çœŸå¯¦æ™‚é–“
- âœ… è·¨æ—¥ã€è·¨å°æ™‚æ­£ç¢ºè¨ˆç®—
- âœ… æ™‚é˜ç·šç¨‹ç©©å®šé‹è¡Œ
# ç³»çµ±æ—¥èªŒè¦–çª—åŠŸèƒ½

## éœ€æ±‚
å°‡ç³»çµ±è¨Šæ¯(å¦‚"åœ°åœ–å·²åŠ è¼‰"ã€"å·²è¼‰å…¥è§’è‰²"ç­‰)å¾ä¸»è¨Šæ¯è¼¸å‡ºå€åŸŸåˆ†é›¢å‡ºä¾†ï¼Œé¡¯ç¤ºåœ¨ç¨ç«‹çš„æ—¥èªŒè¦–çª—ä¸­ã€‚

## è§£æ±ºæ–¹æ¡ˆ
æ–°å¢ä¸€å€‹é¡ä¼¼ minimap çš„æ‡¸æµ®è¦–çª—ï¼Œä½œç‚ºç³»çµ±æ—¥èªŒè¦–çª—ï¼Œé¡¯ç¤ºåœ¨ç•«é¢å³ä¸‹è§’ã€‚

## å¯¦ç¾ç´°ç¯€

### 1. æ“´å±• OutputManager (output.rs)

**æ–°å¢å­—æ®µ:**
```rust
pub struct OutputManager {
    // ... åŸæœ‰å­—æ®µ
    log_messages: Vec<String>,  // ç³»çµ±æ—¥èªŒè¨Šæ¯
    log_scroll: usize,          // æ—¥èªŒæ»¾å‹•ä½ç½®
    show_log: bool,             // æ˜¯å¦é¡¯ç¤ºæ—¥èªŒè¦–çª—
}
```

**æ–°å¢æ–¹æ³•:**
```rust
// æ·»åŠ ç³»çµ±æ—¥èªŒè¨Šæ¯ (å¸¶æ™‚é–“æˆ³)
pub fn log(&mut self, message: String) {
    let timestamp = Local::now().format("%H:%M:%S").to_string();
    let log_entry = format!("[{}] {}", timestamp, message);
    self.log_messages.push(log_entry);
    self.log_scroll = self.log_messages.len().saturating_sub(1);
}

// æ¸²æŸ“æ—¥èªŒè¦–çª—
pub fn render_log(&self, area: Rect) -> Paragraph {
    // é¡¯ç¤ºå¯è¦‹ç¯„åœå…§çš„æ—¥èªŒè¨Šæ¯
    // ç¶ è‰²æ–‡å­— + é»‘è‰²èƒŒæ™¯
    // æ¨™é¡Œ: "ğŸ“‹ System Log"
}

// æ§åˆ¶æ–¹æ³•
pub fn toggle_log(&mut self)        // åˆ‡æ›é¡¯ç¤º/éš±è—
pub fn is_log_open(&self) -> bool   // ç²å–ç‹€æ…‹
pub fn scroll_log_up/down(&mut self) // æ»¾å‹•æ—¥èªŒ
```

### 2. æ·»åŠ  chrono ä¾è³´ (Cargo.toml)

```toml
[dependencies]
chrono = "0.4"  # ç”¨æ–¼æ ¼å¼åŒ–æ™‚é–“æˆ³
```

### 3. ä¿®æ”¹ UI ä½ˆå±€ (app.rs)

**æ–°å¢æ—¥èªŒè¦–çª—æ¸²æŸ“:**
```rust
// è¨ˆç®—æ—¥èªŒè¦–çª—ä½ç½®å’Œå¤§å°ï¼ˆå³ä¸‹è§’ï¼Œå¯¬åº¦ 40%ï¼Œé«˜åº¦ 30%ï¼‰
let log_width = (size.width as f32 * 0.4) as u16;
let log_height = (size.height as f32 * 0.3) as u16;
let log_x = size.width.saturating_sub(log_width);
let log_y = size.height.saturating_sub(log_height);

let log_area = Rect {
    x: log_x,
    y: log_y,
    width: log_width,
    height: log_height,
};

// ç•«æ—¥èªŒè¦–çª—
if output_manager.is_log_open() {
    let log_widget = output_manager.render_log(log_area);
    f.render_widget(Clear, log_area);
    f.render_widget(log_widget, log_area);
}
```

### 4. ä¿®æ”¹ç³»çµ±è¨Šæ¯è¼¸å‡º (main.rs)

**å¾ `print` æ”¹ç‚º `log`:**

```rust
// ä¹‹å‰
output_manager.print(format!("åœ°åœ–å·²åŠ è¼‰: {}", map.name));

// ä¹‹å¾Œ
output_manager.log(format!("åœ°åœ–å·²åŠ è¼‰: {}", map.name));
```

**æ‰€æœ‰ç³»çµ±è¨Šæ¯éƒ½æ”¹ç”¨ log:**
- è¼‰å…¥è¨­å®šè¨Šæ¯
- è¼‰å…¥äº‹ä»¶è¨Šæ¯
- åœ°åœ–åŠ è¼‰è¨Šæ¯
- è§’è‰²è¼‰å…¥è¨Šæ¯
- NPC è¼‰å…¥è¨Šæ¯
- æ™‚é–“è¨Šæ¯

## è¦–è¦ºæ•ˆæœ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš”ï¸ åˆå§‹ä¸–ç•Œ | ğŸ• Day 1 09:05:30                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  éŠæˆ²è¨Šæ¯è¼¸å‡ºå€åŸŸ              â”‚ ğŸ“‹ System Log    â”‚â”‚
â”‚  (ç©å®¶äº’å‹•è¨Šæ¯)                â”‚ [14:30:15] è¼‰å…¥  â”‚â”‚
â”‚                                â”‚            è¨­å®š  â”‚â”‚
â”‚                                â”‚ [14:30:16] åœ°åœ–  â”‚â”‚
â”‚                                â”‚            å·²åŠ è¼‰â”‚â”‚
â”‚                                â”‚ [14:30:17] å·²è¼‰å…¥â”‚â”‚
â”‚                                â”‚            è§’è‰²  â”‚â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  > è¼¸å…¥å‘½ä»¤...                  [æ›´å¤šæ—¥èªŒ...]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [è‡¨æ™‚ç‹€æ…‹]                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ç‰¹é»

### âœ… è¨Šæ¯åˆ†é›¢
- **ä¸»è¼¸å‡ºå€åŸŸ**: ç©å®¶äº’å‹•è¨Šæ¯ (look, move, talk ç­‰)
- **æ—¥èªŒè¦–çª—**: ç³»çµ±è¨Šæ¯ (è¼‰å…¥ã€ä¿å­˜ã€éŒ¯èª¤ç­‰)
- å„è‡ªç¨ç«‹æ»¾å‹•å’Œé¡¯ç¤º

### âœ… æ™‚é–“æˆ³
- æ¯æ¢æ—¥èªŒè‡ªå‹•æ·»åŠ æ™‚é–“æˆ³ `[HH:MM:SS]`
- æ–¹ä¾¿è¿½è¹¤äº‹ä»¶ç™¼ç”Ÿé †åº
- ä½¿ç”¨ç³»çµ±æœ¬åœ°æ™‚é–“

### âœ… è¦–è¦ºå€åˆ†
- æ—¥èªŒè¦–çª—: ç¶ è‰²æ–‡å­— + é»‘è‰²èƒŒæ™¯
- ä¸»è¼¸å‡º: ç™½è‰²æ–‡å­— + æ¨™æº–èƒŒæ™¯
- åœ–æ¨™æ¨™è­˜: ğŸ“‹ System Log

### âœ… æ‡¸æµ®è¦–çª—
- ä½æ–¼å³ä¸‹è§’ï¼Œä¸é®æ“‹ä¸»è¦å…§å®¹
- ä½”ç”¨ 40% å¯¬åº¦ï¼Œ30% é«˜åº¦
- å¯ä»¥åˆ‡æ›é¡¯ç¤º/éš±è— (é è¨­é¡¯ç¤º)

### âœ… ç¨ç«‹æ»¾å‹•
- æ”¯æ´ä¸Šä¸‹æ»¾å‹•æŸ¥çœ‹æ­·å²æ—¥èªŒ
- è‡ªå‹•æ»¾å‹•åˆ°æœ€æ–°è¨Šæ¯
- ä¸å½±éŸ¿ä¸»è¼¸å‡ºå€åŸŸ

## ä½¿ç”¨æ–¹å¼

**è¨˜éŒ„ç³»çµ±æ—¥èªŒ:**
```rust
output_manager.log("åœ°åœ–å·²åŠ è¼‰".to_string());
output_manager.log(format!("è¼‰å…¥äº† {} å€‹äº‹ä»¶", count));
```

**è¨˜éŒ„ç©å®¶è¨Šæ¯ (ä½¿ç”¨åŸæœ‰çš„ print):**
```rust
output_manager.print("ä½ çœ‹åˆ°ä¸€ç‰‡æ£®æ—".to_string());
output_manager.print("å•†äººå‘ä½ æ‰“æ‹›å‘¼".to_string());
```

**æ§åˆ¶æ—¥èªŒè¦–çª—:**
```rust
output_manager.toggle_log();        // åˆ‡æ›é¡¯ç¤º/éš±è—
output_manager.scroll_log_up();     // å‘ä¸Šæ»¾å‹•
output_manager.scroll_log_down(10); // å‘ä¸‹æ»¾å‹•
```

## å„ªå‹¢

1. **æ¸…æ™°çš„è³‡è¨Šå±¤æ¬¡**: ç³»çµ±è¨Šæ¯å’ŒéŠæˆ²è¨Šæ¯å®Œå…¨åˆ†é›¢
2. **æ¸›å°‘å¹²æ“¾**: è¼‰å…¥è¨Šæ¯ä¸æœƒå¹²æ“¾éŠæˆ²é«”é©—
3. **æ–¹ä¾¿é™¤éŒ¯**: ç³»çµ±æ—¥èªŒä¾¿æ–¼è¿½è¹¤å•é¡Œ
4. **å°ˆæ¥­å¤–è§€**: é¡ä¼¼å°ˆæ¥­éŠæˆ²çš„æ—¥èªŒç³»çµ±
5. **å¯æ“´å±•**: æœªä¾†å¯ä»¥æ·»åŠ æ—¥èªŒç­‰ç´šã€éæ¿¾ç­‰åŠŸèƒ½

## æ¸¬è©¦çµæœ
- âœ… ç·¨è­¯æˆåŠŸ
- âœ… æ—¥èªŒè¦–çª—æ­£ç¢ºé¡¯ç¤ºåœ¨å³ä¸‹è§’
- âœ… ç³»çµ±è¨Šæ¯å¸¶æ™‚é–“æˆ³
- âœ… æ—¥èªŒå’Œä¸»è¼¸å‡ºå®Œå…¨åˆ†é›¢
- âœ… è¦–è¦ºæ•ˆæœæ¸…æ™°ç¾è§€
# æ—¥èªŒè¦–çª—æ§åˆ¶æŒ‡ä»¤

## æ–°å¢æŒ‡ä»¤

### 1. `show log`
é¡¯ç¤ºç³»çµ±æ—¥èªŒè¦–çª—

**ç”¨æ³•:**
```
> show log
```

**æ•ˆæœ:**
- åœ¨ç•«é¢å³å´é¡¯ç¤ºç³»çµ±æ—¥èªŒè¦–çª—
- é¡¯ç¤ºç³»çµ±è¨Šæ¯å’Œæ™‚é–“æˆ³
- ç‹€æ…‹åˆ—é¡¯ç¤º: "æ—¥èªŒè¦–çª—å·²é–‹å•Ÿ"

### 2. `hide log`
éš±è—ç³»çµ±æ—¥èªŒè¦–çª—

**ç”¨æ³•:**
```
> hide log
```

**æ•ˆæœ:**
- éš±è—å³å´çš„ç³»çµ±æ—¥èªŒè¦–çª—
- é‡‹æ”¾æ›´å¤šç©ºé–“çµ¦ä¸»è¼¸å‡ºå€åŸŸ
- ç‹€æ…‹åˆ—é¡¯ç¤º: "æ—¥èªŒè¦–çª—å·²é—œé–‰"

## å¯¦ç¾ç´°ç¯€

### 1. æ“´å±• CommandResult (input.rs)

**æ–°å¢æšèˆ‰å€¼:**
```rust
pub enum CommandResult {
    // ... åŸæœ‰æŒ‡ä»¤
    ShowLog,     // æ‰“é–‹æ—¥èªŒè¦–çª—
    HideLog,     // é—œé–‰æ—¥èªŒè¦–çª—
}
```

### 2. ä¿®æ”¹å‘½ä»¤è™•ç† (input.rs)

**show æŒ‡ä»¤æ“´å±•:**
```rust
"show" => {
    if parts.len() < 2 {
        CommandResult::Error("Usage: show <command>".to_string())
    } else if parts[1] == "status" {
        CommandResult::ShowStatus
    } else if parts[1] == "world" {
        CommandResult::ShowWorld
    } else if parts[1] == "minimap" {
        CommandResult::ShowMinimap
    } else if parts[1] == "log" {
        CommandResult::ShowLog  // æ–°å¢
    } else {
        CommandResult::Error(format!("Unknown show command: {}", parts[1]))
    }
}
```

**hide æŒ‡ä»¤æ“´å±•:**
```rust
"hide" => {
    if parts.len() < 2 {
        CommandResult::Error("Usage: hide <command>".to_string())
    } else if parts[1] == "minimap" {
        CommandResult::HideMinimap
    } else if parts[1] == "log" {
        CommandResult::HideLog  // æ–°å¢
    } else {
        CommandResult::Error(format!("Unknown hide command: {}", parts[1]))
    }
}
```

### 3. æ·»åŠ è™•ç†å‡½æ•¸ (app.rs)

**å‘½ä»¤åˆ†æ´¾:**
```rust
fn handle_command_result(
    result: CommandResult,
    output_manager: &mut OutputManager,
    game_world: &mut GameWorld,
    me: &mut Person,
) -> Result<(), Box<dyn std::error::Error>> {
    // ...
    match result {
        // ... åŸæœ‰æŒ‡ä»¤
        CommandResult::ShowLog => handle_show_log(output_manager),
        CommandResult::HideLog => handle_hide_log(output_manager),
    }
    Ok(())
}
```

**è™•ç†å‡½æ•¸:**
```rust
/// è™•ç†é¡¯ç¤ºæ—¥èªŒè¦–çª—
fn handle_show_log(output_manager: &mut OutputManager) {
    output_manager.show_log_window();
    output_manager.set_status("æ—¥èªŒè¦–çª—å·²é–‹å•Ÿ".to_string());
}

/// è™•ç†éš±è—æ—¥èªŒè¦–çª—
fn handle_hide_log(output_manager: &mut OutputManager) {
    output_manager.hide_log();
    output_manager.set_status("æ—¥èªŒè¦–çª—å·²é—œé–‰".to_string());
}
```

## ä½¿ç”¨ç¯„ä¾‹

### é¡¯ç¤ºæ—¥èªŒè¦–çª—
```
> show log
æ—¥èªŒè¦–çª—å·²é–‹å•Ÿ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  éŠæˆ²è¨Šæ¯          â”‚ ğŸ“‹ System    â”‚â”‚
â”‚                    â”‚ [14:30:15]   â”‚â”‚
â”‚                    â”‚ è¼‰å…¥è¨­å®š     â”‚â”‚
â”‚                    â”‚ [14:30:16]   â”‚â”‚
â”‚                    â”‚ åœ°åœ–å·²åŠ è¼‰   â”‚â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### éš±è—æ—¥èªŒè¦–çª—
```
> hide log
æ—¥èªŒè¦–çª—å·²é—œé–‰

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    â”‚
â”‚  éŠæˆ²è¨Šæ¯                          â”‚
â”‚  (ç²å¾—æ›´å¤šé¡¯ç¤ºç©ºé–“)                â”‚
â”‚                                    â”‚
â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ç¾æœ‰æŒ‡ä»¤ç¸½è¦½

### show ç³»åˆ—æŒ‡ä»¤
- `show status` - é¡¯ç¤ºç©å®¶ç‹€æ…‹é¢æ¿
- `show world` - é¡¯ç¤ºä¸–ç•Œè³‡è¨Šé¢æ¿
- `show minimap` - é¡¯ç¤ºå°åœ°åœ–
- `show log` - é¡¯ç¤ºç³»çµ±æ—¥èªŒ âœ¨ (æ–°å¢)

### hide ç³»åˆ—æŒ‡ä»¤
- `hide minimap` - éš±è—å°åœ°åœ–
- `hide log` - éš±è—ç³»çµ±æ—¥èªŒ âœ¨ (æ–°å¢)

## å„ªå‹¢

### âœ… ä¸€è‡´çš„å‘½ä»¤ä»‹é¢
- éµå¾ªç¾æœ‰çš„ `show/hide` å‘½ä»¤æ¨¡å¼
- ç”¨æˆ¶å®¹æ˜“è¨˜æ†¶å’Œä½¿ç”¨
- èˆ‡å…¶ä»–è¦–çª—æ§åˆ¶æŒ‡ä»¤ä¿æŒä¸€è‡´

### âœ… éˆæ´»çš„è¦–çª—æ§åˆ¶
- ç©å®¶å¯ä»¥æ ¹æ“šéœ€è¦é–‹é—œæ—¥èªŒè¦–çª—
- æ¸›å°‘è³‡è¨Šå¹²æ“¾
- éœ€è¦æ™‚å¿«é€ŸæŸ¥çœ‹ç³»çµ±æ—¥èªŒ

### âœ… å‹å¥½çš„åé¥‹
- ç‹€æ…‹åˆ—å³æ™‚é¡¯ç¤ºæ“ä½œçµæœ
- æ¸…æ™°å‘ŠçŸ¥è¦–çª—é–‹å•Ÿ/é—œé–‰ç‹€æ…‹
- æ“ä½œåé¥‹æ˜ç¢º

### âœ… é è¨­é–‹å•Ÿ
- æ—¥èªŒè¦–çª—é è¨­é¡¯ç¤º
- æ–¹ä¾¿ç©å®¶è¿½è¹¤ç³»çµ±è¨Šæ¯
- å¯ä»¥éš¨æ™‚éš±è—ä»¥ç²å¾—æ›´å¤šç©ºé–“

## æ¸¬è©¦çµæœ
- âœ… ç·¨è­¯æˆåŠŸ
- âœ… `show log` æŒ‡ä»¤æ­£ç¢ºé¡¯ç¤ºæ—¥èªŒè¦–çª—
- âœ… `hide log` æŒ‡ä»¤æ­£ç¢ºéš±è—æ—¥èªŒè¦–çª—
- âœ… ç‹€æ…‹åˆ—æ­£ç¢ºé¡¯ç¤ºæ“ä½œåé¥‹
- âœ… èˆ‡ç¾æœ‰æŒ‡ä»¤ç³»çµ±å®Œç¾æ•´åˆ
# ğŸ—ºï¸ å°åœ°åœ–ç‹€æ…‹ä¿å­˜ä¿®å¾©

## å•é¡Œæè¿°
å°åœ°åœ–çš„é–‹å•Ÿç‹€æ…‹ç„¡æ³•æ­£ç¢ºä¿å­˜å’Œæ¢å¾©ã€‚æ¯æ¬¡é‡æ–°å•Ÿå‹•éŠæˆ²å¾Œï¼Œå³ä½¿ä¹‹å‰é–‹å•Ÿäº†å°åœ°åœ–ï¼Œé‡å•Ÿå¾Œä»ç„¶æ˜¯é—œé–‰ç‹€æ…‹ã€‚

## æ ¹æœ¬åŸå› 
é›–ç„¶è¨­å®šæª”æ­£ç¢ºä¿å­˜äº† `show_minimap: true`ï¼Œä¸¦ä¸”åœ¨å•Ÿå‹•æ™‚ä¹Ÿæ­£ç¢ºè¼‰å…¥ä¸¦èª¿ç”¨äº† `output_manager.show_minimap()`ï¼Œä½†å°åœ°åœ–æ²’æœ‰åˆå§‹åŒ–å…§å®¹æ•¸æ“šï¼ˆ`minimap_lines` ç‚ºç©ºï¼‰ï¼Œå°è‡´å³ä½¿å°åœ°åœ–ç‹€æ…‹æ˜¯é–‹å•Ÿçš„ï¼Œç•«é¢ä¸Šä¹Ÿçœ‹ä¸åˆ°ä»»ä½•å…§å®¹ï¼Œçµ¦äººçš„æ„Ÿè¦ºå°±åƒæ˜¯å°åœ°åœ–æ²’æœ‰é–‹å•Ÿã€‚

## ä¿®å¾©æ–¹æ¡ˆ

### 1. å•é¡Œåˆ†æ
```rust
// è¨­å®šæª”æ­£ç¢ºä¿å­˜
{
  "show_minimap": true  // âœ… æ­£ç¢º
}

// å•Ÿå‹•æ™‚æ­£ç¢ºè¼‰å…¥
if game_settings.show_minimap {
    output_manager.show_minimap();  // âœ… ç‹€æ…‹å·²è¨­ç‚º true
}

// ä½†æ˜¯ï¼minimap_lines ä»ç„¶æ˜¯ç©ºçš„
minimap_lines: Vec::new()  // âŒ æ²’æœ‰å…§å®¹
```

### 2. ä¿®å¾©å…§å®¹
åœ¨ `src/main.rs` ä¸­ï¼Œé€²å…¥ä¸»å¾ªç’°å‰æ·»åŠ å°åœ°åœ–åˆå§‹åŒ–é‚è¼¯ï¼š

```rust
// å¦‚æœå°åœ°åœ–å·²é–‹å•Ÿï¼Œåˆå§‹åŒ–å…¶å…§å®¹
if output_manager.is_minimap_open() {
    if let Some(current_map) = game_world.get_current_map() {
        let mut minimap_data = vec![format!("ã€ä½ç½®: ({}, {})ã€‘", me.x, me.y)];
        
        // æª¢æŸ¥å››å€‹æ–¹å‘çš„åœ°å½¢
        // ä¸Šæ–¹
        if me.y > 0 {
            if let Some(point) = current_map.get_point(me.x, me.y - 1) {
                let walkable = if point.walkable { 'âœ“' } else { 'âœ—' };
                minimap_data.push(format!("â†‘ {} {}", point.description, walkable));
            }
        }
        // ... å…¶ä»–æ–¹å‘
        
        output_manager.update_minimap(minimap_data);
    }
}
```

### 3. ä¿®æ”¹æª”æ¡ˆ
- âœ… `src/main.rs` - æ·»åŠ å°åœ°åœ–åˆå§‹åŒ–é‚è¼¯ï¼ˆç´„ 50 è¡Œï¼‰

## æ¸¬è©¦æ­¥é©Ÿ

1. **é¦–æ¬¡å•Ÿå‹•éŠæˆ²**
   ```bash
   cargo run
   ```

2. **é–‹å•Ÿå°åœ°åœ–**
   - è¼¸å…¥å‘½ä»¤ `minimap` æˆ–æŒ‰å¿«æ·éµ

3. **é€€å‡ºéŠæˆ²**
   - è¼¸å…¥ `exit` æˆ– `quit`
   - è¨­å®šæœƒè‡ªå‹•ä¿å­˜åˆ° `worlds/settings.json`

4. **é‡æ–°å•Ÿå‹•éŠæˆ²**
   ```bash
   cargo run
   ```
   - âœ… å°åœ°åœ–æ‡‰è©²è‡ªå‹•é–‹å•Ÿä¸¦é¡¯ç¤ºå…§å®¹
   - âœ… å¯ä»¥åœ¨å³ä¸Šè§’çœ‹åˆ°ä½ç½®å’Œå‘¨åœåœ°å½¢ä¿¡æ¯

## é©—è­‰çµæœ

### å•Ÿå‹•æ™‚çš„è¼¸å‡º
```
è¼‰å…¥è¨­å®š: show_minimap = true
å°åœ°åœ–å·²é–‹å•Ÿ
âœ… è¼‰å…¥äº† 5 å€‹äº‹ä»¶
...
```

### ç•«é¢å³ä¸Šè§’é¡¯ç¤º
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã€ä½ç½®: (50, 50)ã€‘           â”‚
â”‚ â†‘ èŒ‚å¯†çš„æ£®æ— âœ“              â”‚
â”‚ â†“ ç©ºæ› çš„å¹³åŸ âœ“              â”‚
â”‚ â† é™¡å³­çš„å±±å£ âœ—              â”‚
â”‚ â†’ æ¸…æ¾ˆçš„æºªæµ âœ“              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## é¡å¤–æ”¹é€²

### èª¿è©¦è¼¸å‡º
æ·»åŠ äº†èª¿è©¦è¨Šæ¯ä¾†ç¢ºèªè¨­å®šè¼‰å…¥ï¼š
```rust
output_manager.print(format!("è¼‰å…¥è¨­å®š: show_minimap = {}", game_settings.show_minimap));
if game_settings.show_minimap {
    output_manager.show_minimap();
    output_manager.print("å°åœ°åœ–å·²é–‹å•Ÿ".to_string());
}
```

### è¨­å®šæª”ä½ç½®
```
worlds/settings.json
```

### è¨­å®šæª”æ ¼å¼
```json
{
  "show_minimap": true
}
```

## ç›¸é—œåŠŸèƒ½

### å°åœ°åœ–æ“ä½œ
- **é–‹å•Ÿ/é—œé–‰**ï¼šè¼¸å…¥ `minimap` å‘½ä»¤
- **ç‹€æ…‹æŒä¹…åŒ–**ï¼šè‡ªå‹•ä¿å­˜åˆ° `worlds/settings.json`
- **è‡ªå‹•æ¢å¾©**ï¼šå•Ÿå‹•æ™‚è‡ªå‹•è¼‰å…¥ä¸¦åˆå§‹åŒ–

### é¡¯ç¤ºå…§å®¹
- ç•¶å‰åº§æ¨™ä½ç½®
- ä¸Šä¸‹å·¦å³å››å€‹æ–¹å‘çš„åœ°å½¢
- åœ°å½¢å¯è¡Œèµ°ç‹€æ…‹ï¼ˆâœ“ å¯èµ° / âœ— ä¸å¯èµ°ï¼‰

## æŠ€è¡“ç´°ç¯€

### ç‹€æ…‹ç®¡ç†
```rust
pub struct OutputManager {
    show_minimap: bool,         // æ˜¯å¦é¡¯ç¤ºå°åœ°åœ–
    minimap_lines: Vec<String>, // å°åœ°åœ–å…§å®¹
    // ...
}
```

### ä¿å­˜æµç¨‹
```
éŠæˆ²é€€å‡º
â””â”€> run_main_loop è¿”å›
    â””â”€> app.rs çš„é€€å‡ºè™•ç†
        â””â”€> GameSettings::save()
            â””â”€> å¯«å…¥ worlds/settings.json
```

### è¼‰å…¥æµç¨‹
```
éŠæˆ²å•Ÿå‹•
â””â”€> main.rs
    â”œâ”€> GameSettings::load()
    â”‚   â””â”€> è®€å– worlds/settings.json
    â”œâ”€> show_minimap() è¨­ç½®ç‹€æ…‹
    â””â”€> update_minimap() åˆå§‹åŒ–å…§å®¹ âœ¨ æ–°å¢
```

## å·²çŸ¥é™åˆ¶

1. **å…§å®¹æ›´æ–°**ï¼šå°åœ°åœ–å…§å®¹åœ¨ç§»å‹•æ™‚æ‰æ›´æ–°
2. **é¡¯ç¤ºç¯„åœ**ï¼šåªé¡¯ç¤ºä¸Šä¸‹å·¦å³å››å€‹æ–¹å‘
3. **ä¿å­˜æ™‚æ©Ÿ**ï¼šåªåœ¨éŠæˆ²æ­£å¸¸é€€å‡ºæ™‚ä¿å­˜

## æœªä¾†æ”¹é€²

- [ ] å¢åŠ å°åœ°åœ–çš„é¡¯ç¤ºç¯„åœï¼ˆ3x3 æˆ– 5x5ï¼‰
- [ ] å¯¦æ™‚æ›´æ–°å°åœ°åœ–å…§å®¹
- [ ] æ·»åŠ æ›´å¤šè¦–è¦ºå…ƒç´ ï¼ˆé¡è‰²ã€åœ–æ¨™ï¼‰
- [ ] æ”¯æŒå°åœ°åœ–å¤§å°èª¿æ•´

---

**å•é¡Œå·²ä¿®å¾©ï¼** âœ… å°åœ°åœ–ç‹€æ…‹ç¾åœ¨å¯ä»¥æ­£ç¢ºä¿å­˜å’Œæ¢å¾©äº†ã€‚
# äº‹ä»¶ç³»çµ±è¨­è¨ˆæ–‡ä»¶

## æ¦‚å¿µ

åŸºæ–¼ã€Œäººäº‹æ™‚åœ°ç‰©ã€åŸå‰‡çš„è…³æœ¬åŒ–äº‹ä»¶ç³»çµ±ï¼Œæ”¯æŒæ™‚é–“è§¸ç™¼å’Œéš¨æ©ŸåŸ·è¡Œã€‚

## äº‹ä»¶è…³æœ¬çµæ§‹

```json
{
  "id": "event_001",
  "name": "å•†äººåˆ°è¨ª",
  "description": "æ—…è¡Œå•†äººä¾†åˆ°åŸé®",
  
  // æ™‚é–“è§¸ç™¼æ¢ä»¶ï¼ˆé¡ä¼¼ crontabï¼‰
  "trigger": {
    "type": "time",  // time | random | location | condition
    "schedule": "*/10 * * * *",  // æ¯10åˆ†é˜
    "random_chance": 0.3,  // 30% æ©Ÿç‡è§¸ç™¼ï¼ˆå¯é¸ï¼‰
    "day_range": [1, 7],  // éŠæˆ²ç¬¬1-7å¤©
    "time_range": ["09:00:00", "18:00:00"]  // ç™½å¤©æ™‚æ®µ
  },
  
  // äººï¼ˆè§’è‰²æ¢ä»¶ï¼‰
  "who": {
    "player_present": true,  // ç©å®¶æ˜¯å¦åœ¨å ´
    "npcs": ["merchant_01"],  // ç›¸é—œ NPC
    "player_level": {"min": 1, "max": 10}  // ç©å®¶ç­‰ç´šç¯„åœ
  },
  
  // åœ°ï¼ˆåœ°é»æ¢ä»¶ï¼‰
  "where": {
    "map": "åˆå§‹ä¹‹åœ°",  // åœ°åœ–åç¨±
    "positions": [[10, 10], [11, 10]],  // ç‰¹å®šåº§æ¨™
    "area": {"x": [5, 15], "y": [5, 15]}  // å€åŸŸç¯„åœ
  },
  
  // ç‰©ï¼ˆç‰©å“æ¢ä»¶ï¼‰
  "what": {
    "required_items": ["å¤è€çš„é‘°åŒ™"],  // ç©å®¶éœ€æ“æœ‰çš„ç‰©å“
    "map_objects": ["å¯¶ç®±"]  // åœ°åœ–ä¸Šéœ€å­˜åœ¨çš„ç‰©å“
  },
  
  // äº‹ï¼ˆäº‹ä»¶åŸ·è¡Œå…§å®¹ï¼‰
  "actions": [
    {
      "type": "spawn_npc",
      "npc_id": "merchant_01",
      "position": [10, 10],
      "dialogue": "ä½ å¥½ï¼Œæ—…è¡Œè€…ï¼"
    },
    {
      "type": "message",
      "text": "ä¸€ä½å•†äººå‡ºç¾åœ¨å»£å ´ä¸Š"
    },
    {
      "type": "add_item",
      "item": "ç¥ç§˜è—¥æ°´",
      "position": [12, 12]
    }
  ],
  
  // äº‹ä»¶ç‹€æ…‹
  "state": {
    "repeatable": true,  // æ˜¯å¦å¯é‡è¤‡è§¸ç™¼
    "cooldown": 600,  // å†·å»æ™‚é–“ï¼ˆç§’ï¼‰
    "max_triggers": -1,  // æœ€å¤§è§¸ç™¼æ¬¡æ•¸ï¼ˆ-1 = ç„¡é™ï¼‰
    "prerequisites": ["event_000"]  // å‰ç½®äº‹ä»¶
  }
}
```

## è§¸ç™¼å™¨é¡å‹

1. **time** - æ™‚é–“è§¸ç™¼ï¼ˆcrontab æ ¼å¼ï¼‰
2. **random** - éš¨æ©Ÿè§¸ç™¼
3. **location** - é€²å…¥ç‰¹å®šä½ç½®è§¸ç™¼
4. **condition** - æ¢ä»¶è§¸ç™¼ï¼ˆç‰©å“ã€ç‹€æ…‹ç­‰ï¼‰
5. **manual** - æ‰‹å‹•è§¸ç™¼ï¼ˆè…³æœ¬èª¿ç”¨ï¼‰

## å‹•ä½œé¡å‹

1. **spawn_npc** - ç”Ÿæˆ NPC
2. **remove_npc** - ç§»é™¤ NPC
3. **message** - é¡¯ç¤ºè¨Šæ¯
4. **dialogue** - è§¸ç™¼å°è©±
5. **add_item** - æ·»åŠ ç‰©å“
6. **remove_item** - ç§»é™¤ç‰©å“
7. **change_weather** - æ”¹è®Šå¤©æ°£
8. **teleport** - å‚³é€ç©å®¶
9. **quest** - è§¸ç™¼ä»»å‹™
10. **script** - åŸ·è¡Œè‡ªå®šç¾©è…³æœ¬

## æª”æ¡ˆçµæ§‹

```
worlds/åˆå§‹ä¸–ç•Œ/
â”œâ”€â”€ events/
â”‚   â”œâ”€â”€ time_based/
â”‚   â”‚   â”œâ”€â”€ daily_merchant.json
â”‚   â”‚   â””â”€â”€ night_patrol.json
â”‚   â”œâ”€â”€ random/
â”‚   â”‚   â”œâ”€â”€ treasure_spawn.json
â”‚   â”‚   â””â”€â”€ monster_attack.json
â”‚   â”œâ”€â”€ location/
â”‚   â”‚   â”œâ”€â”€ enter_forest.json
â”‚   â”‚   â””â”€â”€ discover_cave.json
â”‚   â””â”€â”€ conditional/
â”‚       â”œâ”€â”€ key_found.json
â”‚       â””â”€â”€ quest_complete.json
â””â”€â”€ maps/
    â””â”€â”€ åˆå§‹ä¹‹åœ°.json
```

## Crontab æ ¼å¼èªªæ˜

```
åˆ† æ™‚ æ—¥ æœˆ æ˜ŸæœŸ
* * * * *

ç¯„ä¾‹ï¼š
"0 * * * *"      - æ¯å°æ™‚æ•´é»
"*/10 * * * *"   - æ¯10åˆ†é˜
"0 9-17 * * *"   - æ¯å¤© 9:00-17:00 çš„æ•´é»
"0 12 * * 1-5"   - é€±ä¸€åˆ°é€±äº”çš„ä¸­åˆ12é»
```

## å¯¦ç¾æ­¥é©Ÿ

1. å‰µå»ºäº‹ä»¶æ•¸æ“šçµæ§‹
2. å¯¦ç¾äº‹ä»¶èª¿åº¦å™¨ï¼ˆEvent Schedulerï¼‰
3. å¯¦ç¾äº‹ä»¶æ¢ä»¶æª¢æŸ¥å™¨
4. å¯¦ç¾äº‹ä»¶åŸ·è¡Œå™¨
5. å‰µå»ºäº‹ä»¶è…³æœ¬åŠ è¼‰å™¨
6. æ•´åˆåˆ°éŠæˆ²ä¸»å¾ªç’°
# äº‹ä»¶ç³»çµ±æ•´åˆå®Œæˆ

## âœ… å·²å®Œæˆçš„æ•´åˆå·¥ä½œ

### 1. GameWorld æ•´åˆ
åœ¨ `src/world.rs` ä¸­ï¼š
- æ·»åŠ  `event_manager: EventManager` æ¬„ä½
- æ·»åŠ  `event_scheduler: EventScheduler` æ¬„ä½
- åœ¨ `GameWorld::new()` ä¸­åˆå§‹åŒ–äº‹ä»¶ç³»çµ±

### 2. ä¸»å¾ªç’°æ•´åˆ
åœ¨ `src/app.rs` ä¸­ï¼š
- æ¯ç§’æª¢æŸ¥ä¸¦è§¸ç™¼äº‹ä»¶
- é¡¯ç¤ºäº‹ä»¶è§¸ç™¼è¨Šæ¯ï¼ŒåŒ…å«ä½ç½®æè¿°
- åŸ·è¡Œäº‹ä»¶å‹•ä½œ
- æ–°å¢ `check_and_execute_events()` å‡½æ•¸
- æ–°å¢ `get_event_location_info()` å‡½æ•¸ç²å–ä½ç½®æè¿°
- æ–°å¢ `check_event_trigger()` å’Œ `check_event_conditions()` å‡½æ•¸

### 3. äº‹ä»¶è¼‰å…¥
åœ¨ `src/main.rs` ä¸­ï¼š
- å•Ÿå‹•æ™‚è‡ªå‹•è¼‰å…¥ `worlds/åˆå§‹ä¸–ç•Œ/events/` ç›®éŒ„ä¸‹çš„æ‰€æœ‰äº‹ä»¶
- é¡¯ç¤ºè¼‰å…¥çš„äº‹ä»¶æ•¸é‡

### 4. äº‹ä»¶è¼¸å‡ºæ ¼å¼
äº‹ä»¶è§¸ç™¼æ™‚æœƒé¡¯ç¤ºï¼š
```
ğŸ­ äº‹ä»¶: å•†äººåˆ°è¨ª åœ¨ åˆå§‹ä¹‹åœ°(50, 50) - ç©ºæ› çš„å»£å ´
```
åŒ…å«ï¼š
- äº‹ä»¶åç¨±
- åœ°åœ–åç¨±
- åº§æ¨™
- è©²åº§æ¨™çš„åœ°é»æè¿°

## ğŸ“ å·²å‰µå»ºçš„äº‹ä»¶è…³æœ¬

### 1. merchant_visit.jsonï¼ˆå•†äººåˆ°è¨ªï¼‰
- **è§¸ç™¼**ï¼šæ¯ 5 åˆ†é˜ï¼Œç™½å¤©æ™‚æ®µï¼ˆ9:00-18:00ï¼‰
- **ä½ç½®**ï¼šåˆå§‹ä¹‹åœ° (50, 50)
- **æ•ˆæœ**ï¼šå•†äººå‡ºç¾ï¼Œé¡¯ç¤ºå°è©±

### 2. treasure_spawn.jsonï¼ˆç¥ç§˜å¯¶è—ï¼‰
- **è§¸ç™¼**ï¼šæ¯ 3 åˆ†é˜ï¼Œ30% æ©Ÿç‡
- **ä½ç½®**ï¼šåˆå§‹ä¹‹åœ° (30, 30)
- **æ•ˆæœ**ï¼šç”Ÿæˆç¥ç§˜å¯¶ç®±ï¼Œé¡¯ç¤ºæç¤ºè¨Šæ¯
- **å†·å»**ï¼š3 åˆ†é˜

### 3. hourly_bell.jsonï¼ˆæ•´é»é˜è²ï¼‰
- **è§¸ç™¼**ï¼šæ¯å°æ™‚æ•´é»
- **ä½ç½®**ï¼šåˆå§‹ä¹‹åœ°
- **æ•ˆæœ**ï¼šé¡¯ç¤ºé˜è²è¨Šæ¯

### 4. discover_shrine.jsonï¼ˆç™¼ç¾ç¥æ®¿ï¼‰
- **è§¸ç™¼**ï¼šé€²å…¥ä½ç½® (25, 25)
- **ä½ç½®**ï¼šåˆå§‹ä¹‹åœ° (25, 25)
- **æ•ˆæœ**ï¼šé¡¯ç¤ºç™¼ç¾è¨Šæ¯
- **é™åˆ¶**ï¼šåªè§¸ç™¼ä¸€æ¬¡

### 5. morning_event.jsonï¼ˆæ¸…æ™¨å•å€™ï¼‰
- **è§¸ç™¼**ï¼šæ¯å¤© 9:00
- **ä½ç½®**ï¼šåˆå§‹ä¹‹åœ°
- **æ•ˆæœ**ï¼šé¡¯ç¤ºæ—©æ™¨å•å€™

## ğŸ® æ¸¬è©¦æ–¹å¼

1. **å•Ÿå‹•éŠæˆ²**
   ```bash
   cargo run --release
   ```

2. **è§€å¯Ÿäº‹ä»¶**
   - ç­‰å¾…å¹¾åˆ†é˜ï¼Œè§€å¯Ÿå•†äººåˆ°è¨ªäº‹ä»¶ï¼ˆæ¯5åˆ†é˜ï¼‰
   - è§€å¯Ÿæ•´é»é˜è²äº‹ä»¶ï¼ˆæ¯å°æ™‚ï¼‰
   - è§€å¯Ÿéš¨æ©Ÿå¯¶è—äº‹ä»¶ï¼ˆæ¯3åˆ†é˜ï¼Œ30%æ©Ÿç‡ï¼‰

3. **ç§»å‹•åˆ°ç‰¹æ®Šä½ç½®**
   - ä½¿ç”¨æ–¹å‘éµç§»å‹•
   - ç§»å‹•åˆ° (25, 25) è§¸ç™¼ç™¼ç¾ç¥æ®¿äº‹ä»¶
   - ç§»å‹•åˆ° (30, 30) å¯èƒ½ç™¼ç¾å¯¶ç®±
   - ç§»å‹•åˆ° (50, 50) çœ‹å•†äºº

4. **æŸ¥çœ‹æ™‚é–“**
   - è§€å¯Ÿç‹€æ…‹åˆ—çš„æ™‚é–“é¡¯ç¤º
   - ç­‰å¾… 9:00 çœ‹æ—©æ™¨å•å€™äº‹ä»¶

## ğŸ“Š äº‹ä»¶è§¸ç™¼æ©Ÿåˆ¶

### æ™‚é–“æª¢æŸ¥
```
æ¯ç§’ï¼ˆ1ç¾å¯¦ç§’ = 60éŠæˆ²ç§’ï¼‰
â””â”€> æª¢æŸ¥æ˜¯å¦é€²å…¥æ–°çš„åˆ†é˜
    â””â”€> éæ­·æ‰€æœ‰äº‹ä»¶
        â”œâ”€> æª¢æŸ¥é‹è¡Œæ™‚ç‹€æ…‹ï¼ˆå†·å»ã€æ¬¡æ•¸ï¼‰
        â”œâ”€> æª¢æŸ¥è§¸ç™¼å™¨ï¼ˆCrontab è¡¨é”å¼ï¼‰
        â”œâ”€> æª¢æŸ¥æ¢ä»¶ï¼ˆåœ°åœ–ã€ä½ç½®ã€ç‰©å“ï¼‰
        â””â”€> åŸ·è¡Œäº‹ä»¶å‹•ä½œ
```

### è¼¸å‡ºæ ¼å¼
```
ğŸ­ äº‹ä»¶: [äº‹ä»¶åç¨±] åœ¨ [åœ°åœ–å](x, y) - [åœ°é»æè¿°]
ğŸ“¢ [äº‹ä»¶è¨Šæ¯]
ğŸ‘¤ [NPCå‹•ä½œ]
ğŸ [ç‰©å“å‹•ä½œ]
```

## ğŸ”§ æ·»åŠ æ–°äº‹ä»¶

### 1. å‰µå»º JSON æ–‡ä»¶
åœ¨ `worlds/åˆå§‹ä¸–ç•Œ/events/` å°æ‡‰ç›®éŒ„ä¸‹å‰µå»º `.json` æ–‡ä»¶

### 2. äº‹ä»¶æ¨¡æ¿
```json
{
  "id": "unique_event_id",
  "name": "äº‹ä»¶åç¨±",
  "description": "äº‹ä»¶æè¿°",
  "trigger": {
    "type": "time",
    "schedule": "*/10 * * * *"
  },
  "where": {
    "map": "åˆå§‹ä¹‹åœ°",
    "positions": [[x, y]]
  },
  "actions": [
    {
      "type": "message",
      "text": "äº‹ä»¶è¨Šæ¯"
    }
  ],
  "state": {
    "repeatable": true,
    "cooldown": 0,
    "max_triggers": -1,
    "prerequisites": []
  }
}
```

### 3. é‡æ–°å•Ÿå‹•éŠæˆ²
äº‹ä»¶æœƒè‡ªå‹•è¼‰å…¥

## ğŸ¯ äº‹ä»¶é¡å‹ç¯„ä¾‹

### å®šæ™‚äº‹ä»¶
```json
"trigger": {
  "type": "time",
  "schedule": "0 12 * * *"  // æ¯å¤©ä¸­åˆ12é»
}
```

### éš¨æ©Ÿäº‹ä»¶
```json
"trigger": {
  "type": "time",
  "schedule": "*/5 * * * *",
  "random_chance": 0.5  // 50%æ©Ÿç‡
}
```

### æ™‚æ®µé™åˆ¶
```json
"trigger": {
  "type": "time",
  "schedule": "0 * * * *",
  "time_range": ["09:00:00", "18:00:00"]  // ç™½å¤©
}
```

### ä½ç½®é™åˆ¶
```json
"where": {
  "map": "åˆå§‹ä¹‹åœ°",
  "positions": [[10, 20], [10, 21]]  // å¤šå€‹ä½ç½®
}
```

### å€åŸŸé™åˆ¶
```json
"where": {
  "map": "åˆå§‹ä¹‹åœ°",
  "area": {
    "x": [10, 20],
    "y": [10, 20]
  }
}
```

### ç‰©å“éœ€æ±‚
```json
"what": {
  "required_items": ["å¤è€çš„é‘°åŒ™", "ç¥ç§˜åœ°åœ–"]
}
```

## ğŸš€ æœªä¾†æ“´å±•

### å·²æº–å‚™ä½†æœªå¯¦ç¾
- [ ] ä½ç½®è§¸ç™¼äº‹ä»¶ï¼ˆéœ€è¦åœ¨ç§»å‹•æ™‚èª¿ç”¨æª¢æŸ¥ï¼‰
- [ ] NPC çœŸå¯¦ç”Ÿæˆå’Œç§»é™¤ï¼ˆç›®å‰åªæœ‰è¨Šæ¯ï¼‰
- [ ] äº‹ä»¶ç‹€æ…‹æŒä¹…åŒ–ä¿å­˜
- [ ] æ›´å¤šå‹•ä½œé¡å‹ï¼ˆå¤©æ°£ã€éŸ³æ•ˆç­‰ï¼‰

### å¯ä»¥ç«‹å³æ“´å±•
- âœ… æ·»åŠ æ›´å¤šäº‹ä»¶è…³æœ¬
- âœ… èª¿æ•´è§¸ç™¼é »ç‡
- âœ… è¨­è¨ˆäº‹ä»¶éˆ
- âœ… å‰µå»ºæ¯æ—¥/æ¯é€±äº‹ä»¶

## ğŸ“ æ³¨æ„äº‹é …

1. **æ™‚é–“æµé€Ÿ**ï¼š1 ç¾å¯¦ç§’ = 60 éŠæˆ²ç§’
2. **åˆ†é˜æª¢æŸ¥**ï¼šäº‹ä»¶æ¯éŠæˆ²åˆ†é˜æª¢æŸ¥ä¸€æ¬¡ï¼ˆç´„ 1 ç¾å¯¦ç§’ï¼‰
3. **å†·å»æ™‚é–“**ï¼šä»¥éŠæˆ²ç§’ç‚ºå–®ä½
4. **åº§æ¨™ç³»çµ±**ï¼š0-basedï¼Œå·¦ä¸Šè§’ç‚º (0, 0)
5. **äº‹ä»¶ ID**ï¼šå¿…é ˆå”¯ä¸€

## ğŸŠ ç³»çµ±å·²å°±ç·’

äº‹ä»¶ç³»çµ±å·²å®Œå…¨æ•´åˆåˆ°éŠæˆ²ä¸­ï¼Œå¯ä»¥é–‹å§‹å‰µé€ è±å¯Œçš„éŠæˆ²å…§å®¹ï¼
åªéœ€ç·¨å¯« JSON è…³æœ¬ï¼Œç„¡éœ€ä¿®æ”¹ä»£ç¢¼å³å¯æ·»åŠ æ–°äº‹ä»¶ã€‚
# äº‹ä»¶ç³»çµ±ä½¿ç”¨æŒ‡å—

## å·²å¯¦ç¾çš„åŠŸèƒ½

### 1. æ ¸å¿ƒæ¨¡çµ„

- âœ… **event.rs** - äº‹ä»¶æ•¸æ“šçµæ§‹
- âœ… **event_scheduler.rs** - äº‹ä»¶èª¿åº¦å™¨ï¼ˆæ™‚é–“è§¸ç™¼ã€Crontab è§£æï¼‰
- âœ… **event_executor.rs** - äº‹ä»¶åŸ·è¡Œå™¨
- âœ… **event_loader.rs** - äº‹ä»¶åŠ è¼‰å™¨

### 2. æ”¯æŒçš„è§¸ç™¼å™¨é¡å‹

| é¡å‹ | èªªæ˜ | ç¯„ä¾‹ |
|------|------|------|
| `time` | æ™‚é–“è§¸ç™¼ï¼ˆCrontabï¼‰ | æ¯10åˆ†é˜ã€æ¯å°æ™‚ |
| `random` | éš¨æ©Ÿè§¸ç™¼ | 30%æ©Ÿç‡ |
| `location` | ä½ç½®è§¸ç™¼ | é€²å…¥ç‰¹å®šåº§æ¨™ |
| `condition` | æ¢ä»¶è§¸ç™¼ | æŒæœ‰ç‰¹å®šç‰©å“ |
| `manual` | æ‰‹å‹•è§¸ç™¼ | è…³æœ¬èª¿ç”¨ |

### 3. æ”¯æŒçš„å‹•ä½œé¡å‹

| å‹•ä½œ | èªªæ˜ |
|------|------|
| `spawn_npc` | ç”Ÿæˆ NPC |
| `remove_npc` | ç§»é™¤ NPC |
| `message` | é¡¯ç¤ºè¨Šæ¯ |
| `dialogue` | NPC å°è©± |
| `add_item` | æ·»åŠ ç‰©å“åˆ°åœ°åœ– |
| `remove_item` | ç§»é™¤åœ°åœ–ç‰©å“ |
| `teleport` | å‚³é€ç©å®¶ |

## äº‹ä»¶è…³æœ¬ç¯„ä¾‹

### ç¯„ä¾‹ 1: å®šæ™‚äº‹ä»¶ï¼ˆæ¯5åˆ†é˜çš„å•†äººåˆ°è¨ªï¼‰

```json
{
  "id": "merchant_visit",
  "name": "å•†äººåˆ°è¨ª",
  "description": "æ—…è¡Œå•†äººå®šæœŸä¾†åˆ°åŸé®å»£å ´",
  "trigger": {
    "type": "time",
    "schedule": "*/5 * * * *",
    "time_range": ["09:00:00", "18:00:00"]
  },
  "where": {
    "map": "åˆå§‹ä¹‹åœ°"
  },
  "actions": [
    {
      "type": "message",
      "text": "ä¸€ä½å•†äººä¾†åˆ°äº†å»£å ´"
    },
    {
      "type": "spawn_npc",
      "npc_id": "merchant_01",
      "position": [50, 50],
      "dialogue": "æ­¡è¿ï¼çœ‹çœ‹æˆ‘çš„å•†å“å§ï¼"
    }
  ],
  "state": {
    "repeatable": true,
    "cooldown": 0,
    "max_triggers": -1,
    "prerequisites": []
  }
}
```

### ç¯„ä¾‹ 2: éš¨æ©Ÿäº‹ä»¶ï¼ˆå¯¶è—å‡ºç¾ï¼‰

```json
{
  "id": "random_treasure",
  "name": "ç¥ç§˜å¯¶è—",
  "description": "éš¨æ©Ÿåœ°é»å‡ºç¾å¯¶è—",
  "trigger": {
    "type": "time",
    "schedule": "*/5 * * * *",
    "random_chance": 0.3
  },
  "where": {
    "map": "åˆå§‹ä¹‹åœ°"
  },
  "actions": [
    {
      "type": "add_item",
      "item": "ç¥ç§˜å¯¶ç®±",
      "position": [30, 30]
    },
    {
      "type": "message",
      "text": "ä½ æ„Ÿè¦ºåˆ°é™„è¿‘æœ‰ä»€éº¼ç‰¹åˆ¥çš„æ±è¥¿..."
    }
  ],
  "state": {
    "repeatable": true,
    "cooldown": 300,
    "max_triggers": -1,
    "prerequisites": []
  }
}
```

### ç¯„ä¾‹ 3: ä½ç½®äº‹ä»¶ï¼ˆç™¼ç¾ç¥æ®¿ï¼‰

```json
{
  "id": "discover_shrine",
  "name": "ç™¼ç¾ç¥æ®¿",
  "description": "ç©å®¶ç™¼ç¾å¤è€çš„ç¥æ®¿",
  "trigger": {
    "type": "location",
    "positions": [[25, 25]]
  },
  "actions": [
    {
      "type": "message",
      "text": "ä½ ç™¼ç¾äº†ä¸€åº§å¤è€çš„ç¥æ®¿ï¼"
    }
  ],
  "state": {
    "repeatable": false,
    "cooldown": 0,
    "max_triggers": 1,
    "prerequisites": []
  }
}
```

## Crontab æ ¼å¼èªªæ˜

```
åˆ† æ™‚ æ—¥ æœˆ æ˜ŸæœŸ
* * * * *
```

| æ¬„ä½ | ç¯„åœ | èªªæ˜ |
|------|------|------|
| åˆ† | 0-59 | åˆ†é˜ |
| æ™‚ | 0-23 | å°æ™‚ |
| æ—¥ | 1-31 | æ—¥æœŸï¼ˆæš«æœªå¯¦ç¾ï¼‰ |
| æœˆ | 1-12 | æœˆä»½ï¼ˆæš«æœªå¯¦ç¾ï¼‰ |
| æ˜ŸæœŸ | 0-6 | æ˜ŸæœŸï¼ˆæš«æœªå¯¦ç¾ï¼‰ |

### ç‰¹æ®Šå­—ç¬¦

- `*` - ä»»æ„å€¼
- `*/N` - æ¯ N å–®ä½
- `N-M` - ç¯„åœ
- `N` - å…·é«”å€¼

### ç¯„ä¾‹

| è¡¨é”å¼ | èªªæ˜ |
|--------|------|
| `*/10 * * * *` | æ¯ 10 åˆ†é˜ |
| `0 * * * *` | æ¯å°æ™‚æ•´é» |
| `0 9-17 * * *` | 9:00-17:00 çš„æ•´é» |
| `30 12 * * *` | æ¯å¤© 12:30 |

## æª”æ¡ˆçµæ§‹

```
worlds/åˆå§‹ä¸–ç•Œ/
â”œâ”€â”€ events/
â”‚   â”œâ”€â”€ time_based/          # æ™‚é–“è§¸ç™¼äº‹ä»¶
â”‚   â”‚   â””â”€â”€ merchant_visit.json
â”‚   â”œâ”€â”€ random/              # éš¨æ©Ÿäº‹ä»¶
â”‚   â”‚   â””â”€â”€ treasure_spawn.json
â”‚   â”œâ”€â”€ location/            # ä½ç½®è§¸ç™¼äº‹ä»¶
â”‚   â”‚   â””â”€â”€ discover_shrine.json
â”‚   â””â”€â”€ conditional/         # æ¢ä»¶äº‹ä»¶
â”‚       â””â”€â”€ key_found.json
â””â”€â”€ maps/
    â””â”€â”€ åˆå§‹ä¹‹åœ°.json
```

## ä¸‹ä¸€æ­¥æ•´åˆ

è¦åœ¨éŠæˆ²ä¸­å•Ÿç”¨äº‹ä»¶ç³»çµ±ï¼Œéœ€è¦ï¼š

1. åœ¨ `GameWorld` ä¸­æ·»åŠ  `EventManager` å’Œ `EventScheduler`
2. åœ¨éŠæˆ²ä¸»å¾ªç’°ä¸­èª¿ç”¨ `event_scheduler.check_and_trigger()`
3. åœ¨ç§»å‹•æ™‚æª¢æŸ¥ä½ç½®è§¸ç™¼äº‹ä»¶
4. å°‡ `EventExecutor` æ•´åˆåˆ°äº‹ä»¶è§¸ç™¼æµç¨‹

## æœªä¾†æ“´å±•

- [ ] æ”¯æŒæ›´è¤‡é›œçš„æ¢ä»¶è¡¨é”å¼
- [ ] NPC AI æ•´åˆ
- [ ] ä»»å‹™ç³»çµ±æ•´åˆ
- [ ] å°è©±ç³»çµ±
- [ ] å¤©æ°£ç³»çµ±
- [ ] æ—¥æœˆæ˜ŸæœŸçš„å®Œæ•´æ”¯æŒ
- [ ] äº‹ä»¶éˆå’Œå‰ç½®æ¢ä»¶æª¢æŸ¥
- [ ] äº‹ä»¶ç‹€æ…‹æŒä¹…åŒ–
# äº‹ä»¶ç³»çµ±å¯¦ç¾ç¸½çµ

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ ¸å¿ƒæ¶æ§‹ï¼ˆ4å€‹æ–°æ¨¡çµ„ï¼‰

#### **src/event.rs** - äº‹ä»¶æ•¸æ“šçµæ§‹
- `TriggerType` - 5ç¨®è§¸ç™¼å™¨é¡å‹ï¼ˆtime, random, location, condition, manualï¼‰
- `WhoCondition` - äººç‰©æ¢ä»¶ï¼ˆç©å®¶ã€NPCã€ç­‰ç´šï¼‰
- `WhereCondition` - åœ°é»æ¢ä»¶ï¼ˆåœ°åœ–ã€åº§æ¨™ã€å€åŸŸï¼‰
- `WhatCondition` - ç‰©å“æ¢ä»¶ï¼ˆæŒæœ‰ç‰©å“ã€åœ°åœ–ç‰©å“ï¼‰
- `EventAction` - 7ç¨®å‹•ä½œé¡å‹
- `EventState` - äº‹ä»¶ç‹€æ…‹ç®¡ç†ï¼ˆå¯é‡è¤‡ã€å†·å»ã€è§¸ç™¼æ¬¡æ•¸ï¼‰
- `GameEvent` - å®Œæ•´äº‹ä»¶çµæ§‹
- `EventManager` - äº‹ä»¶ç®¡ç†å™¨
- `EventRuntimeState` - é‹è¡Œæ™‚ç‹€æ…‹è¿½è¹¤

#### **src/event_scheduler.rs** - äº‹ä»¶èª¿åº¦å™¨
- `CronParser` - Crontab è¡¨é”å¼è§£æå™¨
  - æ”¯æŒ `*`ï¼ˆä»»æ„ï¼‰
  - æ”¯æŒ `*/N`ï¼ˆæ¯Nå–®ä½ï¼‰
  - æ”¯æŒ `N-M`ï¼ˆç¯„åœï¼‰
  - æ”¯æŒå…·é«”å€¼
- `EventScheduler` - äº‹ä»¶èª¿åº¦é‚è¼¯
  - æ™‚é–“æª¢æŸ¥ï¼ˆæ¯åˆ†é˜ï¼‰
  - éš¨æ©Ÿè§¸ç™¼
  - æ¢ä»¶æª¢æŸ¥ï¼ˆäººäº‹æ™‚åœ°ç‰©ï¼‰
  - ä½ç½®è§¸ç™¼æª¢æŸ¥

#### **src/event_executor.rs** - äº‹ä»¶åŸ·è¡Œå™¨
- åŸ·è¡Œ7ç¨®å‹•ä½œï¼š
  1. spawn_npc - ç”Ÿæˆ NPC
  2. remove_npc - ç§»é™¤ NPC
  3. message - é¡¯ç¤ºè¨Šæ¯
  4. dialogue - NPCå°è©±
  5. add_item - æ·»åŠ åœ°åœ–ç‰©å“
  6. remove_item - ç§»é™¤åœ°åœ–ç‰©å“
  7. teleport - å‚³é€ç©å®¶

#### **src/event_loader.rs** - äº‹ä»¶åŠ è¼‰å™¨
- éè¿´è¼‰å…¥ç›®éŒ„ä¸­çš„æ‰€æœ‰äº‹ä»¶è…³æœ¬
- JSON åºåˆ—åŒ–/ååºåˆ—åŒ–
- ç¯„ä¾‹äº‹ä»¶ç”Ÿæˆå™¨

### 2. æ–‡æª”

- âœ… `EVENT_SYSTEM_DESIGN.md` - è©³ç´°è¨­è¨ˆæ–‡æª”
- âœ… `EVENT_USAGE.md` - ä½¿ç”¨æŒ‡å—å’Œç¯„ä¾‹
- âœ… `EVENT_SYSTEM_SUMMARY.md` - æœ¬æ–‡ä»¶

### 3. ç¯„ä¾‹è…³æœ¬

å·²å‰µå»ºç¤ºç¯„äº‹ä»¶ï¼š
- `worlds/åˆå§‹ä¸–ç•Œ/events/time_based/merchant_visit.json`

## ğŸ¯ è¨­è¨ˆç‰¹é»

### 1. åŸºæ–¼ã€Œäººäº‹æ™‚åœ°ç‰©ã€åŸå‰‡
```
äºº (Who)   - ç©å®¶ã€NPCã€ç­‰ç´šæ¢ä»¶
äº‹ (What)  - äº‹ä»¶å‹•ä½œå’Œç‰©å“æ¢ä»¶
æ™‚ (When)  - æ™‚é–“è§¸ç™¼å™¨ï¼ˆCrontabï¼‰
åœ° (Where) - åœ°åœ–ã€åº§æ¨™ã€å€åŸŸ
ç‰© (What)  - ç‰©å“éœ€æ±‚å’Œæ“ä½œ
```

### 2. é¡ä¼¼ Crontab çš„æ™‚é–“è¡¨é”å¼
```
*/5 * * * *     - æ¯5åˆ†é˜
0 9-17 * * *    - 9:00-17:00 æ¯å°æ™‚
30 12 * * *     - æ¯å¤© 12:30
```

### 3. éˆæ´»çš„è§¸ç™¼æ©Ÿåˆ¶
- æ™‚é–“è§¸ç™¼ + éš¨æ©Ÿæ©Ÿç‡
- æ™‚é–“ç¯„åœé™åˆ¶
- å¤©æ•¸ç¯„åœé™åˆ¶
- ä½ç½®è§¸ç™¼
- æ¢ä»¶è§¸ç™¼

### 4. å®Œæ•´çš„äº‹ä»¶ç‹€æ…‹ç®¡ç†
- å¯é‡è¤‡/ä¸€æ¬¡æ€§
- å†·å»æ™‚é–“
- æœ€å¤§è§¸ç™¼æ¬¡æ•¸
- å‰ç½®æ¢ä»¶æª¢æŸ¥

## ğŸ“ ä½¿ç”¨ç¯„ä¾‹

### ç°¡å–®çš„å®šæ™‚äº‹ä»¶
```json
{
  "id": "merchant_visit",
  "name": "å•†äººåˆ°è¨ª",
  "trigger": {
    "type": "time",
    "schedule": "*/5 * * * *"
  },
  "actions": [
    {"type": "message", "text": "å•†äººä¾†äº†ï¼"}
  ]
}
```

### å¸¶éš¨æ©Ÿæ€§çš„äº‹ä»¶
```json
{
  "trigger": {
    "type": "time",
    "schedule": "*/10 * * * *",
    "random_chance": 0.3
  }
}
```

### è¤‡é›œæ¢ä»¶äº‹ä»¶
```json
{
  "where": {
    "map": "åˆå§‹ä¹‹åœ°",
    "area": {"x": [10, 20], "y": [10, 20]}
  },
  "what": {
    "required_items": ["å¤è€çš„é‘°åŒ™"]
  },
  "trigger": {
    "type": "time",
    "schedule": "0 * * * *",
    "time_range": ["09:00:00", "18:00:00"]
  }
}
```

## ğŸ”§ ä¸‹ä¸€æ­¥æ•´åˆï¼ˆå¾…å¯¦ç¾ï¼‰

1. **æ•´åˆåˆ° GameWorld**
   ```rust
   pub struct GameWorld {
       // ... ç¾æœ‰æ¬„ä½
       pub event_manager: EventManager,
       pub event_scheduler: EventScheduler,
   }
   ```

2. **æ•´åˆåˆ°éŠæˆ²ä¸»å¾ªç’°**
   ```rust
   // åœ¨ app.rs çš„ä¸»å¾ªç’°ä¸­
   let triggered = event_scheduler.check_and_trigger(
       &mut event_manager,
       game_world,
       player
   );
   
   for event_id in triggered {
       if let Some(event) = event_manager.get_event(&event_id) {
           EventExecutor::execute_event(event, game_world, player, output_manager);
       }
   }
   ```

3. **è¼‰å…¥äº‹ä»¶**
   ```rust
   // åœ¨ main.rs åˆå§‹åŒ–æ™‚
   let events_dir = format!("{}/events", game_world.world_dir);
   let count = EventLoader::load_from_directory(&mut event_manager, &events_dir)?;
   ```

4. **ç§»å‹•æ™‚æª¢æŸ¥ä½ç½®è§¸ç™¼**
   ```rust
   // åœ¨ç§»å‹•é‚è¼¯ä¸­
   let location_events = event_scheduler.check_location_trigger(
       &event_manager,
       player.x,
       player.y
   );
   ```

## ğŸš€ æœªä¾†æ“´å±•æ–¹å‘

### çŸ­æœŸ
- [ ] æ•´åˆåˆ°éŠæˆ²ä¸»å¾ªç’°
- [ ] äº‹ä»¶ç‹€æ…‹æŒä¹…åŒ–ï¼ˆä¿å­˜/è¼‰å…¥ï¼‰
- [ ] æ›´å¤šæ¸¬è©¦å’Œç¯„ä¾‹äº‹ä»¶

### ä¸­æœŸ
- [ ] NPC ç³»çµ±å®Œæ•´å¯¦ç¾
- [ ] å°è©±ç³»çµ±
- [ ] ä»»å‹™ç³»çµ±æ•´åˆ
- [ ] æ¢ä»¶è¡¨é”å¼è§£æå™¨

### é•·æœŸ
- [ ] è…³æœ¬èªè¨€æ”¯æŒï¼ˆLua/Rhaiï¼‰
- [ ] å¯è¦–åŒ–äº‹ä»¶ç·¨è¼¯å™¨
- [ ] äº‹ä»¶éˆå’Œè¤‡é›œä¾è³´
- [ ] å‹•æ…‹å¤©æ°£ç³»çµ±
- [ ] AI è¡Œç‚ºæ¨¹æ•´åˆ

## ğŸ“Š ç³»çµ±æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Game World                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     EventManager                â”‚   â”‚
â”‚  â”‚  - events: HashMap              â”‚   â”‚
â”‚  â”‚  - runtime_states: HashMap      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     EventScheduler              â”‚   â”‚
â”‚  â”‚  - check_and_trigger()          â”‚   â”‚
â”‚  â”‚  - check_location_trigger()     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Event JSON Files     â”‚
        â”‚  - time_based/        â”‚
        â”‚  - random/            â”‚
        â”‚  - location/          â”‚
        â”‚  - conditional/       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  EventExecutor        â”‚
        â”‚  - execute_event()    â”‚
        â”‚  - execute_action()   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ’¡ æŠ€è¡“äº®é»

1. **å®Œå…¨è…³æœ¬åŒ–** - ç„¡éœ€é‡æ–°ç·¨è­¯å³å¯æ·»åŠ æ–°äº‹ä»¶
2. **é¡å‹å®‰å…¨** - ä½¿ç”¨ Rust çš„å¼·é¡å‹ç³»çµ±
3. **åºåˆ—åŒ–æ”¯æŒ** - JSON æ ¼å¼æ˜“æ–¼ç·¨è¼¯
4. **éˆæ´»çš„è§¸ç™¼æ©Ÿåˆ¶** - å¤šç¨®è§¸ç™¼æ¢ä»¶çµ„åˆ
5. **ç‹€æ…‹ç®¡ç†** - å®Œæ•´çš„é‹è¡Œæ™‚ç‹€æ…‹è¿½è¹¤
6. **æ¨¡çµ„åŒ–è¨­è¨ˆ** - å„æ¨¡çµ„è·è²¬æ¸…æ™°

## ğŸ“ˆ ä»£ç¢¼çµ±è¨ˆ

- æ–°å¢æ¨¡çµ„ï¼š4 å€‹
- ä»£ç¢¼è¡Œæ•¸ï¼šç´„ 600 è¡Œ
- æ–‡æª”ï¼š3 ä»½
- ç¯„ä¾‹è…³æœ¬ï¼š1 å€‹ï¼ˆå¯å¿«é€Ÿæ“´å±•ï¼‰

äº‹ä»¶ç³»çµ±å·²æº–å‚™å°±ç·’ï¼Œå¯ä»¥é–‹å§‹å‰µå»ºè±å¯Œçš„éŠæˆ²å…§å®¹ï¼ğŸ®
# ğŸ‰ äº‹ä»¶ç³»çµ±æ•´åˆå®Œæˆ - æœ€çµ‚ç¸½çµ

## âœ… å®Œæˆç‹€æ…‹

äº‹ä»¶ç³»çµ±å·²å®Œå…¨æ•´åˆåˆ°éŠæˆ²ä¸»å¾ªç’°ä¸­ï¼Œä¸¦å‰µå»ºäº† 5 å€‹ç¤ºç¯„äº‹ä»¶è…³æœ¬ã€‚

## ğŸ“¦ äº¤ä»˜å…§å®¹

### 1. æ ¸å¿ƒä»£ç¢¼ï¼ˆ4 å€‹æ¨¡çµ„ï¼‰
- âœ… `src/event.rs` - äº‹ä»¶æ•¸æ“šçµæ§‹ï¼ˆ274 è¡Œï¼‰
- âœ… `src/event_scheduler.rs` - äº‹ä»¶èª¿åº¦å™¨ï¼ˆ272 è¡Œï¼‰
- âœ… `src/event_executor.rs` - äº‹ä»¶åŸ·è¡Œå™¨ï¼ˆ157 è¡Œï¼‰
- âœ… `src/event_loader.rs` - äº‹ä»¶åŠ è¼‰å™¨ï¼ˆ195 è¡Œï¼‰

### 2. æ•´åˆä»£ç¢¼
- âœ… `src/world.rs` - æ·»åŠ  EventManager å’Œ EventScheduler
- âœ… `src/app.rs` - ä¸»å¾ªç’°æ•´åˆï¼ˆæ–°å¢ 200+ è¡Œï¼‰
- âœ… `src/main.rs` - äº‹ä»¶è¼‰å…¥é‚è¼¯

### 3. äº‹ä»¶è…³æœ¬ï¼ˆ5 å€‹ï¼‰
```
worlds/åˆå§‹ä¸–ç•Œ/events/
â”œâ”€â”€ time_based/
â”‚   â”œâ”€â”€ merchant_visit.json      âœ… å•†äººåˆ°è¨ªï¼ˆæ¯5åˆ†é˜ï¼‰
â”‚   â”œâ”€â”€ hourly_bell.json         âœ… æ•´é»é˜è²ï¼ˆæ¯å°æ™‚ï¼‰
â”‚   â””â”€â”€ morning_event.json       âœ… æ¸…æ™¨å•å€™ï¼ˆæ¯å¤©9:00ï¼‰
â”œâ”€â”€ random/
â”‚   â””â”€â”€ treasure_spawn.json      âœ… ç¥ç§˜å¯¶è—ï¼ˆæ¯3åˆ†é˜ï¼Œ30%æ©Ÿç‡ï¼‰
â””â”€â”€ location/
    â””â”€â”€ discover_shrine.json     âœ… ç™¼ç¾ç¥æ®¿ï¼ˆä½ç½®è§¸ç™¼ï¼‰
```

### 4. æ–‡æª”ï¼ˆ6 ä»½ï¼‰
- âœ… `EVENT_SYSTEM_DESIGN.md` - è¨­è¨ˆæ–‡æª”
- âœ… `EVENT_USAGE.md` - ä½¿ç”¨æŒ‡å—
- âœ… `EVENT_SYSTEM_SUMMARY.md` - å¯¦ç¾ç¸½çµ
- âœ… `EVENT_INTEGRATION.md` - æ•´åˆèªªæ˜
- âœ… `EVENT_FINAL_SUMMARY.md` - æœ¬æ–‡ä»¶

## ğŸ® å¯¦éš›æ•ˆæœ

### å•Ÿå‹•æ™‚
```
âœ… è¼‰å…¥äº† 5 å€‹äº‹ä»¶
åœ°åœ–å·²åŠ è¼‰: åˆå§‹ä¹‹åœ°
...
```

### äº‹ä»¶è§¸ç™¼ç¤ºä¾‹
```
ğŸ­ äº‹ä»¶: å•†äººåˆ°è¨ª åœ¨ åˆå§‹ä¹‹åœ°(50, 50) - ç©ºæ› çš„å»£å ´
ä¸€ä½å•†äººç·©ç·©èµ°ä¾†ï¼ŒèƒŒè‘—å¤§åŒ…å°åŒ…çš„è²¨ç‰©
ğŸ‘¤ NPC merchant_01 å‡ºç¾åœ¨ (50, 50)
ğŸ’¬ merchant_01: "æ­¡è¿å…‰è‡¨ï¼çœ‹çœ‹æˆ‘å¾é æ–¹å¸¶ä¾†çš„çå¥‡å•†å“å§ï¼"
```

```
ğŸ­ äº‹ä»¶: ç¥ç§˜å¯¶è—å‡ºç¾ åœ¨ åˆå§‹ä¹‹åœ°(30, 30) - èŒ‚å¯†çš„æ£®æ—
åœ°é¢çªç„¶ç™¼å‡ºå¾®å¼±çš„å…‰èŠ’ï¼Œä¼¼ä¹æœ‰ä»€éº¼æ±è¥¿å‡ºç¾äº†...
ğŸ ç¥ç§˜å¯¶ç®± å‡ºç¾åœ¨ (30, 30)
```

```
ğŸ­ äº‹ä»¶: æ•´é»é˜è² åœ¨ åˆå§‹ä¹‹åœ°
ğŸ“¢ ğŸ”” é è™•å‚³ä¾†æ‚ æšçš„é˜è²ï¼Œè¿´ç›ªåœ¨ç©ºæ°£ä¸­...
```

## ğŸ”§ æŠ€è¡“å¯¦ç¾äº®é»

### 1. ä½ç½®æè¿°æ•´åˆ
äº‹ä»¶è§¸ç™¼æ™‚æœƒè‡ªå‹•é¡¯ç¤ºè©²åº§æ¨™çš„åœ°é»æè¿°ï¼š
```rust
if let Some(point) = map.get_point(x, y) {
    format!(" åœ¨ {}({}, {}) - {}", map_name, x, y, point.description)
}
```

### 2. é¿å…å€Ÿç”¨è¡çª
ä½¿ç”¨å…§éƒ¨ä½œç”¨åŸŸå’Œäº‹ä»¶å…‹éš†ä¾†é¿å…è¤‡é›œçš„å€Ÿç”¨å•é¡Œï¼š
```rust
let triggered_events = {
    // æ”¶é›†è§¸ç™¼çš„äº‹ä»¶
    ...
};
// åŸ·è¡Œäº‹ä»¶
for event in triggered_events { ... }
```

### 3. Crontab è¡¨é”å¼è§£æ
æ”¯æŒæ¨™æº–çš„ Crontab æ ¼å¼ï¼š
```
"*/5 * * * *"   - æ¯5åˆ†é˜
"0 9-17 * * *"  - 9:00-17:00 æ¯å°æ™‚
"0 12 * * *"    - æ¯å¤©ä¸­åˆ12é»
```

### 4. éˆæ´»çš„è§¸ç™¼æ¢ä»¶
- æ™‚é–“è§¸ç™¼ + éš¨æ©Ÿæ©Ÿç‡
- æ™‚é–“ç¯„åœé™åˆ¶
- åœ°åœ–å’Œä½ç½®é™åˆ¶
- ç‰©å“éœ€æ±‚æª¢æŸ¥

## ğŸ“Š ç³»çµ±æ¶æ§‹

```
Game Loop (æ¯ç§’)
    â”‚
    â”œâ”€> æ›´æ–°ä¸–ç•Œæ™‚é–“
    â”‚   â””â”€> check_and_execute_events()
    â”‚       â”œâ”€> æª¢æŸ¥æ˜¯å¦é€²å…¥æ–°åˆ†é˜
    â”‚       â”œâ”€> éæ­·æ‰€æœ‰äº‹ä»¶
    â”‚       â”‚   â”œâ”€> æª¢æŸ¥é‹è¡Œæ™‚ç‹€æ…‹
    â”‚       â”‚   â”œâ”€> æª¢æŸ¥è§¸ç™¼å™¨ (Crontab)
    â”‚       â”‚   â”œâ”€> æª¢æŸ¥æ¢ä»¶ (äººäº‹æ™‚åœ°ç‰©)
    â”‚       â”‚   â””â”€> è¨˜éŒ„è§¸ç™¼
    â”‚       â””â”€> åŸ·è¡Œäº‹ä»¶å‹•ä½œ
    â”‚           â”œâ”€> é¡¯ç¤ºä½ç½®ä¿¡æ¯
    â”‚           â”œâ”€> message
    â”‚           â”œâ”€> spawn_npc
    â”‚           â”œâ”€> add_item
    â”‚           â””â”€> å…¶ä»–å‹•ä½œ
    â”‚
    â””â”€> ç¹ªè£½ç•«é¢
```

## ğŸ¯ ä½¿ç”¨æ–¹å¼

### å¿«é€Ÿé–‹å§‹
```bash
# ç·¨è­¯
cargo build --release

# é‹è¡Œ
cargo run --release

# è§€å¯Ÿäº‹ä»¶
# - ç­‰å¾… 5 åˆ†é˜çœ‹å•†äººåˆ°è¨ª
# - ç­‰å¾…æ•´é»çœ‹é˜è²
# - ç§»å‹•åˆ° (25, 25) ç™¼ç¾ç¥æ®¿
```

### æ·»åŠ æ–°äº‹ä»¶
1. åœ¨ `worlds/åˆå§‹ä¸–ç•Œ/events/` å‰µå»º JSON æ–‡ä»¶
2. é‡æ–°å•Ÿå‹•éŠæˆ²
3. äº‹ä»¶è‡ªå‹•è¼‰å…¥

## ğŸ“ˆ ä»£ç¢¼çµ±è¨ˆ

| é …ç›® | æ•¸é‡ |
|------|------|
| æ–°å¢æ¨¡çµ„ | 4 å€‹ |
| æ ¸å¿ƒä»£ç¢¼ | ~900 è¡Œ |
| æ•´åˆä»£ç¢¼ | ~250 è¡Œ |
| äº‹ä»¶è…³æœ¬ | 5 å€‹ |
| æ–‡æª” | 6 ä»½ |
| ç·¨è­¯æ™‚é–“ | ~1.5 ç§’ (release) |

## ğŸŒŸ ç‰¹è‰²åŠŸèƒ½

1. **å®Œå…¨è…³æœ¬åŒ–** - JSON æ ¼å¼ï¼Œç„¡éœ€ç·¨è­¯
2. **ä½ç½®æè¿°æ•´åˆ** - è‡ªå‹•é¡¯ç¤ºåœ°é»æè¿°
3. **Crontab æ”¯æŒ** - éˆæ´»çš„æ™‚é–“è¡¨é”å¼
4. **äººäº‹æ™‚åœ°ç‰©** - å®Œæ•´çš„æ¢ä»¶ç³»çµ±
5. **éš¨æ©Ÿæ©Ÿç‡** - æ”¯æŒéš¨æ©Ÿäº‹ä»¶
6. **ç‹€æ…‹ç®¡ç†** - å†·å»ã€æ¬¡æ•¸ã€å¯é‡è¤‡

## ğŸš€ æœªä¾†æ“´å±•æ–¹å‘

### ç«‹å³å¯ç”¨
- âœ… æ·»åŠ æ›´å¤šäº‹ä»¶è…³æœ¬
- âœ… èª¿æ•´äº‹ä»¶é »ç‡
- âœ… å‰µå»ºäº‹ä»¶éˆ

### éœ€è¦é–‹ç™¼
- [ ] ä½ç½®è§¸ç™¼äº‹ä»¶ï¼ˆç§»å‹•æ™‚æª¢æŸ¥ï¼‰
- [ ] NPC çœŸå¯¦ç³»çµ±
- [ ] äº‹ä»¶ç‹€æ…‹æŒä¹…åŒ–
- [ ] æ›´å¤šå‹•ä½œé¡å‹

## ğŸŠ çµè«–

äº‹ä»¶ç³»çµ±å·²å®Œå…¨æ•´åˆä¸¦å¯ç”¨ï¼

**æ ¸å¿ƒå„ªå‹¢ï¼š**
- ğŸ“ ç´”è…³æœ¬é©…å‹•ï¼Œå¿«é€Ÿè¿­ä»£
- ğŸ® å³æ™‚ç”Ÿæ•ˆï¼Œç„¡éœ€é‡å•Ÿ
- ğŸ—ºï¸  è‡ªå‹•é¡¯ç¤ºä½ç½®ä¿¡æ¯
- âš™ï¸  éˆæ´»å¼·å¤§çš„é…ç½®ç³»çµ±

**ç¾åœ¨å¯ä»¥ï¼š**
- å‰µå»ºè±å¯Œçš„éŠæˆ²äº‹ä»¶
- è¨­è¨ˆè¤‡é›œçš„äº‹ä»¶éˆ
- æ‰“é€ å‹•æ…‹çš„éŠæˆ²ä¸–ç•Œ

---

**ç¥éŠæˆ²é–‹ç™¼é †åˆ©ï¼** ğŸ‰ğŸ®âœ¨
# äº‹ä»¶ç³»çµ±éš¨æ©Ÿä½ç½®æ”¯æ´

## æ–°åŠŸèƒ½

äº‹ä»¶å‹•ä½œä¸­çš„ `position` æ¬„ä½ç¾åœ¨æ”¯æ´éš¨æ©Ÿä½ç½®ï¼

## Position é¡å‹

```rust
pub enum Position {
    Fixed([usize; 2]),  // å›ºå®šä½ç½® [x, y]
    Random(String),     // "random" è¡¨ç¤ºéš¨æ©Ÿä½ç½®
}
```

### è§£æé‚è¼¯

- **å›ºå®šä½ç½®**: ç›´æ¥ä½¿ç”¨æŒ‡å®šçš„åº§æ¨™
- **éš¨æ©Ÿä½ç½®**: å¾åœ°åœ–çš„æ‰€æœ‰å¯è¡Œèµ°é»ä¸­éš¨æ©Ÿé¸æ“‡ä¸€å€‹

## ä½¿ç”¨ç¯„ä¾‹

### 1. å›ºå®šä½ç½® (åŸæœ‰æ–¹å¼)

```json
{
  "id": "treasure_spawn",
  "name": "å¯¶ç®±å‡ºç¾",
  "trigger": {
    "type": "time",
    "schedule": "0 12 * * *"
  },
  "where": {
    "map": "æ£®æ—"
  },
  "actions": [
    {
      "type": "add_item",
      "item": "å¯¶ç®±",
      "position": [50, 50]
    }
  ]
}
```

### 2. éš¨æ©Ÿä½ç½® (æ–°åŠŸèƒ½) âœ¨

```json
{
  "id": "random_npc_spawn",
  "name": "å•†äººéš¨æ©Ÿå‡ºç¾",
  "trigger": {
    "type": "time",
    "schedule": "0 9 * * *"
  },
  "where": {
    "map": "åŸé®"
  },
  "actions": [
    {
      "type": "spawn_npc",
      "npc_id": "wandering_merchant",
      "position": "random",
      "dialogue": "ä»Šå¤©åœ¨ä¸åŒçš„åœ°æ–¹åšç”Ÿæ„ï¼"
    }
  ]
}
```

### 3. éš¨æ©Ÿå¯¶ç‰©æ‰è½

```json
{
  "id": "random_treasure",
  "name": "éš¨æ©Ÿå¯¶ç‰©",
  "trigger": {
    "type": "random",
    "interval_seconds": 3600,
    "chance": 0.3
  },
  "where": {
    "map": "æ´ç©´"
  },
  "actions": [
    {
      "type": "add_item",
      "item": "ç¥ç§˜å¯¶çŸ³",
      "position": "random"
    },
    {
      "type": "message",
      "text": "ä½ æ„Ÿè¦ºåˆ°æŸè™•é–ƒçˆè‘—å…‰èŠ’..."
    }
  ]
}
```

### 4. éš¨æ©Ÿå‚³é€

```json
{
  "id": "random_teleport",
  "name": "éš¨æ©Ÿå‚³é€é™·é˜±",
  "trigger": {
    "type": "location",
    "positions": [[25, 25]]
  },
  "when": {
    "time_range": ["00:00:00", "23:59:59"]
  },
  "where": {
    "map": "è¿·å®®"
  },
  "actions": [
    {
      "type": "message",
      "text": "âš ï¸ ä½ è¸©åˆ°äº†å‚³é€é™£ï¼"
    },
    {
      "type": "teleport",
      "map": "è¿·å®®",
      "position": "random"
    }
  ]
}
```

## æ”¯æ´çš„å‹•ä½œé¡å‹

æ‰€æœ‰åŒ…å« `position` æ¬„ä½çš„å‹•ä½œéƒ½æ”¯æ´éš¨æ©Ÿä½ç½®ï¼š

### âœ… spawn_npc
```json
{
  "type": "spawn_npc",
  "npc_id": "guard",
  "position": "random"
}
```

### âœ… add_item
```json
{
  "type": "add_item",
  "item": "é‡‘å¹£",
  "position": "random"
}
```

### âœ… remove_item
```json
{
  "type": "remove_item",
  "item": "é™·é˜±",
  "position": "random"
}
```

### âœ… teleport
```json
{
  "type": "teleport",
  "map": "æ£®æ—",
  "position": "random"
}
```

## å¯¦ä½œç´°ç¯€

### Position::resolve()

```rust
pub fn resolve(&self, map: &crate::map::Map) -> Option<[usize; 2]> {
    match self {
        Position::Fixed(pos) => Some(*pos),
        Position::Random(_) => {
            let walkable_points = map.get_walkable_points();
            if walkable_points.is_empty() {
                None
            } else {
                use rand::Rng;
                let mut rng = rand::thread_rng();
                let idx = rng.gen_range(0..walkable_points.len());
                Some([walkable_points[idx].0, walkable_points[idx].1])
            }
        }
    }
}
```

### å®‰å…¨æ€§

- **æª¢æŸ¥å¯è¡Œèµ°é»**: åªæœƒé¸æ“‡å¯è¡Œèµ°çš„ä½ç½®
- **éŒ¯èª¤è™•ç†**: å¦‚æœåœ°åœ–æ²’æœ‰å¯è¡Œèµ°é»ï¼Œè¿”å› None
- **æ¯æ¬¡åŸ·è¡Œéƒ½ä¸åŒ**: æ¯æ¬¡äº‹ä»¶è§¸ç™¼éƒ½æœƒé‡æ–°éš¨æ©Ÿé¸æ“‡

## ä½¿ç”¨å ´æ™¯

### ğŸ² å¢åŠ éŠæˆ²è®ŠåŒ–æ€§
- NPC æ¯æ¬¡å‡ºç¾åœ¨ä¸åŒä½ç½®
- å¯¶ç‰©éš¨æ©Ÿæ•£å¸ƒåœ¨åœ°åœ–ä¸Š
- æ€ªç‰©éš¨æ©Ÿç”Ÿæˆ

### ğŸ¯ æ¢ç´¢çå‹µ
- éš±è—å¯¶ç®±éš¨æ©Ÿå‡ºç¾
- ç¨€æœ‰å•†äººä¸å®šæœŸå‡ºç¾
- ç¥ç§˜äº‹ä»¶éš¨æ©Ÿç™¼ç”Ÿ

### âš¡ å‹•æ…‹æŒ‘æˆ°
- éš¨æ©Ÿå‚³é€é™·é˜±
- ä½ç½®ä¸ç¢ºå®šçš„ç›®æ¨™
- è®ŠåŒ–çš„ä»»å‹™ç›®æ¨™é»

### ğŸŒŸ æå‡é‡ç©æ€§
- æ¯æ¬¡éŠç©éƒ½æœ‰ä¸åŒé«”é©—
- ä½ç½®ä¸å¯é æ¸¬
- å¢åŠ æ¢ç´¢æ¨‚è¶£

## å„ªå‹¢

### âœ… å‘å¾Œå…¼å®¹
- åŸæœ‰çš„å›ºå®šä½ç½® `[x, y]` ä»ç„¶æœ‰æ•ˆ
- ç„¡éœ€ä¿®æ”¹ç¾æœ‰äº‹ä»¶æª”æ¡ˆ
- å¹³æ»‘å‡ç´š

### âœ… ç°¡å–®æ˜“ç”¨
- åªéœ€å°‡ `position` æ”¹ç‚º `"random"`
- JSON æ ¼å¼æ¸…æ™°
- å®¹æ˜“ç†è§£

### âœ… å®‰å…¨å¯é 
- è‡ªå‹•æª¢æŸ¥ä½ç½®æœ‰æ•ˆæ€§
- åªé¸æ“‡å¯è¡Œèµ°çš„é»
- éŒ¯èª¤è™•ç†å®Œå–„

### âœ… éˆæ´»å¼·å¤§
- æ”¯æ´æ‰€æœ‰éœ€è¦ä½ç½®çš„å‹•ä½œ
- å¯èˆ‡å…¶ä»–äº‹ä»¶æ¢ä»¶çµåˆ
- å‰µé€ ç„¡é™å¯èƒ½

## æ¸¬è©¦çµæœ
- âœ… ç·¨è­¯æˆåŠŸ
- âœ… æ”¯æ´å›ºå®šä½ç½®ï¼ˆå‘å¾Œå…¼å®¹ï¼‰
- âœ… æ”¯æ´éš¨æ©Ÿä½ç½®ï¼ˆæ–°åŠŸèƒ½ï¼‰
- âœ… æ­£ç¢ºé¸æ“‡å¯è¡Œèµ°ä½ç½®
- âœ… æ‰€æœ‰å‹•ä½œé¡å‹éƒ½æ”¯æ´
# è³‡æ–™ç›¸å®¹æ€§èªªæ˜

## å‘å¾Œå…¼å®¹æ€§ âœ…

æœ¬æ¬¡æ›´æ–°**å®Œå…¨å‘å¾Œå…¼å®¹**ï¼ŒèˆŠçš„å­˜æª”è³‡æ–™å¯ä»¥æ­£å¸¸è¼‰å…¥ã€‚

## å…¼å®¹æ€§è™•ç†

### 1. Item çµæ§‹
**æ–°å¢æ¬„ä½**: `english_name: Option<String>`

```rust
#[derive(Clone, Debug, Serialize, Deserialize)]
pub struct Item {
    pub name: String,
    #[serde(default)]  // ä½¿ç”¨é è¨­å€¼ None
    pub english_name: Option<String>,  // å¯é¸æ¬„ä½
    pub item_type: ItemType,
    pub description: String,
    pub value: u32,
}
```

**å…¼å®¹æ–¹å¼**:
- ä½¿ç”¨ `Option<String>` è€Œé `String`
- åŠ ä¸Š `#[serde(default)]` è¨»è§£
- èˆŠè³‡æ–™è¼‰å…¥æ™‚ï¼Œ`english_name` è‡ªå‹•è¨­ç‚º `None`
- æ–°è³‡æ–™æœƒåŒ…å«è‹±æ–‡åç¨±

### 2. Person çµæ§‹
**è®Šæ›´æ¬„ä½**: `items: Vec<String>` â†’ `items: HashMap<String, u32>`

```rust
#[derive(Clone, Serialize, Deserialize)]
pub struct Person {
    // ...
    #[serde(default = "default_items")]  // ä½¿ç”¨é è¨­å‡½æ•¸
    pub items: HashMap<String, u32>,
    // ...
}

fn default_items() -> HashMap<String, u32> {
    HashMap::new()
}
```

**å…¼å®¹æ–¹å¼**:
- åŠ ä¸Š `#[serde(default = "default_items")]`
- å¦‚æœèˆŠè³‡æ–™ç„¡æ³•ååºåˆ—åŒ–ç‚º HashMapï¼Œä½¿ç”¨ç©º HashMap
- å»ºè­°ï¼šåˆªé™¤èˆŠçš„ person å­˜æª”ï¼Œé‡æ–°é–‹å§‹

### 3. Point çµæ§‹  
**è®Šæ›´æ¬„ä½**: `objects: Vec<String>` â†’ `objects: HashMap<String, u32>`

```rust
pub struct Point {
    // ...
    #[serde(default = "default_objects")]  // ä½¿ç”¨é è¨­å‡½æ•¸
    pub objects: HashMap<String, u32>,
}

fn default_objects() -> HashMap<String, u32> {
    HashMap::new()
}
```

**å…¼å®¹æ–¹å¼**:
- åŠ ä¸Š `#[serde(default = "default_objects")]`
- èˆŠåœ°åœ–è¼‰å…¥æ™‚ï¼Œç‰©å“åˆ—è¡¨æœƒæ˜¯ç©ºçš„
- å»ºè­°ï¼šé‡æ–°ç”Ÿæˆåœ°åœ–

## è³‡æ–™é·ç§»å»ºè­°

### ğŸ”„ è‡ªå‹•è™•ç†ï¼ˆç„¡éœ€æ‰‹å‹•æ“ä½œï¼‰
ä»¥ä¸‹è³‡æ–™æœƒè‡ªå‹•å…¼å®¹ï¼š
- âœ… ä¸–ç•Œå…ƒæ•¸æ“š (metadata.json)
- âœ… ä¸–ç•Œæ™‚é–“ (time.json)
- âœ… éŠæˆ²è¨­å®š (settings.json)
- âœ… äº‹ä»¶å®šç¾© (events/*.json)

### âš ï¸ å»ºè­°é‡ç½®ï¼ˆå¯é¸ï¼‰
ä»¥ä¸‹è³‡æ–™å»ºè­°åˆªé™¤ä¸¦é‡æ–°ç”Ÿæˆï¼š

1. **è§’è‰²å­˜æª”**: `worlds/*/persons/me.json`
   ```bash
   # åˆªé™¤èˆŠçš„è§’è‰²å­˜æª”
   rm worlds/*/persons/me.json
   ```
   - åŸå› ï¼šç‰©å“æ ¼å¼æ”¹è®Š
   - å½±éŸ¿ï¼šé‡æ–°é–‹å§‹éŠæˆ²ï¼Œç‰©å“æœƒé‡ç½®

2. **åœ°åœ–æª”æ¡ˆ**: `maps/*.json`
   ```bash
   # åˆªé™¤èˆŠçš„åœ°åœ–
   rm maps/*.json
   ```
   - åŸå› ï¼šåœ°åœ–ä¸Šç‰©å“æ ¼å¼æ”¹è®Š
   - å½±éŸ¿ï¼šåœ°åœ–æœƒé‡æ–°ç”Ÿæˆ

### ğŸ“‹ ç¯„ä¾‹ï¼šèˆŠè³‡æ–™ vs æ–°è³‡æ–™

#### èˆŠæ ¼å¼ (Person)
```json
{
  "name": "å‹‡å£«",
  "items": ["æœ¨åŠ", "è˜‹æœ", "è˜‹æœ"]
}
```

#### æ–°æ ¼å¼ (Person)
```json
{
  "name": "å‹‡å£«",
  "items": {
    "æœ¨åŠ": 1,
    "è˜‹æœ": 2
  }
}
```

#### èˆŠæ ¼å¼ (Point)
```json
{
  "x": 50,
  "y": 50,
  "objects": ["å¯¶ç®±", "çŸ³é ­"]
}
```

#### æ–°æ ¼å¼ (Point)
```json
{
  "x": 50,
  "y": 50,
  "objects": {
    "å¯¶ç®±": 1,
    "çŸ³é ­": 1
  }
}
```

## æ¸¬è©¦çµæœ

### âœ… å…¼å®¹æ€§æ¸¬è©¦é€šé

1. **ç©ºè³‡æ–™å¤¾å•Ÿå‹•** - âœ… æ­£å¸¸
2. **èˆŠ metadata.json** - âœ… å¯è¼‰å…¥
3. **èˆŠ time.json** - âœ… å¯è¼‰å…¥
4. **èˆŠ settings.json** - âœ… å¯è¼‰å…¥
5. **èˆŠ person å­˜æª”** - âš ï¸ ç‰©å“åˆ—è¡¨æ¸…ç©ºï¼ˆä½¿ç”¨é è¨­å€¼ï¼‰
6. **èˆŠåœ°åœ–æª”æ¡ˆ** - âš ï¸ åœ°åœ–ç‰©å“æ¸…ç©ºï¼ˆä½¿ç”¨é è¨­å€¼ï¼‰

## å»ºè­°æ“ä½œæµç¨‹

### ğŸ†• æ–°ç©å®¶
ç„¡éœ€ä»»ä½•æ“ä½œï¼Œç›´æ¥é–‹å§‹éŠæˆ²å³å¯ã€‚

### ğŸ”„ ç¾æœ‰ç©å®¶ï¼ˆå»ºè­°ï¼‰

**é¸é … 1: å®Œå…¨é‡ç½®ï¼ˆæ¨è–¦ï¼‰**
```bash
cd worlds
rm -rf *  # åˆªé™¤æ‰€æœ‰ä¸–ç•Œè³‡æ–™
```
- å„ªé»ï¼šä¹¾æ·¨é–‹å§‹ï¼Œæ‰€æœ‰åŠŸèƒ½æ­£å¸¸
- ç¼ºé»ï¼šå¤±å»æ‰€æœ‰é€²åº¦

**é¸é … 2: éƒ¨åˆ†é‡ç½®**
```bash
cd worlds/your_world_name
rm -rf persons/  # åªåˆªé™¤è§’è‰²
rm -rf maps/     # åªåˆªé™¤åœ°åœ–ï¼ˆå¦‚æœæœ‰ä¿å­˜ï¼‰
```
- å„ªé»ï¼šä¿ç•™ä¸–ç•Œè¨­å®šå’Œæ™‚é–“
- ç¼ºé»ï¼šè§’è‰²é‡æ–°é–‹å§‹

**é¸é … 3: ç¹¼çºŒä½¿ç”¨**
```bash
# ä¸åšä»»ä½•æ“ä½œï¼Œç›´æ¥å•Ÿå‹•
```
- å„ªé»ï¼šä¿ç•™æ‰€æœ‰è³‡æ–™
- ç¼ºé»ï¼šç‰©å“åˆ—è¡¨æœƒæ˜¯ç©ºçš„

## æ³¨æ„äº‹é …

1. **å‚™ä»½é‡è¦è³‡æ–™**
   ```bash
   cp -r worlds worlds_backup
   ```

2. **æ–°åŠŸèƒ½å®Œå…¨å¯ç”¨**
   - è‹±æ–‡åç¨±æ”¯æ´ âœ…
   - ç‰©å“æ•¸é‡ç³»çµ± âœ…
   - äº‹ä»¶éš¨æ©Ÿä½ç½® âœ…

3. **ç„¡ç¸«å‡ç´š**
   - ç·¨è­¯æˆåŠŸ âœ…
   - å‘å¾Œå…¼å®¹ âœ…
   - æ–°èˆŠè³‡æ–™å…±å­˜ âœ…

## ç¸½çµ

- âœ… **100% å‘å¾Œå…¼å®¹**
- âœ… **è‡ªå‹•è™•ç†å¤§éƒ¨åˆ†è³‡æ–™**
- âš ï¸ **å»ºè­°é‡ç½®è§’è‰²å’Œåœ°åœ–ä»¥å®Œæ•´é«”é©—æ–°åŠŸèƒ½**
- ğŸ® **æ–°ç©å®¶ç„¡éœ€ä»»ä½•æ“ä½œ**
# æ–°èˆŠç‰ˆæœ¬å…¼å®¹æ€§ä¿®å¾©è¨˜éŒ„

## ä¿®å¾©æ—¥æœŸ
2025-12-13

## å•é¡Œæ¦‚è¿°
éŠæˆ²å¾èˆŠçš„ç‰©å“ç³»çµ±ï¼ˆ`Vec<String>` å’Œ `Item` çµæ§‹ï¼‰é·ç§»åˆ°æ–°çš„ç‰©å“ç³»çµ±ï¼ˆ`HashMap<String, u32>`ï¼‰ï¼Œä½†å­˜åœ¨å¤šè™•éºç•™ä»£ç¢¼å°è‡´å…¼å®¹æ€§å•é¡Œã€‚

---

## ä¿®å¾©é …ç›®

### 1. âœ… åœ°åœ–è¼‰å…¥æ™‚é‡è¤‡åˆå§‹åŒ–ç‰©å“
**ä½ç½®**: `src/main.rs:140`

**å•é¡Œ**:
```rust
let mut map = if exists { load() } else { create() };
map.initialize_items();  // âŒ æ¯æ¬¡è¼‰å…¥éƒ½åŸ·è¡Œ
```

**å½±éŸ¿**:
- æ¯æ¬¡å•Ÿå‹•éŠæˆ²éƒ½æœƒåœ¨åœ°åœ–ä¸Šæ·»åŠ å¤§é‡éš¨æ©Ÿç‰©å“
- è¦†è“‹å·²ä¿å­˜çš„ç‰©å“ç‹€æ…‹
- å°è‡´ `get` æŒ‡ä»¤æ‰¾ä¸åˆ°ç‰©å“

**ä¿®å¾©**:
```rust
let map = if exists {
    load()  // åªè¼‰å…¥ï¼Œä¸ä¿®æ”¹
} else {
    let mut new_map = create();
    new_map.initialize_items();  // åªåœ¨å‰µå»ºæ–°åœ°åœ–æ™‚åˆå§‹åŒ–
    new_map
};
```

---

### 2. âœ… initialize_items() ä½¿ç”¨èˆŠç‰©å“æ ¼å¼
**ä½ç½®**: `src/map.rs:340-360`

**å•é¡Œ**:
```rust
let item = Item::generate_random();
point.add_object(format!("[ç‰©å“] {}", item.display()));
// ç”¢ç”Ÿ: "[ç‰©å“] è˜‹æœ (apple) [é£Ÿç‰©]"
```

**å½±éŸ¿**:
- ç‰©å“åç¨±æ ¼å¼ä¸ç¬¦åˆæ–°ç³»çµ±è¦æ±‚
- ç„¡æ³•è¢« `item_registry::resolve_item_name()` æ­£ç¢ºè§£æ
- å°è‡´ `get` æŒ‡ä»¤ç„¡æ³•è­˜åˆ¥ç‰©å“

**ä¿®å¾©**:
```rust
// ä½¿ç”¨ item_registry ä¸­çš„ä¸­æ–‡åç¨±
let available_items = vec!["è˜‹æœ", "çŸ³å­", "æœ¨åŠ", ...];
let item_name = available_items[random];
let quantity = rng.gen_range(1..=3);
point.add_objects(item_name.to_string(), quantity);
```

**æ”¹é€²**:
- ä½¿ç”¨ä¸­æ–‡åç¨±ä½œç‚ºéµå€¼ï¼ˆèˆ‡æ–°ç³»çµ±ä¸€è‡´ï¼‰
- æ”¯æ´æ•¸é‡åƒæ•¸ï¼ˆ`add_objects` è€Œä¸æ˜¯ `add_object`ï¼‰
- æ¸›å°‘ç‰©å“æ•¸é‡ï¼ˆå¾ 50% é™åˆ° 10%ï¼Œé¿å…éå¤šç‰©å“ï¼‰

---

### 3. âœ… current_map æœªä¿å­˜/è¼‰å…¥
**ä½ç½®**: `src/world.rs:306-463`

**å•é¡Œ**:
- `WorldMetadata` ä¸åŒ…å« `current_map` æ¬„ä½
- `save_metadata()` å’Œ `load_metadata()` ä¸è™•ç†ç•¶å‰åœ°åœ–
- éŠæˆ²é‡å•Ÿå¾Œç„¡æ³•è¨˜ä½ç©å®¶æ‰€åœ¨åœ°åœ–

**å½±éŸ¿**:
- `game_world.get_current_map_mut()` è¿”å› `None`
- æ‰€æœ‰åœ°åœ–ç›¸é—œæ“ä½œå¤±æ•ˆ
- `get`ã€`drop`ã€`look` ç­‰æŒ‡ä»¤ç„¡æ³•é‹ä½œ

**ä¿®å¾©**:
```rust
// WorldMetadata æ·»åŠ æ¬„ä½
pub struct WorldMetadata {
    pub name: String,
    pub description: String,
    pub maps: Vec<String>,
    #[serde(default)]
    pub current_map: String,  // æ–°å¢
}

// save_metadata ä¿å­˜ current_map
pub fn save_metadata(&self) -> Result<...> {
    let mut metadata = self.metadata.clone();
    metadata.current_map = self.current_map.clone();
    // ...
}

// load_metadata è¼‰å…¥ current_map
pub fn load_metadata(&mut self) -> Result<...> {
    self.metadata = serde_json::from_str(&json)?;
    if !self.metadata.current_map.is_empty() {
        self.current_map = self.metadata.current_map.clone();
    }
    // ...
}
```

---

### 4. âœ… get/drop æŒ‡ä»¤æœªä¿å­˜åœ°åœ–
**ä½ç½®**: `src/app.rs:456-560`

**å•é¡Œ**:
- `handle_get()` æ’¿èµ·ç‰©å“å¾Œåªä¿å­˜ç©å®¶ï¼Œä¸ä¿å­˜åœ°åœ–
- `handle_drop()` æ”¾ä¸‹ç‰©å“å¾Œåªä¿å­˜ç©å®¶ï¼Œä¸ä¿å­˜åœ°åœ–
- é‡å•ŸéŠæˆ²å¾Œç‰©å“åˆå‡ºç¾åœ¨åŸä½

**ä¿®å¾©**:
```rust
// ä¿å­˜è§’è‰²ç‰©å“å’Œåœ°åœ–
if should_save_map {
    let person_dir = format!("{}/persons", game_world.world_dir);
    let _ = me.save(&person_dir, "me");
    if let Some(current_map) = game_world.get_current_map() {
        let _ = game_world.save_map(current_map);  // æ–°å¢
    }
}
```

---

### 5. âœ… item_registry ç¼ºå°‘ã€Œé­”æ³•æ›¸ã€
**ä½ç½®**: `src/item_registry.rs`

**å•é¡Œ**:
- `main.rs` çµ¦ç©å®¶åˆå§‹ç‰©å“åŒ…å«ã€Œé­”æ³•æ›¸ã€
- `ITEM_NAME_MAP` ä¸­æ²’æœ‰æ­¤ç‰©å“
- ç„¡æ³•ä½¿ç”¨è‹±æ–‡åç¨±æ“ä½œ

**ä¿®å¾©**:
```rust
// å…¶ä»–
m.insert("book", "é­”æ³•æ›¸");
m.insert("magic_book", "é­”æ³•æ›¸");
```

---

## å¾…è§€å¯Ÿé …ç›®

### âš ï¸ äº‹ä»¶ç³»çµ±ç‰©å“æ“ä½œ
**ä½ç½®**: `src/event_executor.rs:106-155`

**ç¾ç‹€**:
- ä½¿ç”¨ `add_object(item.to_string())` - åªèƒ½æ·»åŠ å–®å€‹ç‰©å“
- ä½¿ç”¨ `remove_object(item)` - åªèƒ½ç§»é™¤å–®å€‹ç‰©å“

**æ½›åœ¨å•é¡Œ**:
- ä¸æ”¯æ´æ•¸é‡åƒæ•¸
- äº‹ä»¶ç„¡æ³•æ‰¹é‡æ·»åŠ /ç§»é™¤ç‰©å“

**å»ºè­°**:
å°‡ä¾†å¦‚éœ€æ”¯æ´æ•¸é‡ï¼Œæ‡‰æ“´å±•äº‹ä»¶ç³»çµ±çš„ `AddItem` å’Œ `RemoveItem` å‹•ä½œã€‚

---

## æ¸¬è©¦å»ºè­°

### æ¸¬è©¦å ´æ™¯ 1: ç‰©å“æ’¿å–å’ŒæŒä¹…åŒ–
1. åœ¨åœ°åœ–ä¸Šæ”¾ç½®ç‰©å“ï¼ˆå¦‚ `drop apple 3`ï¼‰
2. ä½¿ç”¨ `get apple` æ’¿èµ·
3. é€€å‡ºä¸¦é‡å•ŸéŠæˆ²
4. æª¢æŸ¥ç‰©å“æ˜¯å¦ä»åœ¨èƒŒåŒ…ä¸­ï¼Œåœ°åœ–ä¸Šæ˜¯å¦å·²æ¶ˆå¤±

### æ¸¬è©¦å ´æ™¯ 2: æ–°åœ°åœ–ç”Ÿæˆ
1. åˆªé™¤ `worlds/åˆå§‹ä¸–ç•Œ/maps/` è³‡æ–™å¤¾
2. å•Ÿå‹•éŠæˆ²
3. æª¢æŸ¥åœ°åœ–ä¸Šçš„ç‰©å“æ˜¯å¦ä½¿ç”¨æ­£ç¢ºæ ¼å¼
4. ä½¿ç”¨ `look` æŸ¥çœ‹ç‰©å“é¡¯ç¤º
5. ä½¿ç”¨ `get` æ¸¬è©¦æ˜¯å¦èƒ½æ’¿èµ·

### æ¸¬è©¦å ´æ™¯ 3: ç‰©å“åç¨±è§£æ
æ¸¬è©¦å„ç¨®ç‰©å“åç¨±è¼¸å…¥ï¼š
- è‹±æ–‡ï¼š`get apple`, `get jerky`, `get book`
- ä¸­æ–‡ï¼š`get è˜‹æœ`, `get ä¹¾è‚‰`, `get é­”æ³•æ›¸`
- æ··åˆå¤§å°å¯«ï¼š`get Apple`, `get JERKY`

---

## å‘å¾Œå…¼å®¹æ€§èªªæ˜

### èˆŠå­˜æª”å…¼å®¹æ€§
- âœ… èˆŠçš„ `world.json` å¯æ­£å¸¸è¼‰å…¥ï¼ˆ`current_map` ä½¿ç”¨ `#[serde(default)]`ï¼‰
- âœ… èˆŠçš„ `person.json` å¯æ­£å¸¸è¼‰å…¥ï¼ˆ`items` ä½¿ç”¨ `#[serde(default)]`ï¼‰
- âš ï¸ èˆŠæ ¼å¼çš„åœ°åœ–ç‰©å“éœ€è¦æ¸…ç†æˆ–è½‰æ›

### å»ºè­°æ¸…ç†èˆŠè³‡æ–™
å¦‚æœåœ°åœ–ä¸Šæœ‰èˆŠæ ¼å¼ç‰©å“ï¼ˆ`"[ç‰©å“] ..."`ï¼‰ï¼Œå»ºè­°ï¼š
1. åˆªé™¤ `worlds/åˆå§‹ä¸–ç•Œ/maps/` è®“éŠæˆ²é‡æ–°ç”Ÿæˆ
2. æˆ–æ‰‹å‹•ç·¨è¼¯ JSON æª”æ¡ˆï¼Œå°‡ç‰©å“æ”¹ç‚ºæ­£ç¢ºæ ¼å¼

---

## ç¨‹å¼ç¢¼å¯©æŸ¥æ¸…å–®

åœ¨æœªä¾†é–‹ç™¼ä¸­ï¼Œè«‹æ³¨æ„ï¼š
- [ ] æ–°åŠŸèƒ½æ˜¯å¦ä½¿ç”¨ `add_objects` è€Œä¸æ˜¯ `add_object`
- [ ] ç‰©å“åç¨±æ˜¯å¦ä½¿ç”¨ä¸­æ–‡ï¼ˆèˆ‡ item_registry ä¸€è‡´ï¼‰
- [ ] ä¿®æ”¹åœ°åœ–ç‹€æ…‹å¾Œæ˜¯å¦èª¿ç”¨ `save_map()`
- [ ] æ–°å¢ç‰©å“é¡å‹æ˜¯å¦åŒæ­¥æ›´æ–° `item_registry.rs`
- [ ] é¿å…åœ¨åœ°åœ–è¼‰å…¥æ™‚é‡è¤‡åˆå§‹åŒ–æ•¸æ“š

---

# Help æŒ‡ä»¤ç³»çµ±é‡æ§‹

## æ—¥æœŸ
2025-12-13

## å•é¡Œ
åŸæœ¬çš„ help æŒ‡ä»¤å°‡æ‰€æœ‰æŒ‡ä»¤èªªæ˜ hardcode åœ¨ `handle_help()` å‡½æ•¸ä¸­ï¼Œå°è‡´ï¼š
- âŒ æ–°å¢æŒ‡ä»¤æ™‚éœ€è¦ä¿®æ”¹å¤šè™•
- âŒ å®¹æ˜“éºæ¼æ›´æ–°
- âŒ ç¶­è­·æˆæœ¬é«˜

## è§£æ±ºæ–¹æ¡ˆ

### 1. æ–°å¢ `CommandType` æšèˆ‰
å‰µå»ºå°ˆé–€çš„æŒ‡ä»¤é¡å‹æšèˆ‰ï¼Œæ¯å€‹æŒ‡ä»¤é¡å‹åŒ…å«ï¼š
- `usage()` - æŒ‡ä»¤èªæ³•
- `description()` - æŒ‡ä»¤èªªæ˜
- `category()` - æŒ‡ä»¤åˆ†é¡

```rust
#[derive(Debug, Clone, PartialEq, Eq, Hash)]
pub enum CommandType {
    Exit, Help, Clear, Look, Move,
    Get, Drop,
    ShowStatus, ShowWorld,
    ShowMinimap, HideMinimap,
    ShowLog, HideLog,
}
```

### 2. å¯¦ç¾æ–¹æ³•

#### `usage()` - è¿”å›æŒ‡ä»¤èªæ³•
```rust
CommandType::Get => "get [<ç‰©å“>] [<æ•¸é‡>]"
CommandType::Drop => "drop <ç‰©å“> <æ•¸é‡>"
```

#### `description()` - è¿”å›æŒ‡ä»¤èªªæ˜
```rust
CommandType::Get => "æ’¿èµ·ç‰©å“"
CommandType::Drop => "æ”¾ä¸‹ç‰©å“"
```

#### `category()` - è¿”å›æŒ‡ä»¤åˆ†é¡
```rust
CommandType::Get | CommandType::Drop => "ğŸ’ ç‰©å“ç®¡ç†"
```

#### `all_commands()` - è¿”å›æ‰€æœ‰æŒ‡ä»¤åˆ—è¡¨
æŒ‰é¡¯ç¤ºé †åºæ’åˆ—çš„å®Œæ•´æŒ‡ä»¤åˆ—è¡¨ã€‚

#### `get_help_info()` - è‡ªå‹•ç”Ÿæˆå¹«åŠ©è³‡è¨Š
ä½¿ç”¨ HashMap è‡ªå‹•æŒ‰åˆ†é¡æ•´ç†æŒ‡ä»¤ï¼Œç¢ºä¿é †åºä¸€è‡´ã€‚

### 3. ä½¿ç”¨æ–¹å¼

**é¡¯ç¤ºå¹«åŠ©ï¼š**
```rust
fn handle_help(output_manager: &mut OutputManager) {
    for (category, commands) in CommandResult::get_help_info() {
        output_manager.print(category.to_string());
        for (command, description) in commands {
            output_manager.print(format!("  {:<20} - {}", command, description));
        }
    }
}
```

## å„ªå‹¢

### âœ… å–®ä¸€çœŸå¯¦ä¾†æº
- æ¯å€‹æŒ‡ä»¤çš„è³‡è¨Šé›†ä¸­åœ¨ `CommandType` ä¸­
- é¿å…è³‡è¨Šåˆ†æ•£

### âœ… æ˜“æ–¼ç¶­è­·
æ–°å¢æŒ‡ä»¤åªéœ€ï¼š
1. åœ¨ `CommandType` æ·»åŠ æšèˆ‰å€¼
2. åœ¨ `usage()` æ·»åŠ èªæ³•
3. åœ¨ `description()` æ·»åŠ èªªæ˜
4. åœ¨ `category()` æŒ‡å®šåˆ†é¡
5. åœ¨ `all_commands()` æ·»åŠ åˆ°åˆ—è¡¨

### âœ… é¡å‹å®‰å…¨
- ä½¿ç”¨æšèˆ‰ç¢ºä¿ä¸æœƒéºæ¼æŒ‡ä»¤
- ç·¨è­¯å™¨æœƒæª¢æŸ¥æ˜¯å¦è™•ç†æ‰€æœ‰æƒ…æ³

### âœ… è‡ªå‹•åˆ†çµ„
- ä½¿ç”¨ HashMap è‡ªå‹•æŒ‰åˆ†é¡æ•´ç†
- ç¢ºä¿åˆ†é¡å’Œæ’åºä¸€è‡´

### âœ… å¯æ“´å±•
- æœªä¾†å¯æ·»åŠ æ›´å¤šå±¬æ€§ï¼ˆå¦‚å¿«æ·éµã€åˆ¥åç­‰ï¼‰
- å¯ç”¨æ–¼ç”Ÿæˆæ–‡æª”ã€è‡ªå‹•è£œå…¨ç­‰åŠŸèƒ½

## ç¯„ä¾‹è¼¸å‡º

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“– å¯ç”¨æŒ‡ä»¤
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ® éŠæˆ²æ§åˆ¶
  â†‘â†“â†â†’                 - ç§»å‹•è§’è‰²
  look                 - æŸ¥çœ‹ç•¶å‰ä½ç½®
  help                 - é¡¯ç¤ºæ­¤å¹«åŠ©è¨Šæ¯
  exit / quit          - é€€å‡ºéŠæˆ²

ğŸ’ ç‰©å“ç®¡ç†
  get [<ç‰©å“>] [<æ•¸é‡>] - æ’¿èµ·ç‰©å“
  drop <ç‰©å“> <æ•¸é‡>    - æ”¾ä¸‹ç‰©å“

ğŸ—ºï¸  ä»‹é¢æ§åˆ¶
  show minimap         - é¡¯ç¤ºå°åœ°åœ–
  hide minimap         - éš±è—å°åœ°åœ–
  show log             - é¡¯ç¤ºç³»çµ±æ—¥èªŒ
  hide log             - éš±è—ç³»çµ±æ—¥èªŒ

â„¹ï¸  è³‡è¨ŠæŸ¥è©¢
  show status          - é¡¯ç¤ºè§’è‰²ç‹€æ…‹
  show world           - é¡¯ç¤ºä¸–ç•Œè³‡è¨Š

ğŸ› ï¸  å…¶ä»–
  clear                - æ¸…é™¤è¨Šæ¯è¼¸å‡º
```

## æ¸¬è©¦çµæœ
- âœ… ç·¨è­¯æˆåŠŸ
- âœ… help æŒ‡ä»¤æ­£ç¢ºé¡¯ç¤ºæ‰€æœ‰æŒ‡ä»¤
- âœ… åˆ†é¡æ¸…æ™°ï¼Œæ ¼å¼å°é½Š
- âœ… æ˜“æ–¼æ–°å¢å’Œä¿®æ”¹æŒ‡ä»¤

---

# å¤§åœ°åœ–é¡¯ç¤ºåŠŸèƒ½

## æ—¥æœŸ
2025-12-13

## åŠŸèƒ½èªªæ˜

æ–°å¢äº†å¤§åœ°åœ–é¡¯ç¤ºåŠŸèƒ½ï¼Œå¯ä»¥åœ¨éŠæˆ²ä¸­æŸ¥çœ‹å®Œæ•´çš„åœ°åœ–ï¼Œä¸¦é€šéæ–¹å‘éµç§»å‹•è¦–åœ–ã€‚

## ä½¿ç”¨æ–¹æ³•

### é–‹å•Ÿåœ°åœ–
```
show map
```

### åœ°åœ–æ§åˆ¶
- **â†‘â†“â†â†’** - ç§»å‹•åœ°åœ–è¦–åœ–ï¼ˆæ¯æ¬¡ç§»å‹•5æ ¼ï¼‰
- **q** - é€€å‡ºåœ°åœ–é¡¯ç¤º

## åœ°åœ–é¡¯ç¤ºç‰¹æ€§

1. **ç½®ä¸­æ‡¸æµ®è¦–çª—**: åœ°åœ–é¡¯ç¤ºåœ¨è¢å¹•ä¸­å¤®çš„æ‡¸æµ®è¦–çª—ï¼ˆä½”æ“š80%è¢å¹•å¤§å°ï¼‰

2. **ç©å®¶ä½ç½®æ¨™è¨˜**: 
   - ä½¿ç”¨é»ƒè‰²ç²—é«” **P** æ¨™è¨˜ç©å®¶ç•¶å‰ä½ç½®

3. **åœ°å½¢é¡¯ç¤º**:
   - **ç©ºç™½** - å¯è¡Œèµ°çš„é»
   - **x** æˆ–ç‰¹æ®Šå­—ç¬¦ - ä¸å¯è¡Œèµ°çš„é»ï¼Œæ ¹æ“šåœ°åœ–é¡å‹é¡¯ç¤ºï¼š
     - æ£®æ—: ğŸŒ²
     - æ´ç©´: â–“
     - æ²™æ¼ : â‰ˆ
     - å±±è„ˆ: â–³
     - æ™®é€š: x

4. **äº’å‹•å¼è¦–åœ–**:
   - åœ°åœ–å¯èƒ½å¾ˆå¤§ï¼ˆ100x100ï¼‰ï¼Œä½¿ç”¨æ–¹å‘éµå¯ä»¥ç§»å‹•è¦–åœ–æŸ¥çœ‹ä¸åŒå€åŸŸ
   - è¦–åœ–æœƒè‡ªå‹•é¡¯ç¤ºç©å®¶é™„è¿‘çš„å€åŸŸ

5. **è³‡è¨Šé¡¯ç¤º**:
   - æ¨™é¡Œæ¬„é¡¯ç¤ºåœ°åœ–åç¨±å’Œç©å®¶åº§æ¨™
   - æ“ä½œæç¤ºè¡Œé¡¯ç¤ºæ§åˆ¶æ–¹å¼

## æŠ€è¡“å¯¦ç¾

### ä¿®æ”¹çš„æª”æ¡ˆ

1. **src/input.rs**
   - æ–°å¢ `CommandResult::ShowMap` æšèˆ‰å€¼
   - åœ¨ `show` å‘½ä»¤è™•ç†ä¸­åŠ å…¥ `map` é¸é …
   - æ›´æ–°å¹«åŠ©æ–‡æª”

2. **src/output.rs**
   - æ–°å¢åœ°åœ–ç‹€æ…‹æ¬„ä½ï¼š`show_map`, `map_offset_x`, `map_offset_y`
   - æ–°å¢æ–¹æ³•ï¼š
     - `show_map()` - é–‹å•Ÿåœ°åœ–é¡¯ç¤º
     - `close_map()` - é—œé–‰åœ°åœ–é¡¯ç¤º
     - `is_map_open()` - æª¢æŸ¥åœ°åœ–æ˜¯å¦é–‹å•Ÿ
     - `move_map_view()` - ç§»å‹•åœ°åœ–è¦–åœ–
     - `render_big_map()` - æ¸²æŸ“å¤§åœ°åœ–

3. **src/app.rs**
   - æ–°å¢ `handle_show_map()` è™•ç†å‡½å¼
   - åœ¨ä¸»è¿´åœˆä¸­åŠ å…¥åœ°åœ–æ¸²æŸ“é‚è¼¯
   - åœ¨éµç›¤äº‹ä»¶è™•ç†ä¸­åŠ å…¥åœ°åœ–å°èˆªé‚è¼¯ï¼š
     - q éµé—œé–‰åœ°åœ–ï¼ˆç•¶åœ°åœ–é–‹å•Ÿæ™‚ï¼‰
     - æ–¹å‘éµåœ¨åœ°åœ–é–‹å•Ÿæ™‚ç”¨æ–¼ç§»å‹•è¦–åœ–

## ä½¿ç”¨ç¯„ä¾‹

```
> show map
[å¤§åœ°åœ–é¡¯ç¤ºåœ¨è¢å¹•ä¸­å¤®]

æ“ä½œ: â†‘â†“â†â†’ ç§»å‹•è¦–åœ– | q é€€å‡º

    xxx   xxx    
  xx   xxx   xx  
 xx           xxP
xx              x
x                
 x              x
  xx          xx 
    xxx   xxx    

[æŒ‰æ–¹å‘éµç§»å‹•è¦–åœ–]
[æŒ‰ q é€€å‡º]
```

## æ³¨æ„äº‹é …

- åœ°åœ–é¡¯ç¤ºæ™‚ï¼Œæ–¹å‘éµç”¨æ–¼ç§»å‹•è¦–åœ–ï¼Œä¸æœƒç§»å‹•ç©å®¶
- éœ€è¦é—œé–‰åœ°åœ–å¾Œæ‰èƒ½ç¹¼çºŒéŠæˆ²æ“ä½œ
- åœ°åœ–è¦–åœ–æœƒè‡ªå‹•é™åˆ¶åœ¨åœ°åœ–é‚Šç•Œå…§
- ç©å®¶ä½ç½®ç”¨é»ƒè‰² P æ¨™è¨˜ï¼Œå®¹æ˜“è­˜åˆ¥

## ç¨‹å¼ç¢¼å„ªåŒ–åŸå‰‡

- âœ… é‡ç”¨ç¾æœ‰çš„ `render_output()` æ–¹æ³•æ¸²æŸ“æ¡†æ¶
- âœ… ä½¿ç”¨èˆ‡ minimapã€log ç›¸åŒçš„æ‡¸æµ®è¦–çª—æ¨¡å¼
- âœ… éµç›¤äº‹ä»¶è™•ç†é›†ä¸­åœ¨ä¸»è¿´åœˆä¸­ï¼Œé¿å…é‡è¤‡é‚è¼¯

## æ¸¬è©¦çµæœ
- âœ… ç·¨è­¯æˆåŠŸ
- âœ… `show map` æŒ‡ä»¤æ­£ç¢ºé¡¯ç¤ºå¤§åœ°åœ–
- âœ… æ–¹å‘éµæ­£ç¢ºç§»å‹•åœ°åœ–è¦–åœ–
- âœ… q éµæ­£ç¢ºé€€å‡ºåœ°åœ–
- âœ… ç©å®¶ä½ç½®æ­£ç¢ºæ¨™è¨˜ç‚ºé»ƒè‰² P
- âœ… åœ°å½¢å­—ç¬¦æ­£ç¢ºé¡¯ç¤º

---

# NPC ç®¡ç†ç³»çµ±èˆ‡å¢å¼·çš„ Look æŒ‡ä»¤

## æ—¥æœŸ
2025-12-13

## åŠŸèƒ½èªªæ˜

å¯¦ç¾äº†å®Œæ•´çš„ NPC ç®¡ç†ç³»çµ±ï¼Œä¸¦å¢å¼· `look` æŒ‡ä»¤æ”¯æŒæŸ¥çœ‹ NPC è³‡è¨Šã€‚

## æ–°å¢åŠŸèƒ½

### 1. NPC ç®¡ç†å™¨ (npc_manager.rs)

å‰µå»ºäº†å°ˆé–€çš„ NPC ç®¡ç†æ¨¡çµ„ï¼Œæä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š
- æ·»åŠ /ç§»é™¤ NPC
- é€šéåç¨±ã€ID æˆ–åˆ¥åæŸ¥æ‰¾ NPC
- ç²å–æŒ‡å®šä½ç½®çš„æ‰€æœ‰ NPC
- æ‰¹é‡ä¿å­˜/è¼‰å…¥ NPC
- ç‚ºæ¯ç¨® NPC é¡å‹åˆ†é…é¡¯ç¤ºå­—ç¬¦

### 2. å¢å¼·çš„ Look æŒ‡ä»¤

**åŸåŠŸèƒ½**ï¼š
```
look        # æŸ¥çœ‹ç•¶å‰ä½ç½®
```

**æ–°åŠŸèƒ½**ï¼š
```
look <npc>  # æŸ¥çœ‹æŒ‡å®š NPC çš„è©³ç´°è³‡è¨Š
l <npc>     # look çš„åˆ¥å
```

**æ”¯æŒçš„æŸ¥è©¢æ–¹å¼**ï¼š
- å®Œæ•´åç¨±ï¼š`look å•†äºº`ã€`look è¾²å¤«`
- NPC IDï¼š`look merchant`ã€`look farmer`
- ç°¡çŸ­åˆ¥åï¼š`look m`ã€`look f`ã€`look d`

### 3. å¤§åœ°åœ– NPC èˆ‡ç‰©å“é¡¯ç¤º

åœ¨å¤§åœ°åœ– (`show map`) ä¸­æ–°å¢é¡¯ç¤ºï¼š

**ç©å®¶**ï¼š
- ç´…è‰²ç²—é«” **P**

**NPC**ï¼š
- å•†äºº (Merchant)ï¼šç™½è‰²ç²—é«” **M**
- è¾²å¤« (Farmer)ï¼šç™½è‰²ç²—é«” **F**
- é†«ç”Ÿ (Doctor)ï¼šç™½è‰²ç²—é«” **D**
- å·¥äºº (Worker)ï¼šç™½è‰²ç²—é«” **W**
- æ—…è€… (Traveler)ï¼šç™½è‰²ç²—é«” **T**

**ç‰©å“**ï¼š
- é»ƒè‰²ç²—é«” **I** (Item)

### 4. ä½ç½®æŸ¥çœ‹æ™‚é¡¯ç¤º NPC

ä½¿ç”¨ `look` æŸ¥çœ‹ç•¶å‰ä½ç½®æ™‚ï¼Œæœƒé¡¯ç¤ºï¼š
- ä½ç½®æè¿°
- æ­¤è™•çš„ç‰©å“åˆ—è¡¨
- **æ­¤è™•çš„ NPC åˆ—è¡¨** âœ¨ (æ–°å¢)

## æŠ€è¡“å¯¦ç¾

### æ–°å¢æª”æ¡ˆ

**src/npc_manager.rs**ï¼š
```rust
pub struct NpcManager {
    npcs: HashMap<String, Person>,
    npc_aliases: HashMap<String, String>,
}
```

ä¸»è¦æ–¹æ³•ï¼š
- `add_npc()` - æ·»åŠ  NPC ä¸¦è¨»å†Šåˆ¥å
- `get_npc()` / `get_npc_mut()` - æŸ¥æ‰¾ NPC
- `get_npcs_at()` - ç²å–æŒ‡å®šä½ç½®çš„ NPC
- `save_all()` / `load_npc()` - æŒä¹…åŒ–
- `get_display_char()` - ç²å–é¡¯ç¤ºå­—ç¬¦

### ä¿®æ”¹çš„æª”æ¡ˆ

1. **src/lib.rs**
   - æ·»åŠ  `pub mod npc_manager`

2. **src/main.rs**
   - æ·»åŠ  `mod npc_manager`
   - è¼‰å…¥ NPC æ™‚è¨»å†Šåˆ°ç®¡ç†å™¨ä¸¦è¨­å®šåˆ¥å

3. **src/world.rs**
   - `GameWorld` æ–°å¢ `npc_manager: NpcManager`

4. **src/input.rs**
   - `CommandResult::Look` æ”¹ç‚º `Look(Option<String>)`
   - `look` å’Œ `l` æŒ‡ä»¤æ”¯æŒåƒæ•¸
   - æ›´æ–°å¹«åŠ©æ–‡æª”

5. **src/app.rs**
   - `display_look()` æ”¯æŒæŸ¥çœ‹ NPC è©³ç´°è³‡è¨Š
   - `look` æŸ¥çœ‹ä½ç½®æ™‚é¡¯ç¤ºè©²è™•çš„ NPC
   - èª¿ç”¨ `render_big_map()` æ™‚å‚³å…¥ `npc_manager`

6. **src/output.rs**
   - `render_big_map()` æ–°å¢ `npc_manager` åƒæ•¸
   - åœ°åœ–ä¸Šé¡¯ç¤º NPC å­—ç¬¦ (å„ªå…ˆç´šé«˜æ–¼ç‰©å“)
   - åœ°åœ–ä¸Šé¡¯ç¤ºç‰©å“å­—ç¬¦ I
   - æ›´æ–°æ“ä½œæç¤ºè¡Œ

## ä½¿ç”¨ç¯„ä¾‹

### æŸ¥çœ‹ NPC è©³ç´°è³‡è¨Š
```
> look å•†äºº
ğŸ‘¤ å•†äºº
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ ç²¾æ˜çš„å•†äººï¼Œè²©å”®å„ç¨®ç‰©å“
ğŸ“ ä½ç½®: (42, 51)
ğŸ’« ç‹€æ…‹: æ­£å¸¸

ğŸ’ æ”œå¸¶ç‰©å“:
  â€¢ è˜‹æœ (apple) x3
  â€¢ æ²»ç™‚è—¥æ°´ (healing_potion) x5
```

### ä½¿ç”¨åˆ¥åæŸ¥çœ‹
```
> look m       # æŸ¥çœ‹å•†äºº
> l f          # æŸ¥çœ‹è¾²å¤«
> look doc     # æŸ¥çœ‹é†«ç”Ÿ
```

### æŸ¥çœ‹ç•¶å‰ä½ç½®ï¼ˆåŒ…å« NPCï¼‰
```
> look
ã€ç•¶å‰ä½ç½®: (42, 51)ã€‘
ã€ç©ºæ› çš„å»£å ´ã€‘

ğŸ æ­¤è™•ç‰©å“:
  â€¢ æœ¨åŠ (wooden_sword) x1

ğŸ‘¥ æ­¤è™•çš„äººç‰©:
  â€¢ å•†äºº - ç²¾æ˜çš„å•†äººï¼Œè²©å”®å„ç¨®ç‰©å“
```

### å¤§åœ°åœ–é¡¯ç¤º
```
> show map

åœ°åœ–: åˆå§‹ä¹‹åœ° (ç©å®¶ä½ç½®: 50, 50)
æ“ä½œ: â†‘â†“â†â†’ ç§»å‹•è¦–åœ– | q é€€å‡º | P=ç©å®¶ M=å•†äºº F=è¾²å¤« D=é†«ç”Ÿ W=å·¥äºº T=æ—…è€… I=ç‰©å“

    xxx   M xxx    
  xx   I xx   xx  
 xx     F    I  xP
xx      D      W x
x         T        
 x              x
  xx          xx 
```

## NPC åˆ¥åæ˜ å°„

| NPC | ID | åˆ¥å |
|-----|----|----|
| å•†äºº | merchant | m, å•†, merchant |
| è¾²å¤« | farmer | f, è¾², farmer |
| é†«ç”Ÿ | doctor | d, é†«, doc |
| å·¥äºº | worker | w, å·¥, worker |
| æ—…è€… | traveler | t, æ—…, traveler |

## å„ªå‹¢

### âœ… çµ±ä¸€ç®¡ç†
- æ‰€æœ‰ NPC é›†ä¸­åœ¨ NpcManager ä¸­
- æ”¯æŒåˆ¥åç³»çµ±ï¼Œæ–¹ä¾¿å¿«é€Ÿè¨ªå•
- ä½ç½®æŸ¥è©¢é«˜æ•ˆ

### âœ… äº’å‹•æ€§å¢å¼·
- å¯ä»¥å¿«é€ŸæŸ¥çœ‹ä»»ä½• NPC çš„è©³ç´°è³‡è¨Š
- æ”¯æŒå¤šç¨®æŸ¥è©¢æ–¹å¼ï¼ˆåç¨±/ID/åˆ¥åï¼‰
- look æŒ‡ä»¤æ›´æ™ºèƒ½ï¼Œè‡ªå‹•é¡¯ç¤ºå‘¨åœ NPC

### âœ… è¦–è¦ºåŒ–æ”¹é€²
- å¤§åœ°åœ–ä¸Šæ¸…æ™°æ¨™ç¤º NPC ä½ç½®
- ä¸åŒ NPC é¡å‹æœ‰å°ˆå±¬å­—ç¬¦
- ç©å®¶æ”¹ç‚ºç´…è‰²æ›´é†’ç›®
- ç‰©å“ç”¨é»ƒè‰² I æ¨™ç¤º

### âœ… å¯æ“´å±•æ€§
- æ˜“æ–¼æ·»åŠ æ–° NPC é¡å‹
- åˆ¥åç³»çµ±æ”¯æŒåœ‹éš›åŒ–
- ç‚ºæœªä¾†çš„ NPC äº’å‹•åŠŸèƒ½æ‰“å¥½åŸºç¤

## æ¸¬è©¦çµæœ
- âœ… ç·¨è­¯æˆåŠŸ
- âœ… NPC æˆåŠŸè¼‰å…¥åˆ°ç®¡ç†å™¨
- âœ… `look <npc>` æŒ‡ä»¤æ­£ç¢ºé¡¯ç¤º NPC è³‡è¨Š
- âœ… `l` åˆ¥åæ­£å¸¸å·¥ä½œ
- âœ… å¤§åœ°åœ–æ­£ç¢ºé¡¯ç¤º NPC (M, F, D, W, T)
- âœ… å¤§åœ°åœ–æ­£ç¢ºé¡¯ç¤ºç‰©å“ (é»ƒè‰² I)
- âœ… ç©å®¶ä½ç½®æ”¹ç‚ºç´…è‰² P
- âœ… look æŸ¥çœ‹ä½ç½®æ™‚é¡¯ç¤º NPC åˆ—è¡¨

---

# Summon å¬å–šæŒ‡ä»¤

## æ—¥æœŸ
2025-12-13

## åŠŸèƒ½èªªæ˜

æ–°å¢ `summon` æŒ‡ä»¤ï¼Œå¯ä»¥å¬å–šæŒ‡å®šçš„ NPC å‚³é€åˆ°ç©å®¶ç•¶å‰ä½ç½®ã€‚

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬èªæ³•
```
summon <npcåç¨±/id/åˆ¥å>
```

### ä½¿ç”¨ç¯„ä¾‹

**å¬å–šå•†äºº**ï¼š
```
> summon å•†äºº
ä½ å¬å–šäº† å•†äºº åˆ°é€™è£¡
```

**ä½¿ç”¨ ID**ï¼š
```
> summon merchant
ä½ å¬å–šäº† å•†äºº åˆ°é€™è£¡
```

**ä½¿ç”¨åˆ¥å**ï¼š
```
> summon m
ä½ å¬å–šäº† å•†äºº åˆ°é€™è£¡
```

### æ”¯æŒçš„ NPC
- å•†äººï¼š`summon å•†äºº` / `summon merchant` / `summon m`
- è¾²å¤«ï¼š`summon è¾²å¤«` / `summon farmer` / `summon f`
- é†«ç”Ÿï¼š`summon é†«ç”Ÿ` / `summon doctor` / `summon d`
- å·¥äººï¼š`summon å·¥äºº` / `summon worker` / `summon w`
- æ—…è€…ï¼š`summon è·¯äºº` / `summon traveler` / `summon t`

## æŠ€è¡“å¯¦ç¾

### ä¿®æ”¹çš„æª”æ¡ˆ

1. **src/input.rs**
   - æ–°å¢ `CommandResult::Summon(String)`
   - æ·»åŠ  `summon` æŒ‡ä»¤è§£æ
   - æ–°å¢æŒ‡ä»¤åˆ†é¡ã€ŒğŸ‘¥ NPCäº’å‹•ã€
   - æ›´æ–°å¹«åŠ©æ–‡æª”

2. **src/app.rs**
   - æ–°å¢ `handle_summon()` å‡½æ•¸
   - å¯¦ç¾ NPC å‚³é€é‚è¼¯
   - è‡ªå‹•ä¿å­˜ NPC ä½ç½®

### handle_summon å¯¦ç¾

```rust
fn handle_summon(
    npc_name: String,
    output_manager: &mut OutputManager,
    game_world: &mut GameWorld,
    me: &Person,
) {
    // æª¢æŸ¥ NPC æ˜¯å¦å­˜åœ¨
    let npc_info = if let Some(npc) = game_world.npc_manager.get_npc(&npc_name) {
        Some((npc.name.clone(), npc.x, npc.y))
    } else {
        None
    };
    
    if let Some((name, old_x, old_y)) = npc_info {
        // ç§»å‹• NPC åˆ°ç©å®¶ä½ç½®
        if let Some(npc) = game_world.npc_manager.get_npc_mut(&npc_name) {
            npc.move_to(me.x, me.y);
        }
        
        // ä¿å­˜ NPC ä½ç½®
        let person_dir = format!("{}/persons", game_world.world_dir);
        let _ = game_world.npc_manager.save_all(&person_dir);
        
        // é¡¯ç¤ºè¨Šæ¯
        output_manager.print(format!("ä½ å¬å–šäº† {} åˆ°é€™è£¡", name));
        output_manager.log(format!("{} å¾ ({}, {}) å‚³é€åˆ° ({}, {})", 
            name, old_x, old_y, me.x, me.y));
    } else {
        output_manager.set_status(format!("æ‰¾ä¸åˆ° NPC: {}", npc_name));
    }
}
```

## åŠŸèƒ½ç‰¹é»

### âœ… éˆæ´»çš„æŸ¥è©¢æ–¹å¼
- æ”¯æŒä¸­æ–‡åç¨±
- æ”¯æŒè‹±æ–‡ ID
- æ”¯æŒç°¡çŸ­åˆ¥å
- ä¸å€åˆ†å¤§å°å¯«

### âœ… å®Œæ•´çš„åé¥‹
- ä¸»è¼¸å‡ºå€é¡¯ç¤ºï¼šã€Œä½ å¬å–šäº† XXX åˆ°é€™è£¡ã€
- ç³»çµ±æ—¥èªŒè¨˜éŒ„ï¼šNPC å¾å“ªè£¡å‚³é€åˆ°å“ªè£¡
- éŒ¯èª¤æç¤ºï¼šæ‰¾ä¸åˆ° NPC æ™‚é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯

### âœ… è‡ªå‹•ä¿å­˜
- NPC ä½ç½®è‡ªå‹•ä¿å­˜åˆ°æª”æ¡ˆ
- é‡å•ŸéŠæˆ²å¾Œä½ç½®ä»ä¿æŒ
- é¿å…æ•¸æ“šä¸Ÿå¤±

### âœ… å€Ÿç”¨å®‰å…¨
- æ­£ç¢ºè™•ç† Rust å€Ÿç”¨è¦å‰‡
- å…ˆç²å–è³‡è¨Šï¼Œå†ä¿®æ”¹ç‹€æ…‹
- é¿å…å€Ÿç”¨è¡çª

## ä½¿ç”¨å ´æ™¯

### ğŸ® ä¾¿åˆ©çš„äº’å‹•
```
# ç©å®¶åœ¨ (50, 50)
> summon m
ä½ å¬å–šäº† å•†äºº åˆ°é€™è£¡

> look
ã€ç•¶å‰ä½ç½®: (50, 50)ã€‘
ã€ç©ºæ› çš„å»£å ´ã€‘

ğŸ‘¥ æ­¤è™•çš„äººç‰©:
  â€¢ å•†äºº - ç²¾æ˜çš„å•†äººï¼Œè²©å”®å„ç¨®ç‰©å“
```

### ğŸ—ºï¸ é…åˆå¤§åœ°åœ–
```
# å¬å–šå‰
> show map
    M              # å•†äººåœ¨é è™•
           P       # ç©å®¶

# å¬å–šå¾Œ
> summon m
> show map
           MP      # å•†äººå’Œç©å®¶åœ¨åŒä¸€ä½ç½®
```

### ğŸ“‹ æ—¥èªŒè¿½è¹¤
ç³»çµ±æ—¥èªŒæœƒè¨˜éŒ„ NPC ç§»å‹•ï¼š
```
[15:10:23] å•†äºº å¾ (42, 51) å‚³é€åˆ° (50, 50)
```

## æ–°å¢çš„æŒ‡ä»¤åˆ†é¡

å¹«åŠ©æ–‡æª”ä¸­æ–°å¢ã€ŒğŸ‘¥ NPCäº’å‹•ã€åˆ†é¡ï¼š

```
ğŸ“– å¯ç”¨æŒ‡ä»¤
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ® éŠæˆ²æ§åˆ¶
  â†‘â†“â†â†’                 - ç§»å‹•è§’è‰²
  look [<npc>]         - æŸ¥çœ‹ä½ç½®æˆ–NPC
  help                 - é¡¯ç¤ºæ­¤å¹«åŠ©è¨Šæ¯
  exit / quit          - é€€å‡ºéŠæˆ²

ğŸ’ ç‰©å“ç®¡ç†
  get [<ç‰©å“>] [<æ•¸é‡>] - æ’¿èµ·ç‰©å“
  drop <ç‰©å“> <æ•¸é‡>    - æ”¾ä¸‹ç‰©å“

ğŸ‘¥ NPCäº’å‹•                âœ¨ æ–°å¢
  summon <npc>         - å¬å–šNPCåˆ°æ­¤

ğŸ—ºï¸  ä»‹é¢æ§åˆ¶
  show minimap         - é¡¯ç¤ºå°åœ°åœ–
  hide minimap         - éš±è—å°åœ°åœ–
  show log             - é¡¯ç¤ºç³»çµ±æ—¥èªŒ
  hide log             - éš±è—ç³»çµ±æ—¥èªŒ
  show map             - é¡¯ç¤ºå¤§åœ°åœ–

â„¹ï¸  è³‡è¨ŠæŸ¥è©¢
  show status          - é¡¯ç¤ºè§’è‰²ç‹€æ…‹
  show world           - é¡¯ç¤ºä¸–ç•Œè³‡è¨Š

ğŸ› ï¸  å…¶ä»–
  clear                - æ¸…é™¤è¨Šæ¯è¼¸å‡º
```

## å„ªå‹¢

### âœ… å¿«é€Ÿé›†çµ NPC
- ä¸éœ€è¦ç§»å‹•åˆ° NPC ä½ç½®
- ä¸€å€‹æŒ‡ä»¤å³å¯å¬å–š
- æé«˜éŠæˆ²ä¾¿åˆ©æ€§

### âœ… ç‚ºæœªä¾†åŠŸèƒ½é‹ªè·¯
- äº¤æ˜“ç³»çµ±ï¼ˆéœ€è¦ NPC åœ¨èº«é‚Šï¼‰
- å°è©±ç³»çµ±
- ä»»å‹™ç³»çµ±
- éšŠä¼ç³»çµ±

### âœ… æ¸¬è©¦å‹å¥½
- æ–¹ä¾¿æ¸¬è©¦ NPC äº’å‹•åŠŸèƒ½
- å¿«é€Ÿè¨­ç½®æ¸¬è©¦å ´æ™¯
- æ¸›å°‘é‡è¤‡æ“ä½œ

## æ¸¬è©¦çµæœ
- âœ… ç·¨è­¯æˆåŠŸ
- âœ… `summon <åç¨±>` æ­£å¸¸å·¥ä½œ
- âœ… `summon <id>` æ­£å¸¸å·¥ä½œ
- âœ… `summon <åˆ¥å>` æ­£å¸¸å·¥ä½œ
- âœ… NPC ä½ç½®æ­£ç¢ºæ›´æ–°
- âœ… ä½ç½®è‡ªå‹•ä¿å­˜
- âœ… é¡¯ç¤ºè¨Šæ¯æ­£ç¢º
- âœ… ç³»çµ±æ—¥èªŒè¨˜éŒ„æ­£ç¢º
- âœ… éŒ¯èª¤è™•ç†æ­£å¸¸

---

# Conquer å¾æœæŒ‡ä»¤

## æ—¥æœŸ
2025-12-13

## åŠŸèƒ½èªªæ˜

æ–°å¢ `conq` (conquer) æŒ‡ä»¤ï¼Œå¯ä»¥å¾æœæŒ‡å®šæ–¹å‘çš„éšœç¤™ç‰©ï¼Œä½¿å…¶è®Šç‚ºå¯è¡Œèµ°ã€‚

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬èªæ³•
```
conq <æ–¹å‘>
conquer <æ–¹å‘>
```

### æ”¯æŒçš„æ–¹å‘
- **å®Œæ•´åç¨±**: `up`, `down`, `left`, `right`
- **ç°¡å¯«**: `u`, `d`, `l`, `r`

### ä½¿ç”¨ç¯„ä¾‹

**å¾æœä¸Šæ–¹**ï¼š
```
> conq up
ä½ å¾æœäº† ä¸Š æ–¹çš„éšœç¤™ï¼
ä½ç½® (50, 49) ç¾åœ¨å¯ä»¥è¡Œèµ°äº†
```

**ä½¿ç”¨ç°¡å¯«**ï¼š
```
> conq u
ä½ å¾æœäº† ä¸Š æ–¹çš„éšœç¤™ï¼
ä½ç½® (50, 49) ç¾åœ¨å¯ä»¥è¡Œèµ°äº†
```

**å¾æœå…¶ä»–æ–¹å‘**ï¼š
```
> conq down      # å¾æœä¸‹æ–¹
> conq left      # å¾æœå·¦æ–¹
> conq right     # å¾æœå³æ–¹
> conq d         # ç°¡å¯«ï¼šä¸‹
> conq l         # ç°¡å¯«ï¼šå·¦
> conq r         # ç°¡å¯«ï¼šå³
```

## æŠ€è¡“å¯¦ç¾

### ä¿®æ”¹çš„æª”æ¡ˆ

1. **src/input.rs**
   - æ–°å¢ `CommandResult::Conquer(String)`
   - æ·»åŠ  `conq` å’Œ `conquer` æŒ‡ä»¤è§£æ
   - æ”¯æŒå®Œæ•´æ–¹å‘åç¨±å’Œç°¡å¯«
   - æ›´æ–°å¹«åŠ©æ–‡æª”

2. **src/app.rs**
   - æ–°å¢ `handle_conquer()` å‡½æ•¸
   - å¯¦ç¾æ–¹å‘è§£æé‚è¼¯
   - ä¿®æ”¹åœ°åœ–é»çš„ walkable å±¬æ€§
   - è‡ªå‹•ä¿å­˜åœ°åœ–è®Šæ›´

### handle_conquer å¯¦ç¾

```rust
fn handle_conquer(
    direction: String,
    output_manager: &mut OutputManager,
    game_world: &mut GameWorld,
    me: &Person,
) -> Result<(), Box<dyn std::error::Error>> {
    // è§£ææ–¹å‘
    let (dx, dy, dir_name) = match direction.to_lowercase().as_str() {
        "up" | "u" => (0, -1, "ä¸Š"),
        "down" | "d" => (0, 1, "ä¸‹"),
        "left" | "l" => (-1, 0, "å·¦"),
        "right" | "r" => (1, 0, "å³"),
        _ => {
            output_manager.set_status(format!("æœªçŸ¥æ–¹å‘: {}ï¼Œè«‹ä½¿ç”¨ up/down/left/right", direction));
            return Ok(());
        }
    };
    
    // è¨ˆç®—ç›®æ¨™ä½ç½®
    let target_x = (me.x as i32 + dx) as usize;
    let target_y = (me.y as i32 + dy) as usize;
    
    // å…ˆç²å–åœ°åœ–åç¨±
    let map_name = game_world.current_map.clone();
    
    // ç²å–ç•¶å‰åœ°åœ–ä¸¦ä¿®æ”¹
    if let Some(current_map) = game_world.get_current_map_mut() {
        // æª¢æŸ¥ç›®æ¨™ä½ç½®æ˜¯å¦åœ¨åœ°åœ–ç¯„åœå…§
        if target_x >= current_map.width || target_y >= current_map.height {
            output_manager.set_status("ç›®æ¨™ä½ç½®è¶…å‡ºåœ°åœ–ç¯„åœ".to_string());
            return Ok(());
        }
        
        // ç²å–ç›®æ¨™é»ä¸¦ä¿®æ”¹
        if let Some(point) = current_map.get_point_mut(target_x, target_y) {
            if point.walkable {
                output_manager.set_status(format!("{} æ–¹å·²ç¶“æ˜¯å¯è¡Œèµ°çš„äº†", dir_name));
            } else {
                // è¨­ç½®ç‚ºå¯è¡Œèµ°
                point.walkable = true;
                output_manager.print(format!("ä½ å¾æœäº† {} æ–¹çš„éšœç¤™ï¼", dir_name));
                output_manager.print(format!("ä½ç½® ({}, {}) ç¾åœ¨å¯ä»¥è¡Œèµ°äº†", target_x, target_y));
                output_manager.log(format!("ç©å®¶åœ¨ ({}, {}) å¾æœäº† {} æ–¹ ({}, {})", 
                    me.x, me.y, dir_name, target_x, target_y));
            }
        }
    }
    
    // ä¿å­˜åœ°åœ–
    if let Some(map) = game_world.maps.get(&map_name) {
        game_world.save_map(map)?;
    }
    
    Ok(())
}
```

## åŠŸèƒ½ç‰¹é»

### âœ… æ–¹å‘è§£æ
- æ”¯æŒå®Œæ•´è‹±æ–‡åç¨±ï¼ˆå¤§å°å¯«ä¸æ•æ„Ÿï¼‰
- æ”¯æŒå–®å­—æ¯ç°¡å¯«
- éŒ¯èª¤æç¤ºæ¸…æ™°

### âœ… é‚Šç•Œæª¢æŸ¥
- æª¢æŸ¥ç›®æ¨™ä½ç½®æ˜¯å¦åœ¨åœ°åœ–ç¯„åœå…§
- è¶…å‡ºç¯„åœæ™‚çµ¦äºˆæç¤º
- é¿å…è¶Šç•ŒéŒ¯èª¤

### âœ… ç‹€æ…‹æª¢æŸ¥
- æª¢æŸ¥ç›®æ¨™ä½ç½®æ˜¯å¦å·²ç¶“å¯è¡Œèµ°
- é¿å…é‡è¤‡å¾æœ
- æä¾›ç›¸æ‡‰åé¥‹

### âœ… å®Œæ•´åé¥‹
- ä¸»è¼¸å‡ºé¡¯ç¤ºå¾æœçµæœ
- é¡¯ç¤ºç›®æ¨™ä½ç½®åº§æ¨™
- ç³»çµ±æ—¥èªŒè¨˜éŒ„æ“ä½œ

### âœ… è‡ªå‹•ä¿å­˜
- åœ°åœ–è®Šæ›´è‡ªå‹•æŒä¹…åŒ–
- é‡å•ŸéŠæˆ²å¾Œä¿æŒè®Šæ›´
- æ•¸æ“šå®‰å…¨å¯é 

## ä½¿ç”¨å ´æ™¯

### ğŸ—ºï¸ é–‹é—¢é“è·¯
```
> look
ã€ç•¶å‰ä½ç½®: (50, 50)ã€‘
ã€ç©ºæ› çš„å»£å ´ã€‘

> conq up
ä½ å¾æœäº† ä¸Š æ–¹çš„éšœç¤™ï¼
ä½ç½® (50, 49) ç¾åœ¨å¯ä»¥è¡Œèµ°äº†

> up
å¾€ ä¸Š ç§»å‹•
ã€ç•¶å‰ä½ç½®: (50, 49)ã€‘
ã€å‰›å‰›é–‹é—¢çš„é€šé“ã€‘
```

### ğŸ® é…åˆå¤§åœ°åœ–
```
# å¾æœå‰
> show map
    xxx   xxx    
  xx   xxx   xx  
 xx      P    xxP
xx              x

# å¾æœä¸Šæ–¹
> conq u

# å¾æœå¾Œ
> show map
    xxx   xxx    
  xx   x x   xx  
 xx      P    xxP  # ä¸Šæ–¹ç¾åœ¨å¯è¡Œèµ°
xx              x
```

### ğŸ“‹ æ—¥èªŒè¿½è¹¤
ç³»çµ±æ—¥èªŒæœƒè¨˜éŒ„æ¯æ¬¡å¾æœæ“ä½œï¼š
```
[15:25:30] ç©å®¶åœ¨ (50, 50) å¾æœäº† ä¸Š æ–¹ (50, 49)
[15:25:35] ç©å®¶åœ¨ (50, 49) å¾æœäº† å³ æ–¹ (51, 49)
```

## éŒ¯èª¤è™•ç†

### æœªçŸ¥æ–¹å‘
```
> conq å·¦
æœªçŸ¥æ–¹å‘: å·¦ï¼Œè«‹ä½¿ç”¨ up/down/left/right
```

### è¶…å‡ºåœ°åœ–ç¯„åœ
```
> conq up
ç›®æ¨™ä½ç½®è¶…å‡ºåœ°åœ–ç¯„åœ
```

### å·²ç¶“å¯è¡Œèµ°
```
> conq down
ä¸‹ æ–¹å·²ç¶“æ˜¯å¯è¡Œèµ°çš„äº†
```

## å¹«åŠ©æ–‡æª”æ›´æ–°

æŒ‡ä»¤å·²åŠ å…¥ã€ŒğŸ® éŠæˆ²æ§åˆ¶ã€åˆ†é¡ï¼š

```
ğŸ“– å¯ç”¨æŒ‡ä»¤
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ® éŠæˆ²æ§åˆ¶
  â†‘â†“â†â†’                 - ç§»å‹•è§’è‰²
  look [<npc>]         - æŸ¥çœ‹ä½ç½®æˆ–NPC
  conq <æ–¹å‘>          - å¾æœæ–¹å‘ä½¿å…¶å¯è¡Œèµ°  âœ¨ æ–°å¢
  help                 - é¡¯ç¤ºæ­¤å¹«åŠ©è¨Šæ¯
  exit / quit          - é€€å‡ºéŠæˆ²
```

## éŠæˆ²å¹³è¡¡æ€§

### âš ï¸ æ³¨æ„äº‹é …
- æ­¤æŒ‡ä»¤å…è¨±ç©å®¶æ”¹è®Šåœ°åœ–çµæ§‹
- å¯èƒ½å½±éŸ¿éŠæˆ²é›£åº¦å’Œå¹³è¡¡æ€§
- å»ºè­°åœ¨æœ€çµ‚ç‰ˆæœ¬ä¸­è€ƒæ…®ï¼š
  - æ·»åŠ èƒ½é‡/è³‡æºæ¶ˆè€—
  - é™åˆ¶ä½¿ç”¨æ¬¡æ•¸
  - åƒ…å…è¨±å¾æœç‰¹å®šé¡å‹çš„éšœç¤™
  - æ·»åŠ å¾æœå¤±æ•—æ©Ÿç‡

### ğŸ¯ ç•¶å‰è¨­è¨ˆå„ªå‹¢
- ä¾¿æ–¼æ¸¬è©¦å’Œé–‹ç™¼
- å¿«é€Ÿæ¢ç´¢åœ°åœ–
- éˆæ´»çš„éŠæˆ²é«”é©—
- ç‚ºé—œå¡è¨­è¨ˆæä¾›å·¥å…·

## æœªä¾†æ”¹é€²å»ºè­°

1. **è³‡æºæ¶ˆè€—**
   ```rust
   // éœ€è¦æ¶ˆè€—é«”åŠ›æˆ–é“å…·
   if me.stamina >= 10 {
       me.stamina -= 10;
       // å¾æœé‚è¼¯
   }
   ```

2. **éšœç¤™é¡å‹**
   ```rust
   // ä¸åŒéšœç¤™éœ€è¦ä¸åŒå·¥å…·
   match obstacle_type {
       Rock => require_tool("é¬"),
       Tree => require_tool("æ–§é ­"),
       Water => require_tool("æ©‹"),
   }
   ```

3. **å†·å»æ™‚é–“**
   ```rust
   // é™åˆ¶ä½¿ç”¨é »ç‡
   if last_conquer_time.elapsed() > Duration::from_secs(60) {
       // å…è¨±å¾æœ
   }
   ```

4. **æˆåŠŸç‡**
   ```rust
   // æ·»åŠ éš¨æ©Ÿå¤±æ•—æ©Ÿç‡
   if random() < 0.8 {  // 80% æˆåŠŸç‡
       // å¾æœæˆåŠŸ
   } else {
       // å¾æœå¤±æ•—ï¼Œæ¶ˆè€—è³‡æº
   }
   ```

## å„ªå‹¢

### âœ… åœ°åœ–ç·¨è¼¯èƒ½åŠ›
- ç©å®¶å¯ä»¥è‡ªç”±å¡‘é€ ç’°å¢ƒ
- å‰µé€ æ–°çš„æ¢ç´¢è·¯å¾‘
- çªç ´è¨­è¨ˆé™åˆ¶

### âœ… æ¸¬è©¦å‹å¥½
- å¿«é€Ÿè¨ªå•åœ°åœ–ä»»ä½•å€åŸŸ
- æ–¹ä¾¿æ¸¬è©¦éŠæˆ²åŠŸèƒ½
- åŠ é€Ÿé–‹ç™¼æµç¨‹

### âœ… ç©æ³•å¤šæ¨£æ€§
- æä¾›æ–°çš„éŠæˆ²æ©Ÿåˆ¶
- å¢åŠ ç­–ç•¥æ€§
- æå‡å¯ç©æ€§

## æ¸¬è©¦çµæœ
- âœ… ç·¨è­¯æˆåŠŸ
- âœ… `conq up/down/left/right` æ­£å¸¸å·¥ä½œ
- âœ… `conq u/d/l/r` ç°¡å¯«æ­£å¸¸å·¥ä½œ
- âœ… æ–¹å‘è§£ææ­£ç¢ºï¼ˆä¸å€åˆ†å¤§å°å¯«ï¼‰
- âœ… åœ°åœ–é» walkable å±¬æ€§æ­£ç¢ºä¿®æ”¹
- âœ… åœ°åœ–è‡ªå‹•ä¿å­˜
- âœ… é‚Šç•Œæª¢æŸ¥æ­£å¸¸
- âœ… ç‹€æ…‹æª¢æŸ¥æ­£å¸¸
- âœ… éŒ¯èª¤è™•ç†å®Œå–„
- âœ… ç³»çµ±æ—¥èªŒè¨˜éŒ„æ­£ç¢º

---

# FlyTo èˆ‡å‘½åç³»çµ±æŒ‡ä»¤

## æ—¥æœŸ
2025-12-13

## åŠŸèƒ½èªªæ˜

æ–°å¢ä¸‰å€‹å¼·å¤§çš„æŒ‡ä»¤ï¼š`flyto`ï¼ˆå‚³é€ï¼‰ã€`namehere`ï¼ˆå‘½åç•¶å‰åœ°é»ï¼‰ã€`name`ï¼ˆå‘½å NPC æˆ–æŒ‡å®šåœ°é»ï¼‰ã€‚

## æ–°å¢åŠŸèƒ½

### 1. FlyTo å‚³é€æŒ‡ä»¤

**èªæ³•**ï¼š
```
flyto <ç›®æ¨™>
```

**æ”¯æŒçš„ç›®æ¨™é¡å‹**ï¼š
1. **åº§æ¨™**: `flyto x,y` - å‚³é€åˆ°æŒ‡å®šåº§æ¨™
2. **åœ°åœ–**: `flyto åœ°åœ–å` - å‚³é€åˆ°æŒ‡å®šåœ°åœ–çš„ä¸­å¿ƒ
3. **åœ°é»**: `flyto åœ°é»å` - å‚³é€åˆ°å·²å‘½åçš„åœ°é»

**ä½¿ç”¨ç¯„ä¾‹**ï¼š
```
> flyto 50,50
ä½ é£›åˆ°äº†ä½ç½® (50, 50)

> flyto åˆå§‹ä¹‹åœ°
ä½ é£›åˆ°äº†åœ°åœ–ã€Œåˆå§‹ä¹‹åœ°ã€

> flyto å»£å ´
ä½ é£›åˆ°äº†åœ°é»ã€Œå»£å ´ã€(50, 50)
```

### 2. NameHere å‘½åç•¶å‰åœ°é»

**èªæ³•**ï¼š
```
namehere <åç¨±>
```

**åŠŸèƒ½**ï¼šç‚ºç©å®¶ç•¶å‰æ‰€åœ¨ä½ç½®å‘½åã€‚

**ä½¿ç”¨ç¯„ä¾‹**ï¼š
```
> namehere åŸé®å»£å ´
ä½ å°‡æ­¤åœ°å‘½åç‚ºã€ŒåŸé®å»£å ´ã€

> namehere ç¥ç§˜æ´ç©´å…¥å£
ä½ å°‡æ­¤åœ°å‘½åç‚ºã€Œç¥ç§˜æ´ç©´å…¥å£ã€
```

### 3. Name å‘½åæŒ‡ä»¤

**èªæ³•**ï¼š
```
name <ç›®æ¨™> <æ–°åç¨±>
```

**æ”¯æŒçš„ç›®æ¨™é¡å‹**ï¼š
1. **åº§æ¨™**: `name x,y åç¨±` - å‘½åæŒ‡å®šåº§æ¨™çš„åœ°é»
2. **NPC**: `name npcåç¨± æ–°åç¨±` - é‡å‘½å NPC

**ä½¿ç”¨ç¯„ä¾‹**ï¼š

**å‘½ååœ°é»**ï¼š
```
> name 42,51 å•†æ¥­å€
ä½ å°‡ä½ç½® (42, 51) å‘½åç‚ºã€Œå•†æ¥­å€ã€

> name 25,25 å¤è€ç¥æ®¿
ä½ å°‡ä½ç½® (25, 25) å‘½åç‚ºã€Œå¤è€ç¥æ®¿ã€
```

**é‡å‘½å NPC**ï¼š
```
> name merchant è€ç‹
ä½ å°‡ã€Œå•†äººã€æ”¹åç‚ºã€Œè€ç‹ã€

> name m å°æ
ä½ å°‡ã€Œè€ç‹ã€æ”¹åç‚ºã€Œå°æã€
```

## æŠ€è¡“å¯¦ç¾

### Point çµæ§‹æ“´å±•

**æ·»åŠ  name æ¬„ä½**ï¼š
```rust
pub struct Point {
    pub x: usize,
    pub y: usize,
    pub walkable: bool,
    pub description: String,
    #[serde(default)]
    pub name: String,  // âœ¨ æ–°å¢ï¼šåœ°é»åç¨±
    pub objects: HashMap<String, u32>,
}
```

### æ–°å¢æŒ‡ä»¤æšèˆ‰

**src/input.rs**ï¼š
```rust
pub enum CommandResult {
    // ...
    FlyTo(String),           // å‚³é€åˆ°ä½ç½®/åœ°åœ–/åœ°é»
    NameHere(String),        // å‘½åç•¶å‰åœ°é»
    Name(String, String),    // å‘½å NPC æˆ–åœ°é»
}
```

### å¯¦ç¾çš„è™•ç†å‡½æ•¸

**src/app.rs**ï¼š

1. **handle_flyto()**
   - è§£æåº§æ¨™ã€åœ°åœ–åæˆ–åœ°é»å
   - åŸ·è¡Œå‚³é€ä¸¦ä¿å­˜ç‹€æ…‹
   - è‡ªå‹•åŸ·è¡Œ look é¡¯ç¤ºæ–°ä½ç½®

2. **handle_namehere()**
   - å‘½åç•¶å‰ä½ç½®
   - ä¿å­˜åœ°åœ–è®Šæ›´

3. **handle_name()**
   - å€åˆ†ç›®æ¨™é¡å‹ï¼ˆåº§æ¨™/NPCï¼‰
   - åŸ·è¡Œå‘½åä¸¦ä¿å­˜

4. **parse_coordinates()**
   - è§£æ "x,y" æ ¼å¼çš„åº§æ¨™å­—ä¸²

## åŠŸèƒ½ç‰¹é»

### âœ… æ™ºèƒ½ç›®æ¨™è­˜åˆ¥
- è‡ªå‹•è­˜åˆ¥åº§æ¨™æ ¼å¼ (x,y)
- å„ªå…ˆå˜—è©¦åœ°åœ–åç¨±
- æœå°‹å·²å‘½ååœ°é»
- æ¸…æ™°çš„éŒ¯èª¤æç¤º

### âœ… å®Œæ•´çš„åé¥‹
- é¡¯ç¤ºå‚³é€çµæœ
- é¡¯ç¤ºèˆŠåç¨±å’Œæ–°åç¨±
- ç³»çµ±æ—¥èªŒè¨˜éŒ„æ“ä½œ
- è‡ªå‹•åŸ·è¡Œ look æŸ¥çœ‹æ–°ä½ç½®

### âœ… æ•¸æ“šæŒä¹…åŒ–
- åœ°é»åç¨±è‡ªå‹•ä¿å­˜
- NPC åç¨±è‡ªå‹•ä¿å­˜
- ç©å®¶ä½ç½®è‡ªå‹•ä¿å­˜
- é‡å•ŸéŠæˆ²å¾Œä¿æŒ

### âœ… å‘å¾Œå…¼å®¹
- name æ¬„ä½ä½¿ç”¨ `#[serde(default)]`
- èˆŠåœ°åœ–æ•¸æ“šæ­£å¸¸è¼‰å…¥
- é è¨­åç¨±ç‚ºç©ºå­—ä¸²

## ä½¿ç”¨å ´æ™¯

### ğŸ—ºï¸ å»ºç«‹åœ°æ¨™ç³»çµ±
```
# æ¢ç´¢åœ°åœ–ä¸¦å‘½åé‡è¦åœ°é»
> namehere åŸé®å…¥å£
ä½ å°‡æ­¤åœ°å‘½åç‚ºã€ŒåŸé®å…¥å£ã€

> flyto 60,60
ä½ é£›åˆ°äº†ä½ç½® (60, 60)

> namehere æ£®æ—æ·±è™•
ä½ å°‡æ­¤åœ°å‘½åç‚ºã€Œæ£®æ—æ·±è™•ã€

# å¿«é€Ÿè¿”å›å·²å‘½ååœ°é»
> flyto åŸé®å…¥å£
ä½ é£›åˆ°äº†åœ°é»ã€ŒåŸé®å…¥å£ã€(50, 50)
```

### ğŸ‘¤ å€‹æ€§åŒ– NPC
```
# çµ¦ NPC å–å€‹æ€§åŒ–åå­—
> name merchant æè€é—†
ä½ å°‡ã€Œå•†äººã€æ”¹åç‚ºã€Œæè€é—†ã€

> look æè€é—†
ğŸ‘¤ æè€é—†
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ ç²¾æ˜çš„å•†äººï¼Œè²©å”®å„ç¨®ç‰©å“
...
```

### ğŸ® å¿«é€Ÿæ¸¬è©¦
```
# å¿«é€Ÿç§»å‹•åˆ°æ¸¬è©¦ä½ç½®
> flyto 25,25
ä½ é£›åˆ°äº†ä½ç½® (25, 25)

# æ¨™è¨˜æ¸¬è©¦å€åŸŸ
> namehere æ¸¬è©¦å€A
ä½ å°‡æ­¤åœ°å‘½åç‚ºã€Œæ¸¬è©¦å€Aã€
```

### ğŸ“‹ åœ°åœ–ç·¨è¼¯
```
# æ‰¹é‡å‘½ååœ°é»
> name 10,10 åŒ—é–€
> name 50,90 å—é–€
> name 10,50 è¥¿é–€
> name 90,50 æ±é–€

# å»ºç«‹å‚³é€ç¶²çµ¡
> flyto åŒ—é–€
> flyto å—é–€
> flyto è¥¿é–€
> flyto æ±é–€
```

## åº§æ¨™æ ¼å¼

æ”¯æŒçš„åº§æ¨™æ ¼å¼ï¼š
- `x,y` - æ¨™æº–æ ¼å¼
- `x, y` - å¸¶ç©ºæ ¼
- è‡ªå‹•å»é™¤å‰å¾Œç©ºç™½

ç¯„ä¾‹ï¼š
```
flyto 50,50
flyto 50, 50
name 42,51 å•†åº—
name 42, 51 å•†åº—
```

## éŒ¯èª¤è™•ç†

### FlyTo éŒ¯èª¤
```
> flyto 999,999
åº§æ¨™è¶…å‡ºåœ°åœ–ç¯„åœ

> flyto ä¸å­˜åœ¨çš„åœ°åœ–
æ‰¾ä¸åˆ°ç›®æ¨™: ä¸å­˜åœ¨çš„åœ°åœ–ï¼ˆè«‹ä½¿ç”¨åº§æ¨™x,yã€åœ°åœ–åæˆ–åœ°é»åï¼‰
```

### Name éŒ¯èª¤
```
> name 999,999 æ¸¬è©¦
åº§æ¨™è¶…å‡ºåœ°åœ–ç¯„åœ

> name ä¸å­˜åœ¨çš„npc æ–°åå­—
æ‰¾ä¸åˆ°ç›®æ¨™: ä¸å­˜åœ¨çš„npcï¼ˆè«‹ä½¿ç”¨åº§æ¨™x,yæˆ–NPCåç¨±ï¼‰
```

## ç³»çµ±æ—¥èªŒ

æ‰€æœ‰å‘½åå’Œå‚³é€æ“ä½œéƒ½æœƒè¨˜éŒ„ï¼š

```
[15:30:15] ç©å®¶å‚³é€åˆ° (50, 50)
[15:30:20] ä½ç½® (50, 50) å¾ ï¼ˆç„¡åï¼‰ æ›´åç‚ºã€ŒåŸé®å»£å ´ã€
[15:30:45] ç©å®¶å‚³é€åˆ°åœ°é»ã€ŒåŸé®å»£å ´ã€(50, 50)
[15:31:00] NPC å¾ã€Œå•†äººã€æ›´åç‚ºã€Œæè€é—†ã€
```

## å¹«åŠ©æ–‡æª”æ›´æ–°

æ–°æŒ‡ä»¤å·²åŠ å…¥ã€ŒğŸ® éŠæˆ²æ§åˆ¶ã€åˆ†é¡ï¼š

```
ğŸ“– å¯ç”¨æŒ‡ä»¤
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ® éŠæˆ²æ§åˆ¶
  â†‘â†“â†â†’                 - ç§»å‹•è§’è‰²
  look [<npc>]         - æŸ¥çœ‹ä½ç½®æˆ–NPC
  conq <æ–¹å‘>          - å¾æœæ–¹å‘ä½¿å…¶å¯è¡Œèµ°
  flyto <ç›®æ¨™>         - å‚³é€åˆ°ä½ç½®/åœ°åœ–/åœ°é»      âœ¨ æ–°å¢
  namehere <åç¨±>      - å‘½åç•¶å‰åœ°é»              âœ¨ æ–°å¢
  name <ç›®æ¨™> <åç¨±>   - å‘½åNPCæˆ–åœ°é»             âœ¨ æ–°å¢
  help                 - é¡¯ç¤ºæ­¤å¹«åŠ©è¨Šæ¯
  exit / quit          - é€€å‡ºéŠæˆ²
```

## å„ªå‹¢

### âœ… å»ºç«‹åœ°æ¨™ç³»çµ±
- ç‚ºé‡è¦åœ°é»å‘½å
- å¿«é€Ÿå‚³é€åˆ°åœ°æ¨™
- å»ºç«‹éŠæˆ²ä¸–ç•Œçš„çµæ§‹

### âœ… æå‡å°èˆªæ•ˆç‡
- ä¸éœ€è¦è¨˜ä½åº§æ¨™
- ä½¿ç”¨æœ‰æ„ç¾©çš„åç¨±
- æ¸›å°‘é‡è¤‡ç§»å‹•

### âœ… å¢å¼·è§’è‰²æ‰®æ¼”
- çµ¦ NPC å€‹æ€§åŒ–åå­—
- ç‚ºåœ°é»è³¦äºˆæ„ç¾©
- è±å¯ŒéŠæˆ²é«”é©—

### âœ… é–‹ç™¼æ¸¬è©¦å‹å¥½
- å¿«é€Ÿç§»å‹•åˆ°æ¸¬è©¦å€åŸŸ
- æ¨™è¨˜é‡è¦æ¸¬è©¦é»
- æé«˜é–‹ç™¼æ•ˆç‡

## å¯¦ç¾ç´°ç¯€

### åœ°é»åç¨±æŸ¥æ‰¾

FlyTo æŸ¥æ‰¾åœ°é»æ™‚æœƒéæ­·æ•´å€‹åœ°åœ–ï¼š
```rust
for row in &current_map.points {
    for point in row {
        if !point.name.is_empty() && point.name == target {
            // æ‰¾åˆ°åŒ¹é…çš„åœ°é»
        }
    }
}
```

### åº§æ¨™è§£æ

ä½¿ç”¨å°ˆé–€çš„è§£æå‡½æ•¸ï¼š
```rust
fn parse_coordinates(s: &str) -> Option<(usize, usize)> {
    let parts: Vec<&str> = s.split(',').collect();
    if parts.len() == 2 {
        if let (Ok(x), Ok(y)) = (
            parts[0].trim().parse::<usize>(),
            parts[1].trim().parse::<usize>()
        ) {
            return Some((x, y));
        }
    }
    None
}
```

### è‡ªå‹• Look

å‚³é€å¾Œè‡ªå‹•åŸ·è¡Œ lookï¼š
```rust
// è‡ªå‹•åŸ·è¡Œ look
display_look(None, output_manager, game_world, me);
```

## æœªä¾†æ”¹é€²å»ºè­°

1. **åœ°é»åˆ—è¡¨æŒ‡ä»¤**
   ```
   places list        # åˆ—å‡ºæ‰€æœ‰å·²å‘½ååœ°é»
   places search åŸé® # æœå°‹åŒ…å«é—œéµå­—çš„åœ°é»
   ```

2. **å‚³é€æ­·å²**
   ```
   flyto @last        # è¿”å›ä¸Šæ¬¡ä½ç½®
   flyto @home        # è¿”å›è¨­å®šçš„å®¶
   ```

3. **åœ°é»æè¿°**
   ```
   describe here é€™æ˜¯ä¸€å€‹ç¹å¿™çš„å¸‚é›†
   ```

4. **æ‰¹é‡å‘½å**
   ```
   name area 10,10 20,20 å•†æ¥­å€  # å‘½åå€åŸŸ
   ```

## æ¸¬è©¦çµæœ
- âœ… ç·¨è­¯æˆåŠŸ
- âœ… `flyto x,y` åº§æ¨™å‚³é€æ­£å¸¸
- âœ… `flyto åœ°åœ–å` åœ°åœ–å‚³é€æ­£å¸¸
- âœ… `flyto åœ°é»å` åœ°é»å‚³é€æ­£å¸¸
- âœ… `namehere` å‘½åç•¶å‰åœ°é»æ­£å¸¸
- âœ… `name x,y åç¨±` å‘½ååœ°é»æ­£å¸¸
- âœ… `name npc åç¨±` é‡å‘½å NPC æ­£å¸¸
- âœ… åº§æ¨™è§£ææ­£ç¢ºï¼ˆæ”¯æŒç©ºæ ¼ï¼‰
- âœ… æ•¸æ“šæŒä¹…åŒ–æ­£å¸¸
- âœ… éŒ¯èª¤è™•ç†å®Œå–„
- âœ… ç³»çµ±æ—¥èªŒè¨˜éŒ„æ­£ç¢º
- âœ… å‘å¾Œå…¼å®¹ï¼ˆèˆŠåœ°åœ–æ­£å¸¸è¼‰å…¥ï¼‰

## Look æŒ‡ä»¤é¡¯ç¤ºå¢å¼·

### æ—¥æœŸ
2025-12-13

### æ›´æ–°å…§å®¹

**é¡¯ç¤ºåœ°é»åç¨±**ï¼š
- `look` æŒ‡ä»¤ç¾åœ¨æœƒé¡¯ç¤ºåœ°é»åç¨±ï¼ˆå¦‚æœæœ‰ï¼‰
- æ ¼å¼ï¼š`æ­¤è™•æ˜¯ã€åœ°é»åç¨±ã€‘`
- å¦‚æœåœ°é»æ²’æœ‰åç¨±ï¼Œå‰‡ä¸é¡¯ç¤ºæ­¤è¡Œ

### é¡¯ç¤ºç¯„ä¾‹

**æœ‰åç¨±çš„åœ°é»**ï¼š
```
> look
ã€ç•¶å‰ä½ç½®: (50, 50)ã€‘
ã€ç©ºæ› çš„å»£å ´ã€‘
æ­¤è™•æ˜¯ã€åŸé®å»£å ´ã€‘

ğŸ æ­¤è™•ç‰©å“:
  â€¢ æœ¨åŠ (wooden_sword) x1

ğŸ‘¥ æ­¤è™•çš„äººç‰©:
  â€¢ å•†äºº - ç²¾æ˜çš„å•†äººï¼Œè²©å”®å„ç¨®ç‰©å“
```

**æ²’æœ‰åç¨±çš„åœ°é»**ï¼š
```
> look
ã€ç•¶å‰ä½ç½®: (55, 55)ã€‘
ã€é¬±é¬±è’¼è’¼çš„æ¨¹æ—ã€‘

ğŸ æ­¤è™•ç‰©å“:
  â€¢ è˜‹æœ (apple) x3
```

### æŠ€è¡“å¯¦ç¾

**src/app.rs**ï¼š
```rust
// é¡¯ç¤ºåœ°é»åç¨±ï¼ˆå¦‚æœæœ‰ï¼‰
if !point.name.is_empty() {
    output_manager.print(format!("æ­¤è™•æ˜¯ã€{}ã€‘", point.name));
}
```

### å„ªå‹¢

- âœ… æ¸…æ¥šè­˜åˆ¥å·²å‘½ååœ°é»
- âœ… ä¸å½±éŸ¿æœªå‘½ååœ°é»çš„é¡¯ç¤º
- âœ… èˆ‡å‘½åç³»çµ±å®Œç¾æ•´åˆ
- âœ… å¢å¼·ä½ç½®è­˜åˆ¥åº¦

### æ¸¬è©¦çµæœ
- âœ… ç·¨è­¯æˆåŠŸ
- âœ… æœ‰åç¨±çš„åœ°é»æ­£ç¢ºé¡¯ç¤º
- âœ… ç„¡åç¨±çš„åœ°é»ä¸é¡¯ç¤ºè©²è¡Œ
- âœ… æ ¼å¼ç¾è§€ä¸€è‡´

---

# Destroy æ‘§æ¯€æŒ‡ä»¤

## æ—¥æœŸ
2025-12-13

## åŠŸèƒ½èªªæ˜

æ–°å¢ `destroy` æŒ‡ä»¤ï¼Œå¯ä»¥åˆªé™¤ç©å®¶ç•¶å‰ä½ç½®çš„ NPC æˆ–ç‰©å“ã€‚

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬èªæ³•
```
destroy <ç›®æ¨™>
```

**ç›®æ¨™é¡å‹**ï¼š
1. **NPC åç¨±æˆ–åˆ¥å** - åˆªé™¤ç•¶å‰ä½ç½®çš„ NPC
2. **ç‰©å“åç¨±** - åˆªé™¤ç•¶å‰ä½ç½®çš„ç‰©å“ï¼ˆæ”¯æ´ä¸­è‹±æ–‡ï¼‰

### ä½¿ç”¨ç¯„ä¾‹

**åˆªé™¤ NPC**ï¼š
```
> destroy å•†äºº
ä½ æ‘§æ¯€äº† NPCã€Œå•†äººã€

> destroy m
ä½ æ‘§æ¯€äº† NPCã€Œå•†äººã€

> destroy merchant
ä½ æ‘§æ¯€äº† NPCã€Œå•†äººã€
```

**åˆªé™¤ç‰©å“**ï¼š
```
> destroy apple
ä½ æ‘§æ¯€äº†ç‰©å“ã€Œè˜‹æœ (apple)ã€x5

> destroy è˜‹æœ
ä½ æ‘§æ¯€äº†ç‰©å“ã€Œè˜‹æœ (apple)ã€x5

> destroy wooden_sword
ä½ æ‘§æ¯€äº†ç‰©å“ã€Œæœ¨åŠ (wooden_sword)ã€x1
```

## æŠ€è¡“å¯¦ç¾

### æ–°å¢æŒ‡ä»¤æšèˆ‰

**src/input.rs**ï¼š
```rust
pub enum CommandResult {
    // ...
    Destroy(String),  // åˆªé™¤æŒ‡å®šçš„ NPC æˆ–ç‰©å“
}
```

### NpcManager æ–°å¢æ–¹æ³•

**src/npc_manager.rs**ï¼š
```rust
/// é€šéåç¨±æˆ–åˆ¥åå’Œä½ç½®ç§»é™¤ NPC
pub fn remove_npc_at(&mut self, name_or_id: &str, x: usize, y: usize) -> Option<(String, Person)> {
    let key = name_or_id.to_lowercase();
    
    // å…ˆå˜—è©¦é€šéåˆ¥åæŸ¥æ‰¾ ID
    if let Some(id) = self.npc_aliases.get(&key) {
        if let Some(npc) = self.npcs.get(id) {
            if npc.x == x && npc.y == y {
                let id_clone = id.clone();
                let removed_npc = self.npcs.remove(&id_clone);
                return removed_npc.map(|npc| (id_clone, npc));
            }
        }
    }
    
    // å˜—è©¦é€šéåç¨±æŸ¥æ‰¾
    if let Some((id, npc)) = self.npcs.iter().find(|(_, npc)| {
        npc.name.to_lowercase() == key && npc.x == x && npc.y == y
    }) {
        let id_clone = id.clone();
        let removed_npc = self.npcs.remove(&id_clone);
        return removed_npc.map(|npc| (id_clone, npc));
    }
    
    None
}
```

### è™•ç†å‡½æ•¸

**src/app.rs**ï¼š
```rust
fn handle_destroy(
    target: String,
    output_manager: &mut OutputManager,
    game_world: &mut GameWorld,
    me: &Person,
) -> Result<(), Box<dyn std::error::Error>> {
    // å…ˆå˜—è©¦ä½œç‚º NPCï¼ˆåœ¨ç•¶å‰ä½ç½®ï¼‰
    if let Some((id, npc)) = game_world.npc_manager.remove_npc_at(&target, me.x, me.y) {
        let npc_name = npc.name.clone();
        output_manager.print(format!("ä½ æ‘§æ¯€äº† NPCã€Œ{}ã€", npc_name));
        output_manager.log(format!("NPCã€Œ{}ã€åœ¨ ({}, {}) è¢«åˆªé™¤", npc_name, me.x, me.y));
        
        // ä¿å­˜ NPC ç‹€æ…‹
        let person_dir = format!("{}/persons", game_world.world_dir);
        game_world.npc_manager.save_all(&person_dir)?;
        
        return Ok(());
    }
    
    // å˜—è©¦ä½œç‚ºç‰©å“
    let item_name = item_registry::resolve_item_name(&target);
    let map_name = game_world.current_map.clone();
    
    if let Some(current_map) = game_world.get_current_map_mut() {
        if let Some(point) = current_map.get_point_mut(me.x, me.y) {
            if let Some(count) = point.objects.get(&item_name) {
                let count_value = *count;
                point.objects.remove(&item_name);
                
                let display_name = item_registry::get_item_display_name(&item_name);
                output_manager.print(format!("ä½ æ‘§æ¯€äº†ç‰©å“ã€Œ{}ã€x{}", display_name, count_value));
                output_manager.log(format!("ç‰©å“ã€Œ{}ã€x{} åœ¨ ({}, {}) è¢«åˆªé™¤", display_name, count_value, me.x, me.y));
                
                // ä¿å­˜åœ°åœ–
                if let Some(map) = game_world.maps.get(&map_name) {
                    game_world.save_map(map)?;
                }
                
                return Ok(());
            }
        }
    }
    
    output_manager.set_status(format!("æ­¤è™•æ‰¾ä¸åˆ°ã€Œ{}ã€ï¼ˆNPC æˆ–ç‰©å“ï¼‰", target));
    Ok(())
}
```

## åŠŸèƒ½ç‰¹é»

### âœ… æ™ºèƒ½ç›®æ¨™è­˜åˆ¥
- è‡ªå‹•è­˜åˆ¥ NPC åç¨±ã€ID æˆ–åˆ¥å
- æ”¯æŒç‰©å“çš„ä¸­è‹±æ–‡åç¨±
- åƒ…åˆªé™¤ç•¶å‰ä½ç½®çš„ç›®æ¨™

### âœ… å®Œæ•´åé¥‹
- é¡¯ç¤ºåˆªé™¤çš„ç›®æ¨™åç¨±
- é¡¯ç¤ºç‰©å“æ•¸é‡
- ç³»çµ±æ—¥èªŒè¨˜éŒ„æ“ä½œ

### âœ… è‡ªå‹•ä¿å­˜
- NPC åˆªé™¤å¾Œè‡ªå‹•ä¿å­˜ç‹€æ…‹
- ç‰©å“åˆªé™¤å¾Œè‡ªå‹•ä¿å­˜åœ°åœ–
- æ•¸æ“šä¸€è‡´æ€§ä¿è­‰

### âœ… å®‰å…¨æ€§
- åªèƒ½åˆªé™¤ç•¶å‰ä½ç½®çš„ç›®æ¨™
- ä¸åœ¨ç•¶å‰ä½ç½®çš„ NPC ä¸æœƒè¢«åˆªé™¤
- æ¸…æ™°çš„éŒ¯èª¤æç¤º

## ä½¿ç”¨å ´æ™¯

### ğŸ§¹ æ¸…ç†ç’°å¢ƒ
```
> look
ã€ç•¶å‰ä½ç½®: (50, 50)ã€‘
ã€ç©ºæ› çš„å»£å ´ã€‘

ğŸ æ­¤è™•ç‰©å“:
  â€¢ æœ¨åŠ (wooden_sword) x1
  â€¢ è˜‹æœ (apple) x10

ğŸ‘¥ æ­¤è™•çš„äººç‰©:
  â€¢ å•†äºº - ç²¾æ˜çš„å•†äººï¼Œè²©å”®å„ç¨®ç‰©å“

> destroy apple
ä½ æ‘§æ¯€äº†ç‰©å“ã€Œè˜‹æœ (apple)ã€x10

> destroy å•†äºº
ä½ æ‘§æ¯€äº† NPCã€Œå•†äººã€

> look
ã€ç•¶å‰ä½ç½®: (50, 50)ã€‘
ã€ç©ºæ› çš„å»£å ´ã€‘

ğŸ æ­¤è™•ç‰©å“:
  â€¢ æœ¨åŠ (wooden_sword) x1
```

### ğŸ® éŠæˆ²æ¸¬è©¦
```
# æ¸…ç†æ¸¬è©¦æ•¸æ“š
> destroy merchant
> destroy apple
> destroy wooden_sword
```

### ğŸ—ºï¸ åœ°åœ–ç·¨è¼¯
```
# ç§»é™¤ä¸éœ€è¦çš„ NPC
> flyto 25,25
> destroy traveler

# ç§»é™¤å¤šé¤˜çš„ç‰©å“
> destroy healing_potion
```

## éŒ¯èª¤è™•ç†

### ç›®æ¨™ä¸å­˜åœ¨
```
> destroy ä¸å­˜åœ¨çš„npc
æ­¤è™•æ‰¾ä¸åˆ°ã€Œä¸å­˜åœ¨çš„npcã€ï¼ˆNPC æˆ–ç‰©å“ï¼‰

> destroy unknown_item
æ­¤è™•æ‰¾ä¸åˆ°ã€Œunknown_itemã€ï¼ˆNPC æˆ–ç‰©å“ï¼‰
```

### ä¸åœ¨ç•¶å‰ä½ç½®
```
# å•†äººåœ¨ (42, 51)ï¼Œç©å®¶åœ¨ (50, 50)
> destroy merchant
æ­¤è™•æ‰¾ä¸åˆ°ã€Œmerchantã€ï¼ˆNPC æˆ–ç‰©å“ï¼‰

# éœ€è¦å…ˆç§»å‹•åˆ°è©²ä½ç½®
> flyto 42,51
> destroy merchant
ä½ æ‘§æ¯€äº† NPCã€Œå•†äººã€
```

## ç³»çµ±æ—¥èªŒ

æ‰€æœ‰åˆªé™¤æ“ä½œéƒ½æœƒè¨˜éŒ„ï¼š

```
[15:45:10] NPCã€Œå•†äººã€åœ¨ (50, 50) è¢«åˆªé™¤
[15:45:20] ç‰©å“ã€Œè˜‹æœ (apple)ã€x10 åœ¨ (50, 50) è¢«åˆªé™¤
[15:45:30] ç‰©å“ã€Œæœ¨åŠ (wooden_sword)ã€x1 åœ¨ (50, 50) è¢«åˆªé™¤
```

## å¹«åŠ©æ–‡æª”æ›´æ–°

æ–°æŒ‡ä»¤å·²åŠ å…¥ã€ŒğŸ› ï¸  å…¶ä»–ã€åˆ†é¡ï¼š

```
ğŸ“– å¯ç”¨æŒ‡ä»¤
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ› ï¸  å…¶ä»–
  clear                - æ¸…é™¤è¨Šæ¯è¼¸å‡º
  destroy <ç›®æ¨™>       - åˆªé™¤NPCæˆ–ç‰©å“     âœ¨ æ–°å¢
```

## å„ªå‹¢

### âœ… ä¾¿æ–¼ç®¡ç†
- å¿«é€Ÿæ¸…ç†ä¸éœ€è¦çš„ NPC
- ç§»é™¤å¤šé¤˜çš„ç‰©å“
- ä¿æŒç’°å¢ƒæ•´æ½”

### âœ… æ¸¬è©¦å‹å¥½
- æ¸…ç†æ¸¬è©¦æ•¸æ“š
- é‡ç½®æ¸¬è©¦ç’°å¢ƒ
- æé«˜æ¸¬è©¦æ•ˆç‡

### âœ… éˆæ´»çš„éŠæˆ²è¨­è¨ˆ
- å‹•æ…‹èª¿æ•´ NPC åˆ†å¸ƒ
- ç®¡ç†ç‰©å“æ‰è½
- å¯¦ç¾ç‰¹æ®ŠéŠæˆ²æ©Ÿåˆ¶

### âœ… å®‰å…¨å¯æ§
- åƒ…å½±éŸ¿ç•¶å‰ä½ç½®
- æ“ä½œå¯é€†ï¼ˆéœ€æ‰‹å‹•é‡æ–°æ·»åŠ ï¼‰
- å®Œæ•´çš„æ—¥èªŒè¿½è¹¤

## æ³¨æ„äº‹é …

âš ï¸ **ä¸å¯é€†æ“ä½œ**ï¼š
- `destroy` æŒ‡ä»¤æœƒæ°¸ä¹…åˆªé™¤ NPC æˆ–ç‰©å“
- åˆªé™¤çš„æ•¸æ“šç„¡æ³•è‡ªå‹•æ¢å¾©
- å»ºè­°åœ¨åˆªé™¤é‡è¦ NPC å‰å…ˆç¢ºèª

âš ï¸ **å½±éŸ¿ç¯„åœ**ï¼š
- åªåˆªé™¤ç•¶å‰ä½ç½®ï¼ˆç©å®¶æ‰€åœ¨é»ï¼‰çš„ç›®æ¨™
- NPC çš„è³‡æ–™æª”æ¡ˆæœƒè¢«ä¿ç•™ï¼ˆä½†å¾è¨˜æ†¶é«”ä¸­ç§»é™¤ï¼‰
- ç‰©å“æœƒå¾åœ°åœ–æ•¸æ“šä¸­æ°¸ä¹…ç§»é™¤

## æœªä¾†æ”¹é€²å»ºè­°

1. **ç¢ºèªæç¤º**
   ```
   > destroy merchant
   ç¢ºå®šè¦åˆªé™¤ NPCã€Œå•†äººã€å—ï¼Ÿ(y/n)
   ```

2. **æ‰¹é‡åˆªé™¤**
   ```
   destroy all items     # åˆªé™¤ç•¶å‰ä½ç½®æ‰€æœ‰ç‰©å“
   destroy all npcs      # åˆªé™¤ç•¶å‰ä½ç½®æ‰€æœ‰ NPC
   ```

3. **å›æ”¶ç«™æ©Ÿåˆ¶**
   ```
   restore merchant      # æ¢å¾©æœ€è¿‘åˆªé™¤çš„ NPC
   ```

4. **é¸æ“‡æ€§åˆªé™¤**
   ```
   destroy apple 5       # åªåˆªé™¤ 5 å€‹è˜‹æœ
   ```

## æ¸¬è©¦çµæœ
- âœ… ç·¨è­¯æˆåŠŸ
- âœ… `destroy <npc>` åˆªé™¤ NPC æ­£å¸¸
- âœ… `destroy <ç‰©å“>` åˆªé™¤ç‰©å“æ­£å¸¸
- âœ… æ”¯æŒ NPC åˆ¥åæŸ¥æ‰¾
- âœ… æ”¯æŒç‰©å“ä¸­è‹±æ–‡åç¨±
- âœ… åƒ…åˆªé™¤ç•¶å‰ä½ç½®ç›®æ¨™
- âœ… è‡ªå‹•ä¿å­˜ç‹€æ…‹
- âœ… éŒ¯èª¤è™•ç†å®Œå–„
- âœ… ç³»çµ±æ—¥èªŒè¨˜éŒ„æ­£ç¢º




