# Rataui 遊戲引擎更新日誌

## 核心功能實現

### 1. 時間系統 ⏰
- **時間流逝**: 世界時間每秒自動更新（遊戲時間加速）
- **時間顯示**: 每60秒在輸出區顯示一次當前時間（格式：Day X HH:MM）
- **時間存檔**: 程式關閉時自動存檔時間，啟動時自動載回
- **時間文件位置**: `worlds/初始世界/time.json`
- **遊戲速度**: 預設為 60倍速（1秒現實時間 = 60秒遊戲時間）

### 2. 世界系統 🌍
- **多地圖支持**: 支援5個不同的地圖
  - 初始之地 (Normal)
  - 森林 (Forest)
  - 洞穴 (Cave)
  - 沙漠 (Desert)
  - 山脈 (Mountain)
- **地圖存檔**: 所有地圖存放在 `worlds/初始世界/maps/` 目錄
- **世界元數據**: 記錄世界名稱、描述、包含的地圖

### 3. 人物系統 👤
- **Me物件**: 玩家角色
- **NPC角色**: 5個NPC分散在地圖上
  - 商人 (merchant)
  - 路人 (traveler)
  - 醫生 (doctor)
  - 工人 (worker)
  - 農夫 (farmer)
- **人物屬性**:
  - 名字、描述
  - 能力列表
  - 持有物品
  - 當前狀態
  - 坐標位置
- **人物存檔**: 所有角色存放在 `worlds/初始世界/persons/` 目錄

### 4. 地圖系統 🗺️
- **地圖大小**: 100 × 100 格子
- **點的屬性**:
  - 可移動/不可移動
  - 詳細描述
- **地圖類型**: 每種類型有不同的地形生成邏輯

### 5. 輸入指令系統 ⌨️
所有輸入都視為指令，不需要 `/` 前綴：

#### 移動指令
- `u` / 上鍵: 往上移動
- `d` / 下鍵: 往下移動
- `l` / 左鍵: 往左移動
- `r` / 右鍵: 往右移動

#### 查看指令
- `look`: 查看當前位置及四周環境
  - 顯示當前位置坐標
  - 顯示當前點的描述
  - 顯示上下左右四方向的描述
- `show minimap`: 開啟小地圖懸浮視窗
- `hide minimap`: 關閉小地圖視窗
- `status`: 顯示Me的狀態面板（右側懸浮視窗）
  - 名字
  - 描述
  - 能力列表
  - 持有物品
  - 當前狀態

#### 系統指令
- `hello [text]`: 在輸出區顯示指定的文字
- `quit` / `exit`: 退出遊戲

### 6. UI系統 🖥️
- **輸出區 (Output Area)**: 顯示遊戲訊息、look結果、系統訊息
- **輸入區 (Input Area)**: 顯示玩家輸入的指令
- **狀態列 (Status Bar)**: 單行顯示指令錯誤或移動訊息
  - 指令錯誤自動顯示
  - 錯誤訊息5秒後自動清除
- **懸浮視窗**:
  - 右上角顯示，寬度40%，高度60%
  - 可顯示狀態面板或小地圖
  - 支援多個Observable物件的顯示

### 7. 小地圖 (Minimap) 🗺️
- **位置**: 右上角懸浮視窗
- **內容**: 
  - 當前位置坐標
  - 四方向可移動/不可移動提示
  - 四方向環境描述
- **控制**: 
  - `show minimap`: 打開
  - `hide minimap`: 關閉
  - 移動時自動更新
- **持久化**: 開啟狀態在程式關閉時存檔，啟動時自動恢復

### 8. Observable特徵系統
定義了 `Observable` trait，用於在右側面板顯示不同的對象資訊：
- `show_title()`: 顯示標題
- `show_description()`: 顯示描述
- `show_list()`: 顯示列表項目

實現類：
- **Empty**: 顯示"無資料"
- **Person**: 顯示人物資訊
- **WorldInfo**: 顯示世界資訊

### 9. 設定系統 ⚙️
- **minimap狀態**: 記錄小地圖是否打開
- **文件位置**: `worlds/settings.json`
- **自動載入**: 啟動時自動恢復設定

## 檔案結構

```
rataui_demo/
├── src/
│   ├── main.rs              # 程式入口、初始化
│   ├── app.rs               # 主迴圈、事件處理
│   ├── input.rs             # 輸入處理、命令解析
│   ├── output.rs            # 輸出管理器
│   ├── ui.rs                # UI元件渲染
│   ├── world.rs             # 遊戲世界、時間系統
│   ├── map.rs               # 地圖系統
│   ├── person.rs            # 人物系統
│   ├── observable.rs        # Observable trait
│   ├── time_updatable.rs    # 時間事件系統
│   ├── item.rs              # 物品系統
│   ├── settings.rs          # 設定管理
│   └── bin/
│       └── genmap.rs        # 地圖生成工具
├── worlds/
│   └── 初始世界/
│       ├── world.json       # 世界元數據
│       ├── time.json        # 世界時間
│       ├── maps/            # 地圖存檔
│       └── persons/         # 人物存檔
├── Cargo.toml               # 專案配置
└── UPDATE.md                # 更新日誌（本文件）
```

## 技術細節

### 時間管理
- 使用 `std::time::Instant` 追蹤時間間隔
- 每1秒檢查一次需要更新時間
- 每60秒顯示一次時間訊息
- 時間資訊可序列化為JSON，支援存檔

### 持久化設計
- 所有資料使用 serde 進行 JSON 序列化
- 各模組獨立的 save/load 方法
- 程式退出時自動保存

### 模組化設計
- 命令處理邏輯集中在 `input.rs`
- UI渲染邏輯集中在 `ui.rs` 和 `output.rs`
- 主迴圈事件處理在 `app.rs`

## 注意事項

- 遊戲時間會持續累積，即使遊戲關閉
- 小地圖大小會根據終端寬度自動調整
- 狀態面板顯示時，其他指令會關閉它（除了移動）
- 方向鍵對應的移動指令與minimap方向一致

